<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-move/prover/spec-lang" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Move Specification Language | Aptos Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aptos.dev/img/meta/og-aptos-docs-default.png"><meta data-rh="true" name="twitter:image" content="https://aptos.dev/img/meta/og-aptos-docs-default.png"><meta data-rh="true" property="og:url" content="https://aptos.dev/move/prover/spec-lang"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Move Specification Language | Aptos Docs"><meta data-rh="true" name="description" content="This document describes the Move specification language (MSL), a subset of the Move language that supports specification of the behavior of Move programs. MSL works together with the Move Prover, a tool that can statically verify the correctness of MSL specifications against Move programs. In contrast to traditional testing, verification of MSL is exhaustive and holds for all possible inputs and global states of a Move module or Move script. At the same time, this verification of MSL is fast and automated enough that it can be used at a similar place in the developer workflow where tests are typically conducted (for example, for qualification of pull requests in continuous integration)."><meta data-rh="true" property="og:description" content="This document describes the Move specification language (MSL), a subset of the Move language that supports specification of the behavior of Move programs. MSL works together with the Move Prover, a tool that can statically verify the correctness of MSL specifications against Move programs. In contrast to traditional testing, verification of MSL is exhaustive and holds for all possible inputs and global states of a Move module or Move script. At the same time, this verification of MSL is fast and automated enough that it can be used at a similar place in the developer workflow where tests are typically conducted (for example, for qualification of pull requests in continuous integration)."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aptos.dev/move/prover/spec-lang"><link data-rh="true" rel="alternate" href="https://aptos.dev/move/prover/spec-lang" hreflang="en"><link data-rh="true" rel="alternate" href="https://aptos.dev/ja/move/prover/spec-lang" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aptos.dev/move/prover/spec-lang" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HM7UY0NMLG-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HVB7QFB9PQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HVB7QFB9PQ",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Aptos Docs" href="/opensearch.xml">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/@stoplight/elements@7.7.5/styles.min.css" integrity="sha384-1lLf7J28IOR7k5RlItk6Y+G3hDgVB3y4RCgWNq6ZSwjYfvJXPtZAdW0uklsAZbGW" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.89bf2db0.css">
<script src="/assets/js/runtime~main.65eb5df6.js" defer="defer"></script>
<script src="/assets/js/main.0a39c1ce.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_rfFn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/aptos_word.svg" alt="Aptos Labs Logo" class="themedComponent_iS9h themedComponent--light_Wu9q"><img src="/img/aptos_word_dark.svg" alt="Aptos Labs Logo" class="themedComponent_iS9h themedComponent--dark_ZuQW"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_EebW"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>日本語</a><ul class="dropdown__menu"><li><a href="/move/prover/spec-lang" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/ja/move/prover/spec-lang" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ja">日本語</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/aptos-white-paper">Start</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/concepts">Learn about Aptos</a></li><li><a class="dropdown__link" href="/guides/explore-aptos">Explore Aptos</a></li><li><a class="dropdown__link" href="/releases/aptos-releases">Latest Releases</a></li><li><a class="dropdown__link" href="/nodes/networks">Networks</a></li><li><a class="dropdown__link" href="/aptos-white-paper">Read the Aptos White Paper</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/tutorials">Build</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tutorials">Tutorials</a></li><li><a class="dropdown__link" href="/move/move-on-aptos">Learn the Move Language</a></li><li><a class="dropdown__link" href="/standards">Aptos Standards</a></li><li><a class="dropdown__link" href="/apis">Aptos APIs</a></li><li><a class="dropdown__link" href="/sdks/index">Aptos SDKs</a></li><li><a class="dropdown__link" href="/tools/aptos-cli">Aptos CLI</a></li><li><a class="dropdown__link" href="/integration">Integrate with Aptos</a></li><li><a class="dropdown__link" href="/tutorials/build-e2e-dapp/e2e-dapp-index">Build E2E Dapp on Aptos</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/nodes/nodes-landing">Nodes</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/nodes/nodes-landing">Learn about Nodes</a></li><li><a class="dropdown__link" href="/nodes/validator-node/validators">Run a Validator and VFN</a></li><li><a class="dropdown__link" href="/nodes/full-node/public-fullnode">Run a Public Fullnode</a></li><li><a class="dropdown__link" href="/nodes/operations/operations-index">Bootstrap a Node</a></li><li><a class="dropdown__link" href="/nodes/configure/configure-index">Configure a Node</a></li><li><a class="dropdown__link" href="/nodes/measure/measure-index">Monitor a Node</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/nodes/aptos-api-spec">Reference</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/nodes/aptos-api-spec">Aptos REST API Spec</a></li><li><a class="dropdown__link" href="/reference/error-codes">Aptos Errors Codes</a></li><li><a class="dropdown__link" href="/reference/move">Aptos Move Framework</a></li><li><a class="dropdown__link" href="/reference/glossary">Aptos Glossary</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/community">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community">Help the Aptos Ecosystem</a></li><li><a class="dropdown__link" href="/community/external-resources">External Resources</a></li><li><a class="dropdown__link" href="/community/site-updates">Update Aptos.dev</a></li><li><a class="dropdown__link" href="/community/aptos-style">Follow Aptos Style</a></li><li><a class="dropdown__link" href="/community/contributors">Contributors</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://learn.aptoslabs.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Learn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_c6F6"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/aptos-labs/aptos-developer-discussions/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Dev Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_c6F6"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_wwMH colorModeToggle_GDDh"><button class="clean-btn toggleButton_faKJ toggleButtonDisabled_aZcY" type="button" disabled="" title="ダークモードを切り替える(現在はダークモード)" aria-label="ダークモードを切り替える(現在はダークモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_m8__"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_ZVRe"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_g2EE"><button type="button" class="DocSearch DocSearch-Button" aria-label="検索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">検索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_gkQL"><div class="docsWrapper_Qxyk"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sWPH" type="button"></button><div class="docRoot_uKhe"><aside class="theme-doc-sidebar-container docSidebarContainer_Sj9c"><div class="sidebarViewport_Me7G"><div class="sidebar_JlDQ"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_YW1f"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title">Build</li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/tutorials/">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/move/move-on-aptos">Learn the Move Language</a><button aria-label="Collapse sidebar category &#x27;Learn the Move Language&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/move/book/SUMMARY">The Move Book</a><button aria-label="Expand sidebar category &#x27;The Move Book&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/move/aptos-move">Advanced Move Guides</a><button aria-label="Expand sidebar category &#x27;Advanced Move Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/move/prover/move-prover">The Move Prover Book</a><button aria-label="Collapse sidebar category &#x27;The Move Prover Book&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/move/prover/prover-guide">Move Proverユーザーガイド</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/move/prover/spec-lang">Move Specification Language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/move/prover/supporting-resources">Supporting Resources</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/standards/">Aptos Standards</a><button aria-label="Expand sidebar category &#x27;Aptos Standards&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/apis/">Aptos APIs</a><button aria-label="Expand sidebar category &#x27;Aptos APIs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/sdks/index">Aptos SDKs</a><button aria-label="Expand sidebar category &#x27;Aptos SDKs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/tools/aptos-cli/">Aptos CLI</a><button aria-label="Expand sidebar category &#x27;Aptos CLI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/integration/">Integrate with Aptos</a><button aria-label="Expand sidebar category &#x27;Integrate with Aptos&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/tutorials/build-e2e-dapp/e2e-dapp-index">Build E2E Dapp with Aptos</a><button aria-label="Expand sidebar category &#x27;Build E2E Dapp with Aptos&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/advanced-builders">Advanced Builder Guides</a><button aria-label="Expand sidebar category &#x27;Advanced Builder Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="サイドバーを隠す" aria-label="サイドバーを隠す" class="button button--secondary button--outline collapseSidebarButton_snYO"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_Jf0I"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_fHdE"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_OUYU"><div class="docItemContainer_rlCk"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_A7pt" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_cEG4"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/move/move-on-aptos"><span itemprop="name">Learn the Move Language</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/move/prover/move-prover"><span itemprop="name">The Move Prover Book</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Move Specification Language</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_MUT3 theme-doc-toc-mobile tocMobile_q7HR"><button type="button" class="clean-btn tocCollapsibleButton_gS9W">このページの見出し</button></div><div class="theme-doc-markdown markdown"><p>This document describes the <em>Move specification language (MSL)</em>, a subset of the <a href="/move/move-on-aptos">Move</a> language that supports specification of the behavior of Move programs. MSL works together with the <a href="/move/prover/move-prover">Move Prover</a>, a tool that can statically verify the correctness of MSL specifications against Move programs. In contrast to traditional testing, verification of MSL is exhaustive and holds for all possible inputs and global states of a <a href="/reference/glossary#move-module">Move module</a> or <a href="/reference/glossary#transaction-or-move-script">Move script</a>. At the same time, this verification of MSL is fast and automated enough that it can be used at a similar place in the developer workflow where tests are typically conducted (for example, for qualification of pull requests in continuous integration).</p>
<p>While the Move programming language at this point is stable, the subset represented by MSL should be
considered evolving. This has no impact on platform stability, since MSL is not running in
production; yet MSL is used for offline quality assurance where it is continuously improved for
evolving objectives.</p>
<p>This document describes the language only; see <a href="/move/prover/prover-guide">Use the Move Prover</a> for instructions. The reader is expected to have basic knowledge of the Move language, as well as basic
principles of pre- and post-condition specifications. (See for example the <a href="https://en.wikipedia.org/wiki/Design_by_contract" target="_blank" rel="noopener noreferrer">Design by contract</a>). For examples of specifications, we refer to
the <a href="https://github.com/aptos-labs/aptos-core/blob/main/aptos-move/framework/aptos-framework/doc/overview.md" target="_blank" rel="noopener noreferrer">Aptos framework</a> documentation, which has specifications embedded.</p>
<h1>Expressions</h1>
<p>Expressions in MSL are a subset of Move program expressions plus a set of additional constructs, as
discussed in the following sections.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="type-system">Type System<a href="#type-system" class="hash-link" aria-label="Type System への直接リンク" title="Type System への直接リンク">​</a></h2>
<p>The type system of MSL is similar to that of Move, with the following differences:</p>
<ul>
<li>There are two types of encodings for integer types: <code>num</code> and <code>bv</code> (bit vector).
If an integer (either a constant or a variable) is not involved in any bitwise operations directly or indirectly,
regardless of its type in Move (<code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code>, <code>u128</code> and <code>u256</code>), it is treated as the same type. In
specifications, this type is called <code>num</code>, which is an arbitrary precision <em>signed</em> integer type.
When MSL refers to a Move name that represents an <code>u8</code> or such, it will be automatically widened
to <code>num</code>. This allows writing MSL expressions like <code>x + 1 &lt;= MAX_U128</code> or <code>x - y &gt;= 0</code> without
needing to worry about overflow or underflow.
Different from <code>num</code>, <code>bv</code> cannot and does not need to be explicitly used in specifications: if an integer is involved in bitwise operations such as <code>&amp;</code>, <code>|</code> or <code>^</code>, it will be automatically encoded as <code>bv</code>at the backend.
Moreover, a <code>bv</code> integer has a fixed precision, which is consistent with its precision in Move (<code>bv8</code>, <code>bv16</code>, <code>bv32</code>, <code>bv64</code>, <code>bv128</code> and <code>bv256</code>).
Note that, in general using <code>bv</code> is not so efficient as <code>num</code> in the <a href="https://en.wikipedia.org/wiki/Satisfiability_modulo_theories" target="_blank" rel="noopener noreferrer">SMT</a> solver such as <a href="https://github.com/Z3Prover/z3" target="_blank" rel="noopener noreferrer">Z3</a>. Consequently,
the Move Prover has some restrictions when using bitwise operations, which are stated in detail below.</li>
<li>The Move types <code>&amp;T</code>, <code>&amp;mut T</code>, and <code>T</code> are considered equivalent for MSL. Equality is interpreted
as value equality. There is no need to worry about dereferencing a reference from the Move
program: these are automatically dereferenced as needed. This simplification is possible because
MSL cannot modify values from a Move program, and the program cannot directly reason about
reference equality (which eliminates the need for doing so in MSL). (Note there is also a
restriction in expressiveness coming with this, namely
for <a href="#expressiveness">functions which return <code>&amp;mut T</code></a>. However, this is rarely hit in practice,
and there are workarounds.)</li>
<li>There is the additional type <code>type</code>, which is the type of all types. It can be used only in
quantifiers.</li>
<li>There is the additional type <code>range</code>, which represents an integer range (and the notation <code>n..m</code> to
denote a value).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="naming">Naming<a href="#naming" class="hash-link" aria-label="Naming への直接リンク" title="Naming への直接リンク">​</a></h2>
<p>Name resolution in MSL works similar to the Move language. <code>use</code> declarations can introduce aliases for
imported names. MSL functions and variable names must start with a lowercase letter. Schema names
are treated like types and must start with a capital letter. (<a href="#schemas">Schemas</a> are a named construct
discussed later).</p>
<p>Move functions, MSL functions, Move types, and schemas all share the same namespace and are
therefore unambiguous if aliased via a Move <code>use</code> clause. Because of the common name space, an MSL
function cannot have the same name as a Move function. This is often handled via the convention to
prefix MSL functions as in <code>spec_has_access</code> when the related Move function is called <code>has_access</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="operators">Operators<a href="#operators" class="hash-link" aria-label="Operators への直接リンク" title="Operators への直接リンク">​</a></h2>
<p>All Move operators are supported in MSL, except <code>&amp;</code>, <code>&amp;mut</code>, and <code>*</code> (dereference).</p>
<p>In addition to the existing operators, vector subscript <code>v[i]</code>, slicing <code>v[i..j]</code>, and range
construction <code>i..j</code> are supported (the type of integer ranges is a new builtin type called <code>range</code>). Moreover, boolean implication <code>p ==&gt; q</code> is supported as a more intuitive form than <code>!p || q</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="function-calls">Function calls<a href="#function-calls" class="hash-link" aria-label="Function calls への直接リンク" title="Function calls への直接リンク">​</a></h2>
<p>In MSL expressions, functions can be called like in Move. However, the callee must either be
an <a href="#helper-functions">MSL helper function</a> or a <strong>pure</strong> Move function.</p>
<p>Move functions are considered pure if they do not modify global state and do not use Move expression
features that are not supported in MSL expressions (as defined in this document).</p>
<p>There is one extension. If a Move function definition contains a direct <code>assert</code>, this will be
ignored when it is called from an MSL expression, and the function will be considered pure. For
example:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">exists</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">ERROR_CODE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> borrow_global</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This function is pure and can be called from an MSL expression. The assertion will be ignored, and
the function will be interpreted as:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> global</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is justified by that MSL having <a href="#partial-semantics"><em>partial semantics</em></a>.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="statements">Statements<a href="#statements" class="hash-link" aria-label="Statements への直接リンク" title="Statements への直接リンク">​</a></h2>
<p>Limited sequencing of the form <code>{ let x = foo(); x + x }</code> is supported, as well as if-then-else.
Other statement forms of the Move language are not supported.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="pack-and-unpack">Pack and unpack<a href="#pack-and-unpack" class="hash-link" aria-label="Pack and unpack への直接リンク" title="Pack and unpack への直接リンク">​</a></h2>
<p>Pack expressions are supported. Unpack expressions are currently <em>not</em> supported.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="quantifiers">Quantifiers<a href="#quantifiers" class="hash-link" aria-label="Quantifiers への直接リンク" title="Quantifiers への直接リンク">​</a></h2>
<p>Universal and existential quantification is supported. The general form is:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">forall &lt;binding&gt;, ..., &lt;binding&gt; [ where &lt;exp&gt; ] : &lt;exp&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">exists &lt;binding&gt;, ..., &lt;binding&gt; [ where &lt;exp&gt; ] : &lt;exp&gt;</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Bindings can either be of the form <code>name: &lt;type&gt;</code> or <code>name in &lt;exp&gt;</code>. For the second form, the
expression must either be a <code>range</code> or a vector.</li>
<li>The optional constraint <code>where &lt;exp&gt;</code> allows to restrict the quantified range. <code>forall x: T where p: q</code>
is equivalent to <code>forall x: T : p ==&gt; q</code> and <code>exists x: T where p: q</code> is equivalent to <code>exists x: T : p &amp;&amp; q</code>.</li>
</ul>
<p>Notice that it is possible to quantify over types. For example:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">forall t: type, addr: address where exists&lt;R&lt;t&gt;&gt;(addr): exists&lt;T&lt;t&gt;&gt;(addr)</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="choice-operator">Choice operator<a href="#choice-operator" class="hash-link" aria-label="Choice operator への直接リンク" title="Choice operator への直接リンク">​</a></h2>
<p>The choice operator allows selecting a value that satisfies a predicate:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">choose a: address where exists&lt;R&gt;(a) &amp;&amp; global&lt;R&gt;(a).value &gt; 0</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the predicate is not satisfiable, the result of the choice will be undetermined. (See <a href="#partial-semantics">partial semantics</a>).</p>
<p>The choice also comes in a form to select the <em>minimal</em> value from a set of integers, as in:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">choose min i: num where in_range(v, i) &amp;&amp; v[i] == 2</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="cast-operator">Cast operator<a href="#cast-operator" class="hash-link" aria-label="Cast operator への直接リンク" title="Cast operator への直接リンク">​</a></h2>
<p>In the specification language, we can use the same syntax <code>(e as T)</code> to cast an expression <code>e</code> with one integer type to <code>T</code>, an integer type of another size.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="shift-operator">Shift operator<a href="#shift-operator" class="hash-link" aria-label="Shift operator への直接リンク" title="Shift operator への直接リンク">​</a></h2>
<p>Shift operators <code>&lt;&lt;</code> and <code>&gt;&gt;</code> are supported in the specification language, and both of them have the same semantics with the Move language. As for abort, if a value <code>v</code> has width <code>n</code>, then <code>v &lt;&lt; m</code> or <code>v &gt;&gt; m</code> will abort if <code>m &gt;= n</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="bitwise-operators">Bitwise operators<a href="#bitwise-operators" class="hash-link" aria-label="Bitwise operators への直接リンク" title="Bitwise operators への直接リンク">​</a></h2>
<p>Move programs using bitwise operators <code>&amp;</code>, <code>|</code> and <code>^</code> can be verified in the prover, and these operators are also supported in the specification language.
Due to encoding and efficiency issues, using bitwise operators has more caveats:</p>
<ul>
<li>
<p>Integers involved in bitwise operations are encoded as <code>bv</code> types at the backend, and two encodings of integers are not compatible. For instance, if a variable <code>v</code> is involved in a bitwise operation such as <code>v &amp; 2</code> or <code>v = a ^ b</code>, then when it is used in an arithmetic operation <code>v * w</code> or a shift operation <code>v &lt;&lt; w</code>, <code>w</code> will be implicitly cast to a <code>bv</code> type in the Move program.
However, the specification language does not support implicit type cast so users must explicitly use the built-in function <code>int2bv</code> in the specification: <code>v &lt;&lt; int2bv(w)</code>.
Not that since each <code>bv</code> type has a fixed length (from 8 to 256), values with type <code>num</code> cannot be converted into <code>bv</code>.</p>
</li>
<li>
<p>Verification of <code>bv</code> types is not efficient and may lead to timeout. As a result, users may prefer isolating bitwise operations from other operations and not using <code>int2bv</code> if possible. Moreover, users need to use pragmas to explicitly specify which integer-typed function arguments or struct fields will be used in bitwise computations:</p>
</li>
</ul>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token type-definition class-name">C</span><span class="token plain"> has </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">drop</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec </span><span class="token class-name">C</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// b, the second field of C, will be of bv type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pragma bv</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">foo_generic</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      i</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec foo_generic </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><span class="token comment" style="color:rgb(98, 114, 164)">// The first parameter will be of bv type if T is instantiated as a number type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      pragma bv</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;0&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><span class="token comment" style="color:rgb(98, 114, 164)">// The first return value will be of bv type if T is instantiated as a number type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      pragma bv_ret</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;0&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">test</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">C</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> x1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">foo_generic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">C</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      x1 </span><span class="token operator">^</span><span class="token plain"> x1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec test </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// Explicit type cast is mandatory for generating correct boogie program</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ensures result </span><span class="token operator">==</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that if arguments or fields of a generic function or struct are specified with <code>bv</code> types,
they will be of <code>bv</code> types in all instances of the function or the struct when the instantiated type is an integer type.</p>
<ul>
<li>Values with integer types in vectors and tables can be encoded as <code>bv</code> types; indices and keys in tables cannot be <code>bv</code> types for now. Using other types will lead to internal errors.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="built-in-functions">Built-in functions<a href="#built-in-functions" class="hash-link" aria-label="Built-in functions への直接リンク" title="Built-in functions への直接リンク">​</a></h2>
<p>MSL supports a number of built-in constants and functions. Most of them are not available in the Move
language:</p>
<ul>
<li><code>MAX_U8: num</code>, <code>MAX_U64: num</code>, <code>MAX_U128: num</code> returns the maximum value of the corresponding
type.</li>
<li><code>exists&lt;T&gt;(address): bool</code> returns true if the resource T exists at address.</li>
<li><code>global&lt;T&gt;(address): T</code> returns the resource value at address.</li>
<li><code>len&lt;T&gt;(vector&lt;T&gt;): num</code> returns the length of the vector.</li>
<li><code>update&lt;T&gt;(vector&lt;T&gt;, num, T&gt;): vector&lt;T&gt;</code> returns a new vector with the element replaced at the
given index.</li>
<li><code>vec&lt;T&gt;(): vector&lt;T&gt;</code> returns an empty vector.</li>
<li><code>vec&lt;T&gt;(x): vector&lt;T&gt;</code> returns a singleton vector.</li>
<li><code>concat&lt;T&gt;(vector&lt;T&gt;, vector&lt;T&gt;): vector&lt;T&gt;</code> returns the concatenation of the parameters.</li>
<li><code>contains&lt;T&gt;(vector&lt;T&gt;, T): bool</code> returns true if element is in vector.</li>
<li><code>index_of&lt;T&gt;(vector&lt;T&gt;, T): num</code> returns the index of the element in the vector, or the length of
the vector if it does not contain it.</li>
<li><code>range&lt;T&gt;(vector&lt;T&gt;): range</code> returns the index range of the vector.</li>
<li><code>in_range&lt;T&gt;(vector&lt;T&gt;, num): bool</code> returns true if the number is in the index range of the
vector.</li>
<li><code>in_range&lt;T&gt;(range, num): bool</code> returns true if the number is in the range.</li>
<li><code>update_field(S, F, T): S</code> updates a field in a struct, preserving the values of other fields,
where <code>S</code> is some struct, <code>F</code> the name of a field in <code>S</code>, and <code>T</code> a value for this field.</li>
<li><code>old(T): T</code> delivers the value of the passed argument at point of entry into a Move function. This
is allowed in
<code>ensures</code> post-conditions,
inline spec blocks (with additional restrictions), and
certain forms of invariants, as discussed later.</li>
<li><code>TRACE(T): T</code> is semantically the identity function and causes visualization of the argument&#x27;s
value in error messages created by the prover.</li>
<li><code>int2bv(v)</code> explicitly converts an integer <code>v</code> into its <code>bv</code> representation.</li>
<li><code>bv2int(b)</code> explicitly converts a &#x27;bv&#x27; integer &#x27;b&#x27; into the <code>num</code> representation. However, it is not encouraged to use it due to efficiency issue.</li>
</ul>
<p>Built-in functions live in an unnamed outer scope of a module. If the module defines a function <code>len</code>,
then this definition will shadow that of the according built-in function. To access the built-in
function in such a situation, one can use the notation <code>::len(v)</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="partial-semantics">Partial semantics<a href="#partial-semantics" class="hash-link" aria-label="Partial semantics への直接リンク" title="Partial semantics への直接リンク">​</a></h2>
<p>In MSL, expressions have partial semantics. This is in contrast to Move program expressions, which
have total semantics, since they either deliver a value or abort.</p>
<p>An expression <code>e[X]</code> that depends on some variables <code>X</code> may have a known interpretation for
some assignments to variables in <code>X</code> but is unknown for others. An unknown interpretation for a
sub-expression causes no issue if its value is not needed for the overall expression result.
Therefore, it does not matter if we say <code>y != 0 &amp;&amp; x / y &gt; 0</code>
or <code>x / y &gt; 0 &amp;&amp; y != 0</code>: boolean operators are commutative.</p>
<p>This basic principle inherits to higher-level language constructs. For example, in specifications,
it does not matter in which order conditions are supplied: <code>aborts_if y != 0; ensures result == x / y;</code> is the same as
<code>ensures result == x / y; aborts_if y != 0;</code>. Also, <code>aborts_if P; aborts_if Q;</code> is the same
as <code>aborts_if Q || P</code>
.</p>
<p>Moreover, the principle of partial semantics is inherited to <a href="#helper-functions">specification helper functions</a>, which behave transparently. Specifically, inlining those functions is equivalent to calling them (call-by-expression parameter passing semantics).</p>
<h1>Specifications</h1>
<p>Specifications are contained in so-called <em>specification blocks</em> (abbreviated <strong>spec block</strong>) that
can appear as module members and inside Move functions. The various types of spec blocks are shown
below, and will be discussed in subsequent sections.</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token module-declaration namespace">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">M</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Counter</span><span class="token plain"> has </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">increment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> acquires </span><span class="token class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> r </span><span class="token operator">=</span><span class="token plain"> borrow_global_mut</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        spec </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// spec block targeting this code position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        r</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// spec block targeting function increment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec </span><span class="token class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// spec block targeting struct Counter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec schema </span><span class="token class-name">Schema</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// spec block declaring a schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> num </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// spec block declaring a helper function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// spec block targeting the whole module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Apart from spec blocks inside Move functions, the textual position of spec block is irrelevant. Also,
a spec block for a struct, function, or module can be repeated multiple times, accumulating the
content.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="separating-specifications">Separating specifications<a href="#separating-specifications" class="hash-link" aria-label="Separating specifications への直接リンク" title="Separating specifications への直接リンク">​</a></h2>
<p>Instead of putting specifications into the same module as the regular Move definitions, one can also
put them into a separate &quot;specification&quot; module, which can live in the same or a different file:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token module-declaration namespace">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">M</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token namespace">addr</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">M</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The syntax of a specification module is the same as for a regular module; however, Move functions
and structures are not allowed.</p>
<p>A specification module must be compiled together with the Move module it is targeting and cannot be
compiled and verified standalone.</p>
<p>In case Move definitions are far apart (e.g. in different files), it is possible to augment the
specification of a Move function with a signature of this function to give sufficient context to
understand the specification. This syntax is optionally enabled in regular and in specification
modules:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">increment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> acquires </span><span class="token class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token function" style="color:rgb(80, 250, 123)">increment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="pragmas-and-properties">Pragmas and properties<a href="#pragmas-and-properties" class="hash-link" aria-label="Pragmas and properties への直接リンク" title="Pragmas and properties への直接リンク">​</a></h2>
<p>Pragmas and properties are a generic mechanism to influence interpretation of specifications. They
are also an extension point to experiment with new concepts before they become part of the mainstream
syntax. Here we give a brief introduction into their general syntax; individual instances are
discussed later.</p>
<p>The general form of a pragma is:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma </span><span class="token operator">&lt;</span><span class="token plain">name</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">literal</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The general form of a property is:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token plain">directive</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token operator">&lt;</span><span class="token plain">name</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">literal</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">content</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// ensures, aborts_if, include, etc..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>&lt;literal&gt;</code> can be any value supported by MSL (or the Move language). A value assignment can
also be omitted, in which case a default is used. For example, it is common to use <code>pragma option;</code>
as a shortcut for <code>pragma option = true;</code>.</p>
<p>Instead of a single pragma or property, a list can also be provided, as in <code>invariant [global, isolated] P</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="pragma-inheritance">Pragma inheritance<a href="#pragma-inheritance" class="hash-link" aria-label="Pragma inheritance への直接リンク" title="Pragma inheritance への直接リンク">​</a></h3>
<p>A pragma in a module spec block sets a value that applies to all other spec blocks in the module. A
pragma in a function or struct spec block can override this value for the function or struct.
Furthermore, the default value of some pragmas can be defined via the prover configuration.</p>
<p>As an example, we look at the <code>verify</code> pragma. This pragma is used to turn verification on or off.</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma verify </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// By default, do not verify specs in this module ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma verify </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// ... but do verify this function.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="general-pragmas-and-properties">General pragmas and properties<a href="#general-pragmas-and-properties" class="hash-link" aria-label="General pragmas and properties への直接リンク" title="General pragmas and properties への直接リンク">​</a></h3>
<p>A number of pragmas control general behavior of verification. Those are listed in the table below.</p>
<table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>verify</code></td><td>Turns on or off verification.</td></tr><tr><td><code>intrinsic</code></td><td>Marks a function to skip the Move implementation and use a prover native implementation. This makes a function behave like a native function even if it not so in Move.</td></tr><tr><td><code>timeout</code></td><td>Sets a timeout (in seconds) for function or module. Overrides the timeout provided by command line flags.</td></tr><tr><td><code>verify_duration_estimate</code></td><td>Sets an estimate (in seconds) for how long the verification of function takes. If the configured <code>timeout</code> is less than this value, verification will be skipped.</td></tr><tr><td><code>seed</code></td><td>Sets a random seed for function or module. Overrides the seed provided by command line flags.</td></tr></tbody></table>
<p>The following properties control general behavior of verification:</p>
<table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>[deactivated]</code></td><td>Excludes the associated condition from verification.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="pre-and-post-state">Pre and post state<a href="#pre-and-post-state" class="hash-link" aria-label="Pre and post state への直接リンク" title="Pre and post state への直接リンク">​</a></h2>
<p>Multiple conditions in spec blocks work with a <em>pre</em> and <em>post</em> state, relating them to each other.
Function specifications are one example of this: in the <code>ensures P</code> condition, the pre-state (at
function entry) and the post-state (at function exit) are related via the predicate <code>P</code>. However,
the concept is more general and also applied for invariants, where the pre-state is before and
post-state after a global update.</p>
<p>In contexts where a pre/post-state is active, expressions are evaluated implicitly in the
post-state. To evaluate an expression in a pre-state, one uses the built-in function <code>old(exp)</code>,
which evaluates its parameter in the pre-state and returns its value. It is important to understand
that every sub-expression in <code>exp</code> is computed in the pre-state as well, including calls to helper
functions.</p>
<p>The &#x27;state&#x27; in question here consists of assignments to global resource memory, as well as to any
parameters of the function of type <code>&amp;mut T</code>. Examples:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">increment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">counter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">counter </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">counter </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ensures counter </span><span class="token operator">==</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">old</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">counter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">increment_R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> r </span><span class="token operator">=</span><span class="token plain">  borrow_global_mut</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment_R </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures global</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">==</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">old</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">global</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="helper-functions">Helper functions<a href="#helper-functions" class="hash-link" aria-label="Helper functions への直接リンク" title="Helper functions への直接リンク">​</a></h2>
<p>MSL allows defining helper functions. Those functions can then be used in expressions.</p>
<p>Helper functions are defined using the following syntax:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">exists_balance</span><span class="token operator">&lt;</span><span class="token class-name">Currency</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> exists</span><span class="token operator">&lt;</span><span class="token class-name">Balance</span><span class="token operator">&lt;</span><span class="token class-name">Currency</span><span class="token operator">&gt;&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As seen in the example, helper functions can be generic. Moreover, they can access global state.</p>
<p>Definitions of helper functions are neutral regarding whether they apply to
a <a href="#pre-and-post-state">pre- or post-state</a>. They are evaluated in the currently active state. For
instance, in order to see whether a balance existed in the pre-state, one
uses <code>old(exists_balance&lt;Currency&gt;(a))</code>. Consequently, the expression <code>old(..)</code> is not allowed
within the definition of a helper function.</p>
<p>Helper functions are partial functions; see the discussion of <a href="#partial-semantics">partial semantics</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="uninterpreted-functions">Uninterpreted functions<a href="#uninterpreted-functions" class="hash-link" aria-label="Uninterpreted functions への直接リンク" title="Uninterpreted functions への直接リンク">​</a></h3>
<p>A helper function can be defined as <strong>uninterpreted</strong> by simply omitting its body:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">something</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>An uninterpreted function is one of the prover is allowed to assign some arbitrary meaning to, as long
as it is consistent within a given verification context. Uninterpreted functions are a useful tool
for abstraction in specifications (see also <a href="#abstract-specifications">abstract specifications</a>).</p>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="axioms">Axioms<a href="#axioms" class="hash-link" aria-label="Axioms への直接リンク" title="Axioms への直接リンク">​</a></h3>
<p>The meaning of helper functions can be further constrained by using <strong>axioms</strong>. Currently, axioms
must be contained in module spec blocks:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    axiom forall x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">something</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> x </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Axioms should be used with care as they can introduce unsoundness in the specification logic via
contradicting assumptions. The Move Prover supports a smoke test for detecting unsoundness via
the <code>--check-inconsistency</code> flag.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="let-bindings">Let bindings<a href="#let-bindings" class="hash-link" aria-label="Let bindings への直接リンク" title="Let bindings への直接リンク">​</a></h2>
<p>A spec block can contain let bindings that introduce names for expressions:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">get_R</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">account</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">signer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">R</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec get_R </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> addr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">signer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">spec_address_of</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">account</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if addr </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">ROOT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures result </span><span class="token operator">==</span><span class="token plain"> global</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In a spec block that has a pre-state and post-state (like a function specification), the <code>let name = e</code>
form will evaluate <code>e</code> in the pre-state. In order to evaluate an expression in the post-state, use <code>let post name = e</code>. In the rhs expression of this form, one can use <code>old(..)</code> to refer to the
pre-state.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="aborts_if-condition">Aborts_if condition<a href="#aborts_if-condition" class="hash-link" aria-label="Aborts_if condition への直接リンク" title="Aborts_if condition への直接リンク">​</a></h2>
<p>The <code>aborts_if</code> condition is a spec block member that can appear only in a function context. It
specifies conditions under which the function aborts.</p>
<p>In the following example, we specify that the function <code>increment</code> aborts if the <code>Counter</code> resource
does not exist at address <code>a</code> (recall that <code>a</code> is the name of the parameter of <code>increment</code>).</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if </span><span class="token operator">!</span><span class="token plain">exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If a function has more than one <code>aborts_if</code> condition, those conditions are or-ed with each other.
The evaluation of the combined aborts condition (or-ed from each individual condition) depends on
the value of the pragma <code>aborts_if_is_partial</code>. If this value is false (the default), the function
aborts <em>if and only if</em> the combined aborts condition is true. In this case, the above aborts
specification for <code>increment</code> will lead to a verification error, since there are additional
situations where <code>increment</code> can abort, namely if incrementing <code>Counter.value</code> would lead to an
overflow. To fix this, the specification can be completed like this:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma aborts_if_is_partial </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// This is the default, but added here for illustration.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if </span><span class="token operator">!</span><span class="token plain">exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">255</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the value of <code>aborts_if_is_partial</code> is true, the combined aborts condition (the or-ed individual
conditions) only <em>implies</em> that the function aborts. Formally, if <code>A</code> is the combined aborts condition, then
with <code>aborts_if_is_partial = true</code>, we have <code>A ==&gt; function_aborts</code>; otherwise we have
<code>A &lt;==&gt; function_aborts</code>. Therefore, the following does verify:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma aborts_if_is_partial </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if </span><span class="token operator">!</span><span class="token plain">exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<a name="risk-aborts-if-is-partial"></a>
<blockquote>
<p>Note that there is a certain risk in setting <code>aborts_if_is_partial</code> to true, and best practice is to avoid it in specifications of public functions and Move scripts once those are considered finalized. This is because changing the code after finalization of the spec can add new (non-trivial, undesired) abort situations the original specification did not anticipate yet will nevertheless silently pass verification.</p>
</blockquote>
<p>If no aborts condition is specified for a function, abort behavior is unspecified. The function may
or may not abort, and verification will not raise any errors, whether <code>aborts_if_is_partial</code> is set
or not. In order to state that a function never aborts, use <code>aborts_if false</code>. One can use the
pragma <code>aborts_if_is_strict</code> to change this behavior; this is equivalent to an <code>aborts_if false</code> being added to each function that does not have an explicit <code>aborts_if</code> clause.</p>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="aborts_if-condition-with-code">Aborts_if condition with code<a href="#aborts_if-condition-with-code" class="hash-link" aria-label="Aborts_if condition with code への直接リンク" title="Aborts_if condition with code への直接リンク">​</a></h3>
<p>The <code>aborts_if</code> condition can be augmented with code:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun get_value(addr: address): u64 {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts(exists&lt;Counter&gt;(addr), 3);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    borrow_global&lt;Counter&gt;(addr).value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec get_value {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if !exists&lt;Counter&gt;(addr) with 3;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is a verification error if the above function does not abort with code <code>3</code> under the given
condition.</p>
<p>In order to specify a direct VM abort, one can use the special constant <code>EXECUTION_FAILURE</code>:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun get(addr: address): &amp;Counter acquires Counter {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    borrow_global&lt;Counter&gt;(addr)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec get {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if !exists&lt;Counter&gt;(addr) with EXECUTION_FAILURE;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This same constant can be used for all other VM failures (division by zero, overflow, etc.).</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="aborts_with-condition">Aborts_with condition<a href="#aborts_with-condition" class="hash-link" aria-label="Aborts_with condition への直接リンク" title="Aborts_with condition への直接リンク">​</a></h2>
<p>The <code>aborts_with</code> condition allows specifying with which codes a function can abort, independent
under which condition. It is similar to a &#x27;throws&#x27; clause in languages like Java.</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">get_one_off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">aborts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    borrow_global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec get_one_off </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_with </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">EXECUTION_FAILURE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the function aborts with any other or none of the specified codes, a verification error will be
produced.</p>
<p>The <code>aborts_with</code> condition can be combined with <code>aborts_if</code> conditions. In this case, the <code>aborts_with</code>
specifies any other codes with which the function may abort, in addition to the ones given in the <code>aborts_if</code>:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec get_one_off </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if </span><span class="token operator">!</span><span class="token plain">exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> with </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_with </span><span class="token constant" style="color:rgb(189, 147, 249)">EXECUTION_FAILURE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If this is not wanted, and the <code>aborts_with</code> should be independent of <code>aborts_if</code>, one can use the
property <code>[check]</code>:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec get_one_off </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if </span><span class="token operator">!</span><span class="token plain">exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> with </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> with </span><span class="token constant" style="color:rgb(189, 147, 249)">EXECUTION_FAILURE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_with </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">check</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">EXECUTION_FAILURE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="requires-condition">Requires condition<a href="#requires-condition" class="hash-link" aria-label="Requires condition への直接リンク" title="Requires condition への直接リンク">​</a></h2>
<p>The <code>requires</code> condition is a spec block member that postulates a pre-condition for a function. The
Move Prover will produce verification errors for functions that are called with violating
pre-conditions.</p>
<p>A <code>requires</code> is different from an <code>aborts_if</code>: in the latter case, the function can be called, and
any aborts it produces will be propagated to the caller context. In the <code>requires</code> case, the Move Prover
will not allow the function to be called in the first place. Nevertheless, the function can <em>still
be called at runtime</em> if verification is skipped. Because of this, <code>requires</code> are rare in Move
specifications, and <code>aborts_if</code> are more common. Specifically, <code>requires</code> should be avoided for public APIs.</p>
<p>An example of <code>requires</code> is:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requires global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">255</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="ensures-condition">Ensures condition<a href="#ensures-condition" class="hash-link" aria-label="Ensures condition への直接リンク" title="Ensures condition への直接リンク">​</a></h2>
<p>The <code>ensures</code> condition postulates a post-condition for a function that must be satisfied when the
function terminates successfully (i.e. does not abort). The Move Prover will verify each <code>ensures</code> to
this end.</p>
<p>An example for the <code>ensures</code> condition is the following:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">old</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Within the expression for the <code>ensures</code> condition, one can use the <code>old</code> function, as discussed in
<a href="#pre-and-post-state">Pre and post state</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="modifies-condition">Modifies condition<a href="#modifies-condition" class="hash-link" aria-label="Modifies condition への直接リンク" title="Modifies condition への直接リンク">​</a></h2>
<p>The <code>modifies</code> condition is used to provide permissions to a function to modify global storage. The
annotation itself comprises a list of global access expressions. It is specifically used together
with <a href="#opaque-specifications">opaque function specifications</a>.</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token type-definition class-name">S</span><span class="token plain"> has </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">mutate_at</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> acquires </span><span class="token class-name">S</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> s </span><span class="token operator">=</span><span class="token plain"> borrow_global_mut</span><span class="token operator">&lt;</span><span class="token class-name">S</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">x </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec mutate_at </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma opaque</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    modifies global</span><span class="token operator">&lt;</span><span class="token class-name">S</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In general, a global access expression has the form <code>global&lt;type_expr&gt;(address_expr)</code>. The
address-valued expression is evaluated in the pre-state of the annotated function.</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">read_at</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"> acquires </span><span class="token class-name">S</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> s </span><span class="token operator">=</span><span class="token plain"> borrow_global</span><span class="token operator">&lt;</span><span class="token class-name">S</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">x</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">mutate_S_test</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> addr2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> acquires </span><span class="token class-name">T</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr1 </span><span class="token operator">!=</span><span class="token plain"> addr2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">43</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> x </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">read_at</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">mutate_at</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Note we are mutating a different address than the one read before and after</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    x </span><span class="token operator">==</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">read_at</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec mutate_S_test </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if addr1 </span><span class="token operator">==</span><span class="token plain"> addr2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures result </span><span class="token operator">==</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the function <code>mutate_S_test</code>, the assertion in the spec block is expected to hold. A benefit of
the modifies specification on <code>mutate_at</code> is that this assertion can be proved whether <code>mutate_at</code> is inlined.</p>
<p>If the modifies annotation is omitted on a function, then that function is deemed to have all
possible permissions for those resources it may modify during its execution. The set of all
resources that may be modified by a function is obtained via an interprocedural analysis of the
code. In the example above, <code>mutate_S_test</code> does not have a modifies specification and modifies
resource <code>S</code> via the call to <code>mutate_at</code>. Therefore, it is considered to have modified <code>S</code> at any
possible address. Instead, if the programmer adds <code>modifies global&lt;S&gt;(addr1)</code>
to the specification of <code>mutate_S_test</code>, then the call to <code>mutate_at</code> is checked to make sure that
modify permissions granted to <code>mutate_S_test</code> cover the permissions it grants to <code>mutate_at</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="invariant-condition">Invariant condition<a href="#invariant-condition" class="hash-link" aria-label="Invariant condition への直接リンク" title="Invariant condition への直接リンク">​</a></h2>
<p>The invariant condition can be applied on structs and on global level.</p>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="function-invariants">Function invariants<a href="#function-invariants" class="hash-link" aria-label="Function invariants への直接リンク" title="Function invariants への直接リンク">​</a></h3>
<p>The <code>invariant</code> condition on a function is simply a shortcut for a <code>requires</code> and <code>ensures</code> with the
same predicate.</p>
<p>Thus, the following spec block:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invariant global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">128</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>... is equivalent to:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    requires global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">128</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">128</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="struct-invariants">Struct invariants<a href="#struct-invariants" class="hash-link" aria-label="Struct invariants への直接リンク" title="Struct invariants への直接リンク">​</a></h3>
<p>When the <code>invariant</code> condition is applied to a struct, it expresses a well-formedness property of
the struct data. Any instance of this struct that is currently not mutated will satisfy this
property (with exceptions as outlined below).</p>
<p>For example, we can postulate an invariant on our counter that it never must exceed the value of
127:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invariant value </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">128</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A struct invariant is checked by the Move Prover whenever the struct value is constructed (packed). While
the struct is mutated (e.g. via a <code>&amp;mut Counter</code>) the invariant does <em>not</em> hold (but see exception
below). In general, we consider mutation as an implicit unpack, and end of mutation as a pack.</p>
<p>The Move language semantics unambiguously identifies the point when mutation ends and starts. This
follows from the borrow semantics of Move and includes mutation via an enclosing struct.
(The mutation of an inner struct ends when the mutation of the root struct where mutation started
ends.)</p>
<p>There is one exception to this rule. When a mutable reference to a struct declared in module M is
passed into a <em>public</em> function of M which does by itself <em>not</em> return any other mutable reference (which could be borrowed from the input parameter), we treat this parameter as &quot;packed&quot;. That means, on function entry, we will unpack it and on function exit we will pack again, enforcing the invariant. This reflects that in Move, struct data can be mutated only within the module that declares the struct; so for an outside caller of the public function, the mutable reference can actually not be mutated unless by calling public functions of module M again. It is a significant simplification of the verification problem to exploit this in the semantics.</p>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="global-invariants">Global invariants<a href="#global-invariants" class="hash-link" aria-label="Global invariants への直接リンク" title="Global invariants への直接リンク">​</a></h3>
<p>A global invariant appears as a member of module. It can express a condition over the global state
of the Move program, as represented by resources stored in memory. For example, the below invariant
states that a <code>Counter</code> resource stored at any given address can never be zero:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token module-declaration namespace">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">M</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invariant forall a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> addr where exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A global invariant is assumed to hold when data is read from the global state, and is asserted (and
may fail to verify) at the moment the state is updated. For example, the below function will never abort with arithmetic underflow because the counter value is always greater than zero; however, it will create a verification error since the counter can drop to zero:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun decrement_ad(addr: address) acquires Counter {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let counter = borrow_global_mut&lt;Counter&gt;(addr);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let new_value = counter.value - 1;   // Will not abort because counter.value &gt; 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    *counter.value = new_value;          // Fails verification since value can drop to zero</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_pM13" id="disabling-invariants">Disabling invariants<a href="#disabling-invariants" class="hash-link" aria-label="Disabling invariants への直接リンク" title="Disabling invariants への直接リンク">​</a></h4>
<p>There are times when a global invariant holds almost everywhere, except for a brief interval inside a function. In current Move code, this often occurs when something (e.g. an account) is being set up and
several structs are published together. Almost everywhere, an invariant holds that all the structs are published or none of them are. But the code that publishes the structs must do so sequentially. While the structs are being published, there will be a point where some are published and others are not.</p>
<p>In order to verify invariants that hold except during small regions, there is a feature to allow users to disable invariants temporarily. Consider the following code fragment:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fn </span><span class="token function" style="color:rgb(80, 250, 123)">setup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">publish1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">publish2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where <code>publish1</code> and <code>publish2</code> publish two different structs, <code>T1</code> and <code>T2</code> at address <code>a</code>.</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token module-declaration namespace">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">M</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invariant </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">global</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> exists</span><span class="token operator">&lt;</span><span class="token constant" style="color:rgb(189, 147, 249)">T1</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> exists</span><span class="token operator">&lt;</span><span class="token constant" style="color:rgb(189, 147, 249)">T2</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As written, the Move Prover will report that the invariant is violated after the call to <code>publish1</code> and before the call to <code>publish2</code>. If either of <code>publish1</code> or <code>publish2</code> is without the other, the Move Prover
will also report a violation of the invariant.</p>
<p>By default, a global invariant is checked immediately after the instruction <code>I</code> that touches the resources mentioned in the global invariant. The <code>[suspendable]</code> attribute (at the invariant side) together with two pragmas (specified in function spec block) provide fine-grained control on where we hope this invariant to be checked:</p>
<ul>
<li><code>disable_invariants_in_body</code>: the invariant will be checked at the end of the function where <code>I</code> resides.</li>
<li><code>delegate_invariants_to_caller</code>: the invariant will be checked by all callers of the function where <code>I</code> resides.</li>
</ul>
<p>For the example above, we can add the pragma <code>disable_invariants_in_body</code>:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec setup </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma disable_invariants_in_body</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>which says that invariants are not required to hold while <code>setup</code> is executing but are assumed to hold on entry to and exit from <code>setup</code>.</p>
<p>This pragma changes the Move Prover&#x27;s behavior. The invariants are assumed on entry to <code>setup</code> but not proved during or after <code>publish1</code> and <code>publish2</code>. Instead, all invariants that could be invalidated in the
body of <code>setup</code> are asserted and proved at the point of return from <code>setup</code>. A consequence of this processing is that the user may need to provide stronger post-conditions on <code>publish1</code> and <code>publish2</code> to
make it possible to prove the invariants on exit from <code>setup</code>.</p>
<p>Another consequence of this processing is that invariants cannot safely be assumed to hold during the execution of <code>publish1</code> and <code>publish2</code> (unless nothing in the body of <code>setup</code> changes state
mentioned in the invariant). Therefore, if proving a post-condition requires the invariant to be assumed, the post-condition will fail.</p>
<p>In the example, invariants hold at the call sites of <code>setup</code> but not in the body. For <code>publish1</code>, invariants don&#x27;t necessarily hold at the call site <em>or</em> in the body of the function. In the example, that
behavior is implied because <code>publish1</code> is called in a context where invariants are disabled.</p>
<p>When invariants are disabled in <code>setup</code> in the above example, the Move Prover cannot assume them on entry to <code>publish1</code> and <code>publish2</code> and should not try to prove them on exit from those functions. The Move Prover
would have the same behavior for any functions called by <code>publish1</code> or <code>publish2</code>. The Move Prover <em>automatically</em> adopts this behavior when invariants are disabled in a calling function, but it is possible for the user to declare that a function be treated like <code>publish1</code>.</p>
<p>For example, if <code>publish2</code> is <em>only</em> called from the setup function above, and we did <em>not</em> disable invariants in <code>setup</code>, we could achieve a similar effect by using the pragma <code>delegate_invariants_to_caller</code>, instead.</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec setup </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma delegate_invariants_to_caller</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This would be legal only if <code>setup</code> is a private or <code>public (friend)</code> function. The difference between this and disabling invariants in <code>setup</code> is that the invariants would not be assumed at the beginning of <code>setup</code> and would be proved after <code>setup</code> returns at each site where it is called.</p>
<p>While both pragmas disable invariants in the body of a function, the difference is that <code>disable_invariants_in_body</code> assumes invariants on entry and proves them on exit, while <code>delegate_invariants_to_caller</code> does neither.</p>
<p>There are some limitations on how these pragmas can be used. <code>disable_invariants_in_body</code> cannot be declared for functions where invariants are delegated to a caller, either explicitly via the pragma
or implicitly because the function is called in a context where invariants have been disabled. (This restriction is to ensure consistent processing, because on pragma assumes that invariants hold
in the calling context and the other does not). Second, it is illegal for a public or script function to delegate invariant checking to its callers (since the Move Prover does not know all the call sites), <em>unless</em> the function cannot possibly invalidate an invariant because it doesn&#x27;t change any of the state mentioned in <code>exists</code> and <code>global</code> expressions appearing in the invariant.</p>
<h4 class="anchor anchorWithStickyNavbar_pM13" id="update-invariants">Update invariants<a href="#update-invariants" class="hash-link" aria-label="Update invariants への直接リンク" title="Update invariants への直接リンク">​</a></h4>
<p>The <code>update</code> form of a global invariant allows to express a relation between <a href="#pre-and-post-state">pre-state and post-state</a> of a global state update. For example, the following invariant states that the counter must decrease monotonically whenever it is updated:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token module-declaration namespace">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">M</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invariant update </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">global</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> forall a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> addr where </span><span class="token function" style="color:rgb(80, 250, 123)">old</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">old</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_pM13" id="isolated-global-invariants">Isolated global invariants<a href="#isolated-global-invariants" class="hash-link" aria-label="Isolated global invariants への直接リンク" title="Isolated global invariants への直接リンク">​</a></h4>
<p>A global invariant can be marked as <code>[isolated]</code> to indicate that it is not relevant for proving
other properties of the program. An isolated global invariant will not be assumed when the related
global state is read. It will only be assumed before the state is updated to help prove that the
invariant still holds after the update. This feature is for improving performance in situations
where there are many global invariants, but they have no direct influence on verification.</p>
<h4 class="anchor anchorWithStickyNavbar_pM13" id="modular-verification-and-global-invariants">Modular verification and global invariants<a href="#modular-verification-and-global-invariants" class="hash-link" aria-label="Modular verification and global invariants への直接リンク" title="Modular verification and global invariants への直接リンク">​</a></h4>
<p>Certain usage of global invariants leads to verification problems that cannot be checked in a modular fashion. &quot;Modular&quot; here means that a module can be verified standalone and proven to be universally correct in all usage contexts (if preconditions are met).</p>
<p>A non-modular verification problem may arise if a global invariant refers to state from multiple modules. Consider a situation where module <code>M1</code> uses module <code>M2</code>, and <code>M1</code> contains the following invariant, with the helper function <code>condition</code> referring to global state of each respective module:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token module-declaration namespace">addr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token constant" style="color:rgb(189, 147, 249)">M1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invariant </span><span class="token constant" style="color:rgb(189, 147, 249)">M1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">condition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">M2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">condition</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When we verify <code>M1</code> standalone, the Move Prover will determine that it also needs to verify functions in <code>M2</code>, namely those which update the M2 memory such that the invariant in M1 can fail.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="assume-and-assert-conditions-in-code">Assume and assert conditions in code<a href="#assume-and-assert-conditions-in-code" class="hash-link" aria-label="Assume and assert conditions in code への直接リンク" title="Assume and assert conditions in code への直接リンク">​</a></h2>
<p>A spec block might also occur anywhere an ordinary Move statement block can occur.
Here is an example:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun simple1(x: u64, y: u64) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let z;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    y = x;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    z = x + y;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assert x == y;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assert z == 2*x;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコー  ドをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In such inline spec blocks, only a subset of conditions are permitted:</p>
<ul>
<li><code>assume</code> and <code>assert</code> statements are allowed in any code locations.</li>
<li>loop <code>invariant</code> statements are allowed only in code locations that represent loop headers.</li>
</ul>
<p>An assert statement inside a spec block indicates a condition that must hold when control reaches
that block. If the condition does not hold, an error is reported by the Move Prover. An <code>assume</code>
statement, on the other hand, blocks executions violating the condition in the statement. The
function <code>simple2</code> shown below is verified by the Move Prover. However, if the first spec block
containing the assume statement is removed, Move Prover will show a violation to the <code>assert</code>
statement in the second spec block.</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun simple2(x: u64, y: u64) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let z: u64;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assume x &gt; y;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    z = x + y;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assert z &gt; 2*y;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="loop-invariants">Loop invariants<a href="#loop-invariants" class="hash-link" aria-label="Loop invariants への直接リンク" title="Loop invariants への直接リンク">​</a></h3>
<p>An <code>invariant</code> statement encodes a loop invariant and must be placed at a loop head, as in the
following example:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun simple3(n: u64) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let x = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    loop {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        spec {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            invariant x &lt;= n;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (x &lt; n) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            x = x + 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            break</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assert x == n;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A loop invariant is translated into two <code>assert</code> statements and one <code>assume</code> statement to facilitate the inductive reasoning of properties about the loop. In break down, a loop invariant is translated to:</p>
<ul>
<li>An <code>assert</code> statement that confirms the invariant holds when the loop is first encountered in the
execution -- establishing the base case.</li>
<li>An <code>assume</code> statement that encodes the property that the invariant holds at loop iteration <code>I</code>.</li>
<li>An <code>assert</code> statement that checks whether the invariant continues to hold at loop iteration <code>I+1</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="referring-to-pre-state">Referring to pre-state<a href="#referring-to-pre-state" class="hash-link" aria-label="Referring to pre-state への直接リンク" title="Referring to pre-state への直接リンク">​</a></h3>
<p>Occasionally, we would like to refer to the pre-state of a mutable function argument in inline spec
blocks. In MSL, this can be done with the <code>old(T)</code> expression. Similar to the semantics of <code>old(..)</code>
in post conditions, an <code>old(T)</code> expression in an <code>assume</code> or <code>assert</code> statement always yields the
value of <code>T</code> at the function entry point. Here is an example that illustrate the use of
<code>old(..)</code> in an inline spec block:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun swap(x: &amp;mut u64, y: &amp;mut u64) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let t = *x;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    *x = *y;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    *y = t;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    spec {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assert x == old(y);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assert y == old(x);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The above example is trivial as the same property can be expressed with post conditions
(i.e., <code>ensures</code>) too. But there are cases where we must use <code>old(..)</code> to refer to the pre-state, especially in the specification of loop invariants. Consider the following example
where we verify that the <code>vector_reverse</code> function properly reverses the order of all elements
in a vector:</p>
<div class="codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-text codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun verify_reverse&lt;Element&gt;(v: &amp;mut vector&lt;Element&gt;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let vlen = vector::length(v);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (vlen == 0) return ();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let front_index = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    let back_index = vlen -1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    while ({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        spec {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assert front_index + back_index == vlen - 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assert forall i in 0..front_index: v[i] == old(v)[vlen-1-i];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assert forall i in 0..front_index: v[vlen-1-i] == old(v)[i];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assert forall j in front_index..back_index+1: v[j] == old(v)[j];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assert len(v) == vlen;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        (front_index &lt; back_index)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        vector::swap(v, front_index, back_index);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        front_index = front_index + 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        back_index = back_index - 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec verify_reverse {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures forall i in 0..len(v): v[i] == old(v)[len(v)-1-i];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note the usage of <code>old(v)</code> in the loop invariants. Without them, it is hard to express the
invariant that the vector is partially reversed while the loop is iterating and the rest
remain unchanged.</p>
<p>However, unlike the <code>old(T)</code> expressions in <code>ensures</code> conditions where <code>T</code> can be any valid
expression (e.g., <code>old(v[i])</code> is allowed), the <code>old(T)</code> expressions in <code>assert</code> and <code>assumes</code>
statements accept only a single variable as <code>T</code> and that variable must be a function argument of
a mutable reference type. In the above example, <code>old(v[i])</code> is not allowed, and we should use
<code>old(v)[i]</code> instead.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="specification-variables">Specification variables<a href="#specification-variables" class="hash-link" aria-label="Specification variables への直接リンク" title="Specification variables への直接リンク">​</a></h2>
<p>MSL supports <em>spec variables</em>, also called <em>ghost variables</em> in the verification community. These
variables are used only in specifications and represent information derived from the global state of
resources. An example use case is to compute the sum of all coins available in the system and
specify that the sum can be changed only in certain scenarios.</p>
<p>We illustrate this feature by introducing a spec variable that maintains the sum of all <code>Counter</code>
resources from our running example. First, a spec variable is introduced via spec module block as
follows:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global sum_of_counters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This value is going to be updated whenever a <code>Counter</code> is packed or unpacked. (Recall that mutation
is interpreted as an implicit unpack and pack):</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invariant pack sum_of_counters </span><span class="token operator">=</span><span class="token plain"> sum_of_counters </span><span class="token operator">+</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invariant unpack sum_of_counters </span><span class="token operator">=</span><span class="token plain"> sum_of_counters </span><span class="token operator">-</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>TODO: <code>invariant pack</code> and <code>invariant unpack</code> are currently not implemented</p>
</blockquote>
<p>Now we may for example want to specify that the sum of all Counter instances in the global state
should never exceed a particular value. We can do this as follows:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invariant </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">global</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> sum_of_counters </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">4711</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that spec variables can also be referenced from helper functions. Moreover, spec variables can
be generic:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    global some_generic_var</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When using such a spec variable, a type parameter must be provided, as in <code>some_generic_var&lt;u64&gt;</code>. Effectively, a generic spec variable is like a family of variables indexed by types.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="schemas">Schemas<a href="#schemas" class="hash-link" aria-label="Schemas への直接リンク" title="Schemas への直接リンク">​</a></h2>
<p>Schemas are a means for structuring specifications by grouping properties together. Semantically,
they are just syntactic sugar that expand to conditions on functions, structs, or modules.</p>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="basic-schema-usage">Basic Schema Usage<a href="#basic-schema-usage" class="hash-link" aria-label="Basic Schema Usage への直接リンク" title="Basic Schema Usage への直接リンク">​</a></h3>
<p>Schemas are used as such:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec schema </span><span class="token class-name">IncrementAborts</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if </span><span class="token operator">!</span><span class="token plain">exists</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">255</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    include </span><span class="token class-name">IncrementAborts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Each schema may declare a number of typed variable names and a list of conditions over those
variables. All supported condition types can be used in schemas. The schema can then be included in
another spec block:</p>
<ul>
<li>If that spec block is for a function or a struct, all variable names the schema declares must be
matched against existing names of compatible type in the context.</li>
<li>If a schema is included in another schema, existing names are matched and must have the same type,
but non-existing names will be added as new declarations to the inclusion context.</li>
</ul>
<p>When a schema is included in another spec block, it will be checked whether the conditions it
contains are allowed in this block. For example, including the schema <code>IncrementAborts</code> into a
struct spec block will lead to a compile-time error.</p>
<p>When a schema is included, the names it declares can also bound by expressions. For example, one can
write <code>include IncrementAborts{a: some_helper_address()}</code>. Effectively, not providing a binding is
equivalent to writing <code>IncrementAborts{a: a}</code> if <code>a</code> is an existing name in scope.</p>
<p>Schemas can be generic. Generic schemas must be fully instantiated where they are included; type
inference is not available for schemas.</p>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="schema-expressions">Schema expressions<a href="#schema-expressions" class="hash-link" aria-label="Schema expressions への直接リンク" title="Schema expressions への 直接リンク">​</a></h3>
<p>When a schema is included, one can use a limited set of Boolean operators as follows:</p>
<ul>
<li><code>P ==&gt; SchemaExp</code>: all conditions in the schema will be prefixed with <code>P ==&gt; ..</code>. Conditions that
are not based on Boolean expressions will be rejected.</li>
<li><code>if (P) SchemaExp1 else SchemaExp2</code>: this is treated similar to including both
<code>P ==&gt; SchemaExp1</code> and <code>!P ==&gt; SchemaExp2</code>.</li>
<li><code>SchemaExp1 &amp;&amp; SchemaExp2</code>: this is treated as two includes for both schema expressions.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_pM13" id="schema-apply-operation">Schema apply operation<a href="#schema-apply-operation" class="hash-link" aria-label="Schema apply operation への直接リンク" title="Schema apply operation への直接リンク">​</a></h3>
<p>One of the main use cases for schemas is to be able to name a group of properties and then apply
those to a set of functions. This is achieved by the <code>apply</code> operator. The <code>apply</code> spec block member
can appear only in module spec blocks.</p>
<p>The general form of the apply operator is <code>apply Schema to FunctionPattern, .. except FunctionPattern, ..</code>. Here, <code>Schema</code> can be a schema name or a schema name plus formal type arguments. <code>FunctionPatterns</code> consists of an optional visibility modifier <code>public</code> or <code>internal</code> (if not provided, both visibilities will match), a name pattern in the style of a shell file pattern ( e.g. <code>*</code>, <code>foo*</code>, <code>foo*bar</code>, etc.), and finally an optional type argument list. All type arguments provided to <code>Schema</code> must be bound
in this list and vice versa.</p>
<p>The <code>apply</code> operator includes the given schema in all function spec blocks that match the patterns,
except those excluded via the <code>except</code> patterns.</p>
<p>A typical use of the <code>apply</code> operator is to provide common pre-conditions and post-conditions to all functions in
a module with some exceptions. Example:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec schema </span><span class="token class-name">Unchanged</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> resource </span><span class="token operator">=</span><span class="token plain"> global</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token constant" style="color:rgb(189, 147, 249)">ADDR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures resource </span><span class="token operator">==</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">old</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">resource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Enforce Unchanged for all functions except the initialize function.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    apply </span><span class="token class-name">Unchanged</span><span class="token plain"> to </span><span class="token operator">*</span><span class="token plain"> except initialize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Notice that while with <a href="#global-invariants">global invariants</a> we can express similar things, we <em>cannot</em>
express the restriction of the invariant to only specific functions.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="opaque-specifications">Opaque specifications<a href="#opaque-specifications" class="hash-link" aria-label="Opaque specifications への直接リンク" title="Opaque specifications への直接リンク">​</a></h2>
<p>With the pragma <code>opaque</code>, a function is declared to be solely defined by its specification at caller
sides. In contrast, if this pragma is not provided, then the function&#x27;s implementation will be used
as the basis to verify the caller.</p>
<p>Using <code>opaque</code> requires the specification to be sufficiently complete for the verification problem at hand. Without <code>opaque</code>, the Move Prover will use the implementation as the source of truth for the definition of the function. But with <code>opaque</code>, if there is an aspect of the function definition unspecified, an arbitrary meaning will be assumed. For example, with the specification below, the <code>increment</code> function can abort under arbitrary conditions:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec increment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma opaque</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// aborts_if !exists&lt;Counter&gt;(a);  // We need to add this to make the function not abort arbitrarily</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">old</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">global</span><span class="token operator">&lt;</span><span class="token class-name">Counter</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In general, <code>opaque</code> functions enable modular verification, as they abstract from the implementation
of functions, resulting in much faster verification.</p>
<p>If an <code>opaque</code> function modifies state, it is advised to use the <a href="#modifies-condition"><code>modifies</code> condition</a> in its specification. If this is omitted, verification of the state changes will fail.</p>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="abstract-specifications">Abstract specifications<a href="#abstract-specifications" class="hash-link" aria-label="Abstract specifications への直接リンク" title="Abstract specifications への直接リンク">​</a></h2>
<p>The <code>[abstract]</code> property allows specifying a function such that abstract semantics are used at the
caller side that is different from the actual implementation. This is useful if the implementation
is too complex for verification, and abstract semantics are sufficient for verification goals.
The <code>[concrete]</code> property, in turn, still allows specifying conditions that are verified against
the implementation but not used at the caller side.</p>
<p>Consider the following example of a hash function. The actual value of the hash is not relevant for
verification of callers, and we use an <a href="#uninterpreted-functions">uninterpreted helper function</a> delivering an arbitrary value chosen by the Move Prover. We can still specify the concrete implementation and verify its correctness:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">vector</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">&lt;&lt;</span><span class="token plain">sum up values</span><span class="token operator">&gt;&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec hash </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma opaque</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    aborts_if </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">concrete</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> result </span><span class="token operator">==</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token plain">sum up values</span><span class="token operator">&gt;&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">abstract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> result </span><span class="token operator">==</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">spec_hash_abstract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">abstract_hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">vector</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// uninterpreted function</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The soundness of the abstraction is the responsibility of the specifier and not verified by the
Move Prover.</p>
<blockquote>
<p>NOTE: The abstract/concrete properties should only be used with opaque specifications, but the Move Prover will currently not generate an error message even though they are not used with opaque specifications.</p>
</blockquote>
<blockquote>
<p>NOTE: The <code>modifies</code> clause does not currently support abstract/concrete. Also, if no modifies is given, the modified state will be computed from the implementation anyway, possibly conflicting with <code>[abstract]</code> properties.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="documentation-generation">Documentation generation<a href="#documentation-generation" class="hash-link" aria-label="Documentation generation への直接リンク" title="Documentation generation への直接リンク">​</a></h2>
<p>The organization of specification blocks in a file is relevant for documentation generation -- even
though it is not for the semantics.</p>
<h1>Expressiveness</h1>
<p>The Move specification language is expressive enough to represent the full Move language semantics (formal argument outstanding) with one exception: functions that return a <code>&amp;mut T</code> type.</p>
<p>Consider the following code:</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token type-definition class-name">S</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">x_or_y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">x </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">y</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec x_or_y </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures b </span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token plain"> result </span><span class="token operator">==</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures </span><span class="token operator">!</span><span class="token plain">b </span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token plain"> result </span><span class="token operator">==</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We are not able to specify the <em>full</em> semantics of <code>x_or_y</code> in MSL because we cannot capture the
semantics of mutable references. While we can say something about the value behind the reference at
function exit, subsequent effects as in <code>*x_or_y(b, &amp;mut s) = 2</code> cannot be specified.</p>
<p>However, the Move Prover <em>does</em> understand the meaning of such functions -- the restriction is only
in what we can specify. Practically, this means we cannot make the function <code>x_or_y</code> opaque and must
let verification rely on that the Move Prover directly works with the implementation. Specifically, we
can verify the following (which can then be opaque):</p>
<div class="language-move codeBlockContainer_YU8y theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_Z3Eu"><pre tabindex="0" class="prism-code language-move codeBlock_TXgN thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_Szw2"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fun</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">x_or_y_test</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">*</span><span class="token function" style="color:rgb(80, 250, 123)">x_or_y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spec x_or_y_test </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pragma opaque</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">x </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ensures result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">y </span><span class="token operator">==</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_YI7t"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_KVkY" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon__tFq"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VZKC"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_pM13" id="supporting-resources">Supporting resources<a href="#supporting-resources" class="hash-link" aria-label="Supporting resources への直接リンク" title="Supporting resources への直接リンク">​</a></h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Design_by_contract" target="_blank" rel="noopener noreferrer">Design by contract PRE_POST_REFERENCE</a></li>
<li><a href="https://github.com/aptos-labs/aptos-core/blob/main/aptos-move/framework/aptos-framework/doc/overview.md" target="_blank" rel="noopener noreferrer">APTOS_FRAMEWORK</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/move/prover/spec-lang.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_l3kn" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_nZMy"><span class="theme-last-updated"><b><time datetime="2024-04-16T14:16:34.000Z">2024年4月16日</time></b>に<!-- -->最終更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/move/prover/prover-guide"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">Move Proverユーザーガイド</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/move/prover/supporting-resources"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">Supporting Resources</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_HHZg thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#type-system" class="table-of-contents__link toc-highlight">Type System</a></li><li><a href="#naming" class="table-of-contents__link toc-highlight">Naming</a></li><li><a href="#operators" class="table-of-contents__link toc-highlight">Operators</a></li><li><a href="#function-calls" class="table-of-contents__link toc-highlight">Function calls</a></li><li><a href="#statements" class="table-of-contents__link toc-highlight">Statements</a></li><li><a href="#pack-and-unpack" class="table-of-contents__link toc-highlight">Pack and unpack</a></li><li><a href="#quantifiers" class="table-of-contents__link toc-highlight">Quantifiers</a></li><li><a href="#choice-operator" class="table-of-contents__link toc-highlight">Choice operator</a></li><li><a href="#cast-operator" class="table-of-contents__link toc-highlight">Cast operator</a></li><li><a href="#shift-operator" class="table-of-contents__link toc-highlight">Shift operator</a></li><li><a href="#bitwise-operators" class="table-of-contents__link toc-highlight">Bitwise operators</a></li><li><a href="#built-in-functions" class="table-of-contents__link toc-highlight">Built-in functions</a></li><li><a href="#partial-semantics" class="table-of-contents__link toc-highlight">Partial semantics</a></li><li><a href="#separating-specifications" class="table-of-contents__link toc-highlight">Separating specifications</a></li><li><a href="#pragmas-and-properties" class="table-of-contents__link toc-highlight">Pragmas and properties</a><ul><li><a href="#pragma-inheritance" class="table-of-contents__link toc-highlight">Pragma inheritance</a></li><li><a href="#general-pragmas-and-properties" class="table-of-contents__link toc-highlight">General pragmas and properties</a></li></ul></li><li><a href="#pre-and-post-state" class="table-of-contents__link toc-highlight">Pre and post state</a></li><li><a href="#helper-functions" class="table-of-contents__link toc-highlight">Helper functions</a><ul><li><a href="#uninterpreted-functions" class="table-of-contents__link toc-highlight">Uninterpreted functions</a></li><li><a href="#axioms" class="table-of-contents__link toc-highlight">Axioms</a></li></ul></li><li><a href="#let-bindings" class="table-of-contents__link toc-highlight">Let bindings</a></li><li><a href="#aborts_if-condition" class="table-of-contents__link toc-highlight">Aborts_if condition</a><ul><li><a href="#aborts_if-condition-with-code" class="table-of-contents__link toc-highlight">Aborts_if condition with code</a></li></ul></li><li><a href="#aborts_with-condition" class="table-of-contents__link toc-highlight">Aborts_with condition</a></li><li><a href="#requires-condition" class="table-of-contents__link toc-highlight">Requires condition</a></li><li><a href="#ensures-condition" class="table-of-contents__link toc-highlight">Ensures condition</a></li><li><a href="#modifies-condition" class="table-of-contents__link toc-highlight">Modifies condition</a></li><li><a href="#invariant-condition" class="table-of-contents__link toc-highlight">Invariant condition</a><ul><li><a href="#function-invariants" class="table-of-contents__link toc-highlight">Function invariants</a></li><li><a href="#struct-invariants" class="table-of-contents__link toc-highlight">Struct invariants</a></li><li><a href="#global-invariants" class="table-of-contents__link toc-highlight">Global invariants</a></li></ul></li><li><a href="#assume-and-assert-conditions-in-code" class="table-of-contents__link toc-highlight">Assume and assert conditions in code</a><ul><li><a href="#loop-invariants" class="table-of-contents__link toc-highlight">Loop invariants</a></li><li><a href="#referring-to-pre-state" class="table-of-contents__link toc-highlight">Referring to pre-state</a></li></ul></li><li><a href="#specification-variables" class="table-of-contents__link toc-highlight">Specification variables</a></li><li><a href="#schemas" class="table-of-contents__link toc-highlight">Schemas</a><ul><li><a href="#basic-schema-usage" class="table-of-contents__link toc-highlight">Basic Schema Usage</a></li><li><a href="#schema-expressions" class="table-of-contents__link toc-highlight">Schema expressions</a></li><li><a href="#schema-apply-operation" class="table-of-contents__link toc-highlight">Schema apply operation</a></li></ul></li><li><a href="#opaque-specifications" class="table-of-contents__link toc-highlight">Opaque specifications</a></li><li><a href="#abstract-specifications" class="table-of-contents__link toc-highlight">Abstract specifications</a></li><li><a href="#documentation-generation" class="table-of-contents__link toc-highlight">Documentation generation</a></li><li><a href="#supporting-resources" class="table-of-contents__link toc-highlight">Supporting resources</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <div class="footer-left">
                  <a class="footer-logo" href="https://aptosfoundation.org" target="_blank" rel="noopener noreferrer" title="Aptos Foundation">
                    <svg width="100%" height="100%" version="1.2" baseProfile="tiny" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 112 112" overflow="visible" xml:space="preserve"><path fill="currentColor" d="M86.6 37.4h-9.9c-1.1 0-2.2-.5-3-1.3l-4-4.5c-1.2-1.3-3.1-1.4-4.5-.3l-.3.3-3.4 3.9c-1.1 1.3-2.8 2-4.5 2H2.9C1.4 41.9.4 46.6 0 51.3h51.2c.9 0 1.8-.4 2.4-1l4.8-5c.6-.6 1.4-1 2.3-1h.2c.9 0 1.8.4 2.4 1.1l4 4.5c.8.9 1.9 1.4 3 1.4H112c-.4-4.7-1.4-9.4-2.9-13.8H86.6zM53.8 65l-4-4.5c-1.2-1.3-3.1-1.4-4.5-.3l-.3.3-3.5 3.9c-1.1 1.3-2.7 2-4.4 2H.8c.9 4.8 2.5 9.5 4.6 14h25.5c.9 0 1.7-.4 2.4-1l4.8-5c.6-.6 1.4-1 2.3-1h.2c.9 0 1.8.4 2.4 1.1l4 4.5c.8.9 1.9 1.4 3 1.4h56.6c2.1-4.4 3.7-9.1 4.6-14H56.8c-1.2 0-2.3-.5-3-1.4zm19.6-43.6 4.8-5c.6-.6 1.4-1 2.3-1h.2c.9 0 1.8.4 2.4 1l4 4.5c.8.9 1.9 1.3 3 1.3h10.8c-18.8-24.8-54.1-29.7-79-11-4.1 3.1-7.8 6.8-11 11H71c1 .2 1.8-.2 2.4-.8zM34.7 94.2c-1.2 0-2.3-.5-3-1.3l-4-4.5c-1.2-1.3-3.2-1.4-4.5-.2l-.2.2-3.5 3.9c-1.1 1.3-2.7 2-4.4 2h-.2C36 116.9 71.7 118 94.4 96.7c.9-.8 1.7-1.7 2.6-2.6H34.7z"/></svg>
                  </a>
                  <div class="copyright">
                    <p class="copyright-text">© 2024 Aptos Foundation</p>
                    <div class="copyright-links">
                      <a href="https://aptosfoundation.org/privacy" target="_blank">Privacy</a>
                      <a href="https://aptosfoundation.org/terms" target="_blank">Terms</a></div>
                  </div>
                </div>
                </li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                  <p class="right">
                    <nav class="social-links">
                        <a class="social-link" href="https://github.com/aptos-labs/developer-docs" target="_blank" rel="noopener noreferrer" title="Github">
                         <svg width="100%" height="100%" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 0C4.47514 0 0 4.47514 0 10C0 14.4199 2.86679 18.1645 6.83855 19.4905C7.33579 19.5826 7.51995 19.2756 7.51995 19.0055C7.51995 18.7661 7.51381 18.14 7.50767 17.3051C4.72683 17.9067 4.13751 15.9668 4.13751 15.9668C3.68324 14.8128 3.0264 14.5058 3.0264 14.5058C2.11786 13.8858 3.09392 13.8981 3.09392 13.8981C4.09454 13.9718 4.62861 14.9294 4.62861 14.9294C5.51872 16.4579 6.96746 16.016 7.53837 15.7581C7.63045 15.1136 7.88827 14.6716 8.17066 14.4199C5.94843 14.1682 3.61571 13.3088 3.61571 9.47821C3.61571 8.38551 4.00246 7.4954 4.64702 6.79558C4.54266 6.54389 4.19889 5.52486 4.74524 4.14978C4.74524 4.14978 5.58625 3.87968 7.4954 5.17495C8.29343 4.95396 9.14672 4.84346 10 4.83732C10.8471 4.83732 11.7066 4.95396 12.5046 5.17495C14.4137 3.87968 15.2548 4.14978 15.2548 4.14978C15.8011 5.52486 15.4573 6.54389 15.353 6.79558C15.9914 7.4954 16.3781 8.38551 16.3781 9.47821C16.3781 13.3211 14.0393 14.1621 11.8109 14.4137C12.167 14.7207 12.4923 15.3346 12.4923 16.2676C12.4923 17.6059 12.48 18.6802 12.48 19.0117C12.48 19.2818 12.6581 19.5887 13.1676 19.4905C17.1393 18.1645 20 14.4199 20 10.0061C20 4.47514 15.5249 0 10 0Z" fill="currentColor"/></svg>
                        </a>
                        <a class="social-link" href="https://discord.gg/aptosnetwork" target="_blank" rel="noopener noreferrer" title="Discord">
                          <svg width="100%" height="100%" viewBox="0 0 71 55" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#a)"><path d="M60.105 4.898A58.55 58.55 0 0 0 45.653.415a.22.22 0 0 0-.233.11 40.784 40.784 0 0 0-1.8 3.697c-5.456-.817-10.886-.817-16.23 0-.485-1.164-1.201-2.587-1.828-3.697a.228.228 0 0 0-.233-.11 58.386 58.386 0 0 0-14.451 4.483.207.207 0 0 0-.095.082C1.578 18.73-.944 32.144.293 45.39a.244.244 0 0 0 .093.167c6.073 4.46 11.955 7.167 17.729 8.962a.23.23 0 0 0 .249-.082 42.08 42.08 0 0 0 3.627-5.9.225.225 0 0 0-.123-.312 38.772 38.772 0 0 1-5.539-2.64.228.228 0 0 1-.022-.378 31.17 31.17 0 0 0 1.1-.862.22.22 0 0 1 .23-.03c11.619 5.304 24.198 5.304 35.68 0a.219.219 0 0 1 .233.027c.356.293.728.586 1.103.865a.228.228 0 0 1-.02.378 36.384 36.384 0 0 1-5.54 2.637.227.227 0 0 0-.121.315 47.249 47.249 0 0 0 3.624 5.897.225.225 0 0 0 .249.084c5.801-1.794 11.684-4.502 17.757-8.961a.228.228 0 0 0 .092-.164c1.48-15.315-2.48-28.618-10.497-40.412a.18.18 0 0 0-.093-.084Zm-36.38 32.427c-3.497 0-6.38-3.211-6.38-7.156 0-3.944 2.827-7.156 6.38-7.156 3.583 0 6.438 3.24 6.382 7.156 0 3.945-2.827 7.156-6.381 7.156Zm23.593 0c-3.498 0-6.38-3.211-6.38-7.156 0-3.944 2.826-7.156 6.38-7.156 3.582 0 6.437 3.24 6.38 7.156 0 3.945-2.798 7.156-6.38 7.156Z" fill="currentColor"/></g><defs><clipPath id="a"><path fill="currentColor" d="M0 0h71v55H0z"/></clipPath></defs></svg>
                        </a>
                        <a class="social-link" href="https://twitter.com/Aptos" target="_blank" rel="noopener noreferrer" title="Twitter">
                          <svg width="100%" height="100%" viewBox="0 0 22 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M22 2.013a9.395 9.395 0 0 1-2.593.676A4.348 4.348 0 0 0 21.392.314a9.341 9.341 0 0 1-2.866 1.042A4.62 4.62 0 0 0 15.232 0c-2.493 0-4.514 1.922-4.514 4.292 0 .336.04.664.117.978C7.083 5.09 3.758 3.382 1.532.786A4.115 4.115 0 0 0 .92 2.944c0 1.489.796 2.802 2.007 3.571A4.669 4.669 0 0 1 .884 5.98v.053c0 2.08 1.555 3.815 3.62 4.209a4.744 4.744 0 0 1-2.038.074c.574 1.705 2.241 2.945 4.216 2.98a9.358 9.358 0 0 1-5.605 1.837c-.365 0-.724-.02-1.077-.06A13.257 13.257 0 0 0 6.918 17c8.303 0 12.843-6.54 12.843-12.21 0-.187-.004-.372-.013-.556A8.929 8.929 0 0 0 22 2.013Z" fill="currentColor"/></svg>
                        </a>
                    </nav>
                  </p>
              </li></ul></div></div></div></footer></div>
</body>
</html>