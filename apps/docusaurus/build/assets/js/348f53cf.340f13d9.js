"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[6835],{12937:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>c,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var s=n(63159),i=n(83581),a=n(45496),o=n(57376);const r={title:"Transactions and States"},c=void 0,l={id:"concepts/txns-states",title:"Transactions and States",description:"The Aptos blockchain stores three types of data:",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/concepts/txns-states.md",sourceDirName:"concepts",slug:"/concepts/txns-states",permalink:"/concepts/txns-states",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/concepts/txns-states.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Transactions and States"},sidebar:"aptosSidebar",previous:{title:"Events",permalink:"/concepts/events"},next:{title:"Gas and Storage Fees",permalink:"/concepts/gas-txn-fee"}},h={},d=[{value:"Transactions",id:"transactions",level:2},{value:"Transaction states",id:"transaction-states",level:3},{value:"Contents of a Transaction",id:"contents-of-a-transaction",level:3},{value:"Types of transaction payloads",id:"types-of-transaction-payloads",level:3},{value:"States",id:"states",level:2},{value:"Proofs",id:"proofs",level:3},{value:"Versioned database",id:"versioned-database",level:3},{value:"Transactions change ledger state",id:"transactions-change-ledger-state",level:2}];function u(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"The Aptos blockchain stores three types of data:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Transactions"}),": Transactions represent an intended operation being performed by an account on the blockchain (e.g., transferring assets)."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"States"}),": The (blockchain ledger) state represents the accumulation of the output of execution of transactions, the values stored within all ",(0,s.jsx)(t.a,{href:"./resources",children:"resources"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"/concepts/events",children:(0,s.jsx)(t.strong,{children:"Events"})}),": Ancillary data published by the execution of a transaction."]}),"\n"]}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsx)(t.p,{children:"Only transactions can change the ledger state."})}),"\n",(0,s.jsx)(t.h2,{id:"transactions",children:"Transactions"}),"\n",(0,s.jsx)(t.p,{children:"Aptos transactions contain information such as the sender\u2019s account address, authentication from the sender, the desired operation to be performed on the Aptos blockchain, and the amount of gas the sender is willing to pay to execute the transaction."}),"\n",(0,s.jsx)(t.h3,{id:"transaction-states",children:"Transaction states"}),"\n",(0,s.jsx)(t.p,{children:"A transaction may end in one of the following states:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Committed on the blockchain and executed. This is considered as a successful transaction."}),"\n",(0,s.jsx)(t.li,{children:"Committed on the blockchain and aborted. The abort code indicates why the transaction failed to execute."}),"\n",(0,s.jsx)(t.li,{children:"Discarded during transaction submission due to a validation check such as insufficient gas, invalid transaction format, or incorrect key."}),"\n",(0,s.jsx)(t.li,{children:"Discarded after transaction submission but before attempted execution. This could be caused by timeouts or insufficient gas due to other transactions affecting the account."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The sender\u2019s account will be charged gas for any committed transactions."}),"\n",(0,s.jsx)(t.p,{children:"During transaction submission, the submitter is notified of successful submission or a reason for failing validations otherwise."}),"\n",(0,s.jsx)(t.p,{children:"A transaction that is successfully submitted but ultimately discarded may have no visible state in any accessible Aptos node or within the Aptos network. A user can attempt to resubmit the same transaction to re-validate the transaction. If the submitting node believes that this transaction is still valid, it will return an error stating that an identical transaction has been submitted."}),"\n",(0,s.jsx)(t.p,{children:"The submitter can try to increase the gas cost by a trivial amount to help make progress and adjust for whatever may have been causing the discarding of the transaction further downstream."}),"\n",(0,s.jsx)(t.admonition,{title:"Read more",type:"tip",children:(0,s.jsxs)(t.p,{children:["See ",(0,s.jsx)(t.a,{href:"/concepts/blockchain",children:"Aptos Blockchain Deep Dive"})," for a comprehensive description of the Aptos transaction lifecycle."]})}),"\n",(0,s.jsx)(t.h3,{id:"contents-of-a-transaction",children:"Contents of a Transaction"}),"\n",(0,s.jsx)(t.p,{children:"A signed transaction on the blockchain contains the following information:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Signature"}),": The sender uses a digital signature to verify that they signed the transaction (i.e., authentication)."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Sender address"}),": The sender's ",(0,s.jsx)(t.a,{href:"/concepts/accounts#account-address",children:"account address"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Sender public key"}),": The public authentication key that corresponds to the private authentication key used to sign the transaction."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Payload"}),": Indicates an action or set of actions Alice's behalf. In the case this is a Move function, it directly calls into Move bytecode on the chain. Alternatively, it may be Move bytecode peer-to-peer ",(0,s.jsx)(t.a,{href:"/reference/glossary#transaction-or-move-script",children:"Move script"}),". It also contains a list of inputs to the function or script. For this example, it is a function call to transfer an amount of Aptos Coins from Alice account to Bob's account, where Alice's account is implied by sending the transaction and Bob's account and the amount are specified as transaction inputs."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"/reference/glossary#gas-unit-price",children:(0,s.jsx)(t.strong,{children:"Gas unit price"})}),": The amount the sender is willing to pay per unit of gas, to execute the transaction. This is represented as Octa or units of 10",(0,s.jsx)("sup",{children:"-8"})," utility tokens."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"/reference/glossary#maximum-gas-amount",children:(0,s.jsx)(t.strong,{children:"Maximum gas amount"})}),": The maximum gas amount in Aptos utility tokens the sender is willing to pay for this transaction. Gas charges are equal to the base gas cost covered by computation and IO multiplied by the gas price. Gas costs also include storage with an Apt-fixed priced storage model. This is represented as Octas or units of 10",(0,s.jsx)("sup",{children:"-8"})," Aptos utility tokens."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Gas price"})," (in specified gas units): This is the amount the sender is willing to pay per unit of ",(0,s.jsx)(t.a,{href:"/concepts/gas-txn-fee",children:"gas"})," to execute the transaction. ",(0,s.jsx)(t.a,{href:"/concepts/gas-txn-fee",children:"Gas"})," is a way to pay for computation and storage. A gas unit is an abstract measurement of computation with no inherent real-world value."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Maximum gas amount"}),": The ",(0,s.jsx)(t.a,{href:"/concepts/gas-txn-fee#specifying-gas-fees-within-a-transaction",children:"maximum gas amount"})," is the maximum gas units the transaction is allowed to consume."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Sequence number"}),": This is an unsigned integer that must be equal to the sender's account ",(0,s.jsx)(t.a,{href:"/concepts/accounts#account-sequence-number",children:"sequence number"})," at the time of execution."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Expiration time"}),": A timestamp after which the transaction ceases to be valid (i.e., expires)."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"types-of-transaction-payloads",children:"Types of transaction payloads"}),"\n",(0,s.jsx)(t.p,{children:"Within a given transaction, the two most common types of payloads include:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"An entry point"}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/move/move-on-aptos/scripts/",children:"A script (payload)"})}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Currently, the SDKs ",(0,s.jsx)(t.a,{href:"/sdks/python-sdk/",children:"Python"})," and ",(0,s.jsx)(t.a,{href:"/sdks/ts-sdk/",children:"Typescript"})," support both. This guide points out many of those entry points, such as ",(0,s.jsx)(t.code,{children:"coin::transfer"})," and ",(0,s.jsx)(t.code,{children:"aptos_account::create_account"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"All operations on the Aptos blockchain should be available via entry point calls. While one could submit multiple transactions calling entry points in series, many such operations may benefit from being called atomically from a single transaction. A script payload transaction can call any entry point or public function defined within any module."}),"\n",(0,s.jsx)(t.admonition,{title:"Read more",type:"tip",children:(0,s.jsxs)(t.p,{children:["See the tutorial on ",(0,s.jsx)(t.a,{href:"/tutorials/your-first-transaction",children:"Your First Transaction"})," for generating valid transactions."]})}),"\n",(0,s.jsx)(t.admonition,{title:"Transaction generation",type:"note",children:(0,s.jsx)(t.p,{children:"The Aptos REST API supports generating BCS-encoded transactions from JSON. This is useful for rapid prototyping, but be cautious using it in Mainnet as this places a lot of trust on the fullnode generating the transaction."})}),"\n",(0,s.jsx)(t.h2,{id:"states",children:"States"}),"\n",(0,s.jsx)(t.p,{children:"The Aptos blockchain's ledger state, or global state, represents the state of all accounts in the Aptos blockchain. Each validator node in the blockchain must know the latest version of the global state to execute any transaction."}),"\n",(0,s.jsxs)(t.p,{children:["Anyone can submit a transaction to the Aptos blockchain to modify the ledger state. Upon execution of a transaction, a transaction output is generated. A transaction output contains zero or more operations to manipulate the ledger state called ",(0,s.jsx)(t.strong,{children:"write sets"})," emitting a vector of resulting events, the amount of gas consumed, and the executed transaction status."]}),"\n",(0,s.jsx)(t.h3,{id:"proofs",children:"Proofs"}),"\n",(0,s.jsx)(t.p,{children:"The Aptos blockchain uses proof to verify the authenticity and correctness of the blockchain data."}),"\n",(0,s.jsxs)(t.p,{children:["Data within the Aptos blockchain is replicated across the network. Each validator and fullnode's ",(0,s.jsx)(t.a,{href:"./validator-nodes#storage",children:"storage"})," is responsible for persisting the agreed upon blocks of transactions and their execution results to the database."]}),"\n",(0,s.jsxs)(t.p,{children:["The blockchain is represented as an ever-growing ",(0,s.jsx)(t.a,{href:"/reference/glossary#merkle-trees",children:"Merkle tree"}),", where each leaf appended to the tree represents a single transaction executed by the blockchain."]}),"\n",(0,s.jsx)(t.p,{children:"All operations executed by the blockchain and all account states can be verified cryptographically. These cryptographic proofs ensure that:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"The validator nodes agree on the state."}),"\n",(0,s.jsxs)(t.li,{children:["The client does not need to trust the entity from which it is receiving data. For example, if a client fetches the last ",(0,s.jsx)(t.strong,{children:"n"})," transactions from an account, a proof can attest that no transactions were added, omitted or modified in the response. The client may also query for the state of an account, ask whether a specific transaction was processed, and so on."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"versioned-database",children:"Versioned database"}),"\n",(0,s.jsx)(t.p,{children:"The ledger state is versioned using an unsigned 64-bit integer corresponding to the number of transactions the system has executed. This versioned database allows the validator nodes to:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Execute a transaction against the ledger state at the latest version."}),"\n",(0,s.jsx)(t.li,{children:"Respond to client queries about ledger history at both current and previous versions."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"transactions-change-ledger-state",children:"Transactions change ledger state"}),"\n",(0,s.jsx)(a.A,{alt:"Signed Transaction Flow",sources:{light:(0,o.A)("/img/docs/transactions-and-state.svg"),dark:(0,o.A)("/img/docs/transactions-and-state-dark.svg")}}),"\n",(0,s.jsxs)(t.p,{children:["The above figure shows how executing transaction T",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})})," changes the state of the Aptos blockchain from S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i-1"})})," to S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})}),"."]}),"\n",(0,s.jsx)(t.p,{children:"In the figure:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Accounts ",(0,s.jsx)(t.strong,{children:"A"})," and ",(0,s.jsx)(t.strong,{children:"B"}),": Represent Alice's and Bob's accounts on the Aptos blockchain."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsxs)(t.strong,{children:["S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i-1"})})]})," : Represents the (",(0,s.jsx)(t.em,{children:"i-1"}),")-the state of the blockchain. In this state, Alice's account ",(0,s.jsx)(t.strong,{children:"A"})," has a balance of 110 APT (Aptos coins), and Bob's account ",(0,s.jsx)(t.strong,{children:"B"})," has a balance of 52 APT."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsxs)(t.strong,{children:["T",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})})]})," : This is the ",(0,s.jsx)(t.em,{children:"i"}),"-th transaction executed on the blockchain. In this example, it represents Alice sending 10 APT to Bob."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Apply()"}),": This is a deterministic function that always returns the same final state for a specific initial state and a specific transaction. If the current state of the blockchain is ",(0,s.jsxs)(t.strong,{children:["S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i-1"})})]}),", and transaction ",(0,s.jsxs)(t.strong,{children:["T",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})})]})," is executed on the state ",(0,s.jsxs)(t.strong,{children:["S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i-1"})})]}),", then the new state of the blockchain is always ",(0,s.jsxs)(t.strong,{children:["S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})})]}),". The Aptos blockchain uses the ",(0,s.jsx)(t.a,{href:"/move/book/SUMMARY",children:"Move language"})," to implement the deterministic execution function ",(0,s.jsx)(t.strong,{children:"Apply()"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsxs)(t.strong,{children:["S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})})]})," : This is the ",(0,s.jsx)(t.em,{children:"i"}),"-the state of the blockchain. When the transaction ",(0,s.jsxs)(t.strong,{children:["T",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})})]})," is applied to the blockchain, it generates the new state ",(0,s.jsxs)(t.strong,{children:["S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})})]})," (an outcome of applying ",(0,s.jsxs)(t.strong,{children:["Apply(S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i-1"})}),", T",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})}),")"]})," to ",(0,s.jsxs)(t.strong,{children:["S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i-1"})})]})," and ",(0,s.jsxs)(t.strong,{children:["T",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})})]}),"). This causes Alice\u2019s account balance to be reduced by 10 to 100 APT and Bob\u2019s account balance to be increased by 10 to 62 APT. The new state ",(0,s.jsxs)(t.strong,{children:["S",(0,s.jsx)("sub",{children:(0,s.jsx)(t.em,{children:"i"})})]})," shows these updated balances."]}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},83581:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var s=n(11855);const i={},a=s.createContext(i);function o(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);