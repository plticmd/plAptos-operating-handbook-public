"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[2847],{99902:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>a});var d=t(63159),i=t(83581);const s={title:"Upgrade your PFN",slug:"update-fullnode-with-new-devnet-releases",sidebar_position:11},r="Upgrade your PFN",o={id:"nodes/full-node/update-fullnode-with-new-releases",title:"Upgrade your PFN",description:"This document outlines the process for updating your PFN with new Aptos releases. All PFNs will need to be updated",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/nodes/full-node/update-fullnode-with-new-releases.md",sourceDirName:"nodes/full-node",slug:"/nodes/full-node/update-fullnode-with-new-devnet-releases",permalink:"/nodes/full-node/update-fullnode-with-new-devnet-releases",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/nodes/full-node/update-fullnode-with-new-releases.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",sidebarPosition:11,frontMatter:{title:"Upgrade your PFN",slug:"update-fullnode-with-new-devnet-releases",sidebar_position:11},sidebar:"nodeSidebar",previous:{title:"Modify a PFN",permalink:"/nodes/modify/modify-index"},next:{title:"Generate a PFN Identity",permalink:"/nodes/full-node/network-identity-fullnode"}},l={},a=[{value:"Source code deployment",id:"source-code-deployment",level:2},{value:"(Devnet) Data Wipe and Reset",id:"devnet-data-wipe-and-reset",level:3},{value:"Docker deployment",id:"docker-deployment",level:2},{value:"GCP deployment",id:"gcp-deployment",level:2},{value:"Upgrade with data wipe (devnet only)",id:"upgrade-with-data-wipe-devnet-only",level:3},{value:"Upgrade without data wipe",id:"upgrade-without-data-wipe",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.h1,{id:"upgrade-your-pfn",children:"Upgrade your PFN"}),"\n",(0,d.jsxs)(n.p,{children:["This document outlines the process for updating your PFN with new Aptos releases. All PFNs will need to be updated\nwhen new releases are available. For PFNs running in ",(0,d.jsx)(n.code,{children:"devnet"}),", an additional data wipe step is required as ",(0,d.jsx)(n.code,{children:"devnet"}),"\nis wiped on every new release."]}),"\n",(0,d.jsx)(n.h2,{id:"source-code-deployment",children:"Source code deployment"}),"\n",(0,d.jsxs)(n.p,{children:["If you run your PFN from the ",(0,d.jsx)(n.a,{href:"https://github.com/aptos-labs/aptos-core.git",children:"aptos-core"})," source code, you can update your PFN by\nfollowing these steps:"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Stop your PFN by running the command below (or killing the ",(0,d.jsx)(n.code,{children:"aptos-node"})," process manually):"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"cargo stop aptos-node\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Fetch the latest release appropriate for your network, e.g., ",(0,d.jsx)(n.code,{children:"devnet"}),", ",(0,d.jsx)(n.code,{children:"testnet"}),", or ",(0,d.jsx)(n.code,{children:"mainnet"}),". Be sure to replace\n",(0,d.jsx)(n.code,{children:"[network_branch]"})," with the appropriate branch name below:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"git checkout [network_branch] && git pull\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Rebuild the binary as you did during the initial setup."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["If your PFN is running in ",(0,d.jsx)(n.code,{children:"devnet"}),", follow the additional steps in the ",(0,d.jsx)(n.a,{href:"#upgrade-with-data-wipe-devnet-only",children:"Data Wipe and Reset"})," section below."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Restart your PFN by running the same deployment command as before. For example:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"cargo run -p aptos-node --release -- -f ./fullnode.yaml\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"devnet-data-wipe-and-reset",children:"(Devnet) Data Wipe and Reset"}),"\n",(0,d.jsx)(n.admonition,{title:"Devnet only wipe",type:"danger",children:(0,d.jsxs)(n.p,{children:["Only follow these additional steps if your PFN is running in ",(0,d.jsx)(n.code,{children:"devnet"}),". Other networks (e.g., ",(0,d.jsx)(n.code,{children:"testnet"})," and ",(0,d.jsx)(n.code,{children:"mainnet"}),")\ndon't require this step (as data is never wiped)!"]})}),"\n",(0,d.jsxs)(n.p,{children:["If your PFN is running in ",(0,d.jsx)(n.code,{children:"devnet"}),", follow these additional steps after stopping your PFN (and before restarting it!):"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Delete the data folder (the directory path is what you specified in the configuration file, e.g., ",(0,d.jsx)(n.code,{children:"fullnode.yaml"}),")."]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["The default data folder is ",(0,d.jsx)(n.code,{children:"/opt/aptos/data"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Delete the ",(0,d.jsx)(n.code,{children:"genesis.blob"})," file and ",(0,d.jsx)(n.code,{children:"waypoint.txt"})," file (depending on how you configured it, you might not have this file and may instead have a ",(0,d.jsx)(n.code,{children:"waypoint"})," directly in your configuration file)."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Download the new ",(0,d.jsx)(n.a,{href:"/nodes/node-files-all-networks/node-files#genesisblob",children:"genesis.blob"})," file and the new ",(0,d.jsx)(n.a,{href:"/nodes/node-files-all-networks/node-files#waypointtxt",children:"waypoint"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Update the configuration file (e.g., ",(0,d.jsx)(n.code,{children:"fullnode.yaml"}),") with the new genesis.blob and waypoint files."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Restart your PFN by running the same deployment command as before."}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"docker-deployment",children:"Docker deployment"}),"\n",(0,d.jsx)(n.p,{children:"If you run your PFN from a Docker image, you can update your PFN by:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["Stop your PFN by running the command below:","\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"docker compose down --volumes\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["(Devnet only!) If your PFN is running in ",(0,d.jsx)(n.code,{children:"devnet"}),", delete the entire directory which holds your PFN config and data directory."]}),"\n",(0,d.jsx)(n.li,{children:"Re-install and configure those files as during the original setup."}),"\n",(0,d.jsxs)(n.li,{children:["Restart your PFN by running the same deployment command as before. For example:","\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"gcp-deployment",children:"GCP deployment"}),"\n",(0,d.jsxs)(n.p,{children:["If you run your PFN in GCP, follow the steps below to update your PFN. Note: if your PFN is\nrunning in ",(0,d.jsx)(n.code,{children:"devnet"}),", an additional data wipe step is required."]}),"\n",(0,d.jsx)(n.h3,{id:"upgrade-with-data-wipe-devnet-only",children:"Upgrade with data wipe (devnet only)"}),"\n",(0,d.jsx)(n.admonition,{title:"Devnet only wipe",type:"danger",children:(0,d.jsxs)(n.p,{children:["Only follow these steps if your PFN is running in ",(0,d.jsx)(n.code,{children:"devnet"}),". Other networks don't require this step (as data is never wiped)\nand we recommend not wiping your data in these networks."]})}),"\n",(0,d.jsxs)(n.p,{children:["If you are running a ",(0,d.jsx)(n.code,{children:"devnet"})," PFN, follow these steps to update:"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Increase the ",(0,d.jsx)(n.code,{children:"era"})," number in ",(0,d.jsx)(n.code,{children:"main.tf"})," to trigger a new data volume creation, which will start the PFN on a new DB."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Update the ",(0,d.jsx)(n.code,{children:"image_tag"})," in ",(0,d.jsx)(n.code,{children:"main.tf"})," to contain the new release version."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Update the Terraform module for the PFN (run this in the same directory of your ",(0,d.jsx)(n.code,{children:"main.tf"})," file):"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"terraform get -update\n"})}),"\n",(0,d.jsxs)(n.ol,{start:"4",children:["\n",(0,d.jsx)(n.li,{children:"Apply the Terraform changes:"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"terraform apply\n"})}),"\n",(0,d.jsx)(n.h3,{id:"upgrade-without-data-wipe",children:"Upgrade without data wipe"}),"\n",(0,d.jsxs)(n.p,{children:["If you are not running a ",(0,d.jsx)(n.code,{children:"devnet"})," PFN, follow these steps to update:"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Update the ",(0,d.jsx)(n.code,{children:"image_tag"})," in ",(0,d.jsx)(n.code,{children:"main.tf"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Update the Terraform module for the PFN (run this in the same directory of your ",(0,d.jsx)(n.code,{children:"main.tf"})," file):"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"terraform get -update\n"})}),"\n",(0,d.jsxs)(n.ol,{start:"3",children:["\n",(0,d.jsx)(n.li,{children:"Apply the Terraform changes:"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"terraform apply\n\n# If you didn't update the image tag, terraform will show nothing to change, in this case, force a helm update\nterraform apply -var force_helm_update=true\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},83581:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var d=t(11855);const i={},s=d.createContext(i);function r(e){const n=d.useContext(s);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),d.createElement(s.Provider,{value:n},e.children)}}}]);