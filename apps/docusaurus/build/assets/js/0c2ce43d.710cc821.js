"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[1407],{49258:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var t=o(63159),r=o(83581);const i={title:"Node Health"},s=void 0,a={id:"nodes/validator-node/operator/node-liveness-criteria",title:"Node Health",description:"This document describes how you can verify and monitor the health of your validator and validator fullnode (VFN) in the",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/nodes/validator-node/operator/node-liveness-criteria.md",sourceDirName:"nodes/validator-node/operator",slug:"/nodes/validator-node/operator/node-liveness-criteria",permalink:"/nodes/validator-node/operator/node-liveness-criteria",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/nodes/validator-node/operator/node-liveness-criteria.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Node Health"},sidebar:"nodeSidebar",previous:{title:"Verify Nodes",permalink:"/nodes/validator-node/operator/verify-nodes/verify-validator-node"},next:{title:"Validator Leaderboard",permalink:"/nodes/leaderboard-metrics"}},d={},l=[{value:"Initial Node Verification",id:"initial-node-verification",level:2},{value:"Local Monitoring",id:"local-monitoring",level:2},{value:"Telemetry",id:"telemetry",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["This document describes how you can verify and monitor the health of your validator and validator fullnode (VFN) in the\nAptos network. Many of the methods described here rely on the runtime metrics that your nodes collect and report. These\nmetrics are collected by the Aptos node binary and are exposed via a Prometheus metrics endpoint. For a detailed\ndescription of the important metrics, see the ",(0,t.jsx)(n.a,{href:"/nodes/measure/node-inspection-service",children:"Node Inspection Service"})," and\n",(0,t.jsx)(n.a,{href:"/nodes/measure/important-metrics",children:"Important Node Metrics"})," documentation."]}),"\n",(0,t.jsx)(n.h2,{id:"initial-node-verification",children:"Initial Node Verification"}),"\n",(0,t.jsx)(n.p,{children:"After deploying your nodes and connecting them to the Aptos network, you should verify that your nodes are running\ncorrectly."}),"\n",(0,t.jsx)(n.admonition,{title:"First time?",type:"tip",children:(0,t.jsxs)(n.p,{children:["In some environments, e.g., ",(0,t.jsx)(n.code,{children:"mainnet"})," and ",(0,t.jsx)(n.code,{children:"testnet"}),", your VFN will begin syncing first (before your validator is able to sync).\nThis is normal behaviour. Once your VFN has finished syncing, your validator node will start syncing and eventually start participating in consensus."]})}),"\n",(0,t.jsx)(n.p,{children:"You can verify the correctness of your nodes by inspecting several simple metrics. Follow these steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Check if your nodes are state syncing by running this command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl 127.0.0.1:9101/metrics 2> /dev/null | grep "aptos_state_sync_version"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["You should expect to see the ",(0,t.jsx)(n.code,{children:"synced"})," or ",(0,t.jsx)(n.code,{children:"synced_states"})," versions increasing. The versions should start increasing\nfor your VFN first, then eventually your validator node will start syncing."]}),"\n",(0,t.jsx)(n.admonition,{title:"Cloud deployment?",type:"tip",children:(0,t.jsxs)(n.p,{children:["You may need to replace ",(0,t.jsx)(n.code,{children:"127.0.0.1"})," with your validator or VFN IP/DNS if deployed on the cloud."]})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Verify that your validator is connecting to other peers on the network."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl 127.0.0.1:9101/metrics 2> /dev/null | grep "aptos_connections{.*\\"Validator\\".*}"\n'})}),"\n",(0,t.jsx)(n.p,{children:"The command will output the number of inbound and outbound connections of your validator node. For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'aptos_connections{direction="inbound",network_id="Validator",peer_id="f326fd30",role_type="validator"} 5\naptos_connections{direction="outbound",network_id="Validator",peer_id="f326fd30",role_type="validator"} 2\n'})}),"\n",(0,t.jsx)(n.p,{children:"As long as one of the metrics is greater than zero, your validator node is connected to at least one of the peers on the network. If your validator is not\nconnected to any peers, make sure your VFN has completed syncing first. Once your VFN has finished syncing, your validator\nnode will start syncing and eventually be able to connect to other peers."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"After your node syncs to the latest version, you can also check if consensus is making progress, and your node is proposing."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl 127.0.0.1:9101/metrics 2> /dev/null | grep "aptos_consensus_current_round"\n\ncurl 127.0.0.1:9101/metrics 2> /dev/null | grep "aptos_consensus_proposals_count"\n'})}),"\n",(0,t.jsx)(n.p,{children:"You should expect to see these numbers continue to increase."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"local-monitoring",children:"Local Monitoring"}),"\n",(0,t.jsx)(n.p,{children:"If you are a node operator, there are several tools available to you to verify the health of your node going forward:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Metrics:"})," You can monitor your local metrics endpoint by running a ",(0,t.jsx)(n.code,{children:"curl"})," command against the\n",(0,t.jsx)(n.a,{href:"/nodes/measure/node-inspection-service",children:"Node Inspection Service"})," and verify key metrics. For example, you can\nverify the synchronization status of your node by running the command outlined in the\n",(0,t.jsx)(n.a,{href:"/nodes/full-node/verify-pfn#verify-synchronization",children:"Verify synchronization"})," section."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"REST API:"})," You can also monitor your node's health by querying the REST API. For example, you can verify the\ncurrent block height of your node by pinging the index page of your node's REST API. For more information, see the\n",(0,t.jsx)(n.a,{href:"/nodes/aptos-api-spec",children:"Aptos API Specification"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Monitoring tools:"})," To improve observability, you can also install monitoring tools that scrape the local metrics endpoint:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For Kubernetes based deployments, install the monitoring Helm chart (",(0,t.jsx)(n.a,{href:"https://github.com/aptos-labs/aptos-core/tree/main/terraform/helm/monitoring",children:"https://github.com/aptos-labs/aptos-core/tree/main/terraform/helm/monitoring"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Locally, you may run Prometheus and Grafana directly. Dashboards that utilize the metrics can be found here: (",(0,t.jsx)(n.a,{href:"https://github.com/aptos-labs/aptos-core/tree/main/dashboards",children:"https://github.com/aptos-labs/aptos-core/tree/main/dashboards"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"telemetry",children:"Telemetry"}),"\n",(0,t.jsxs)(n.p,{children:["The Aptos Labs team can also monitor your node remotely using ",(0,t.jsx)(n.a,{href:"/reference/telemetry",children:"Node Telemetry"}),". When you enable telemetry on\nyour nodes, the Aptos node binary will send telemetry data in the background, which includes the node's metrics.\nTelemetry data from your node is necessary to evaluate the performance, liveness and health of your nodes."]}),"\n",(0,t.jsxs)(n.p,{children:["If your node is using the default config without explicitly disabling telemetry, and has ",(0,t.jsx)(n.code,{children:"HTTPS"})," egress access to the\ninternet, then it will report various key metrics to Aptos Labs. Aptos Labs will also observe the on-chain events\nsuch as proposals per hour on your node, as defined in the liveness criteria."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},83581:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>a});var t=o(11855);const r={},i=t.createContext(r);function s(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);