"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[7754],{16123:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var a=t(63159),s=t(83581),r=t(44517),o=t(32830);const i={title:"Migration Guide"},c="TS SDK Migration Guide",l={id:"sdks/ts-sdk/migration-guide",title:"Migration Guide",description:"If you are coming from an earlier version 1.x.x of aptos, you will need to make the following updates.",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/sdks/ts-sdk/migration-guide.md",sourceDirName:"sdks/ts-sdk",slug:"/sdks/ts-sdk/migration-guide",permalink:"/sdks/ts-sdk/migration-guide",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/sdks/ts-sdk/migration-guide.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Migration Guide"},sidebar:"appSidebar",previous:{title:"TypeScript Index",permalink:"/sdks/ts-sdk/"},next:{title:"Account",permalink:"/sdks/ts-sdk/account"}},d={},u=[{value:"Install the SDK",id:"install-the-sdk",level:2},{value:"SDK usage and query the Aptos chain",id:"sdk-usage-and-query-the-aptos-chain",level:2},{value:"Configuration class",id:"configuration-class",level:2},{value:"Transaction Builder Flow",id:"transaction-builder-flow",level:2},{value:"Account",id:"account",level:2}];function p(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h1,{id:"ts-sdk-migration-guide",children:"TS SDK Migration Guide"}),"\n",(0,a.jsxs)(e.p,{children:["If you are coming from an earlier version ",(0,a.jsx)(e.code,{children:"1.x.x"})," of ",(0,a.jsx)(e.code,{children:"aptos"}),", you will need to make the following updates."]}),"\n",(0,a.jsx)(e.admonition,{type:"note",children:(0,a.jsx)(e.p,{children:"In this guide we only mention the API differences and updates you would need to do and excluding new features implementation"})}),"\n",(0,a.jsx)(e.h2,{id:"install-the-sdk",children:"Install the SDK"}),"\n",(0,a.jsxs)(e.p,{children:["The TypeScript SDK V2 is under a new ",(0,a.jsx)(e.a,{href:"https://github.com/aptos-labs/aptos-ts-sdk",children:"GitHub repo"})," and with a new package name - ",(0,a.jsx)(e.code,{children:"@aptos-labs/ts-sdk"})]}),"\n",(0,a.jsxs)(r.A,{groupId:"install-sdk",children:[(0,a.jsx)(o.A,{value:"pnpm",label:"pnpm",children:(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:" pnpm i @aptos-labs/ts-sdk\n"})})}),(0,a.jsx)(o.A,{value:"npm",label:"npm",children:(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:" npm i @aptos-labs/ts-sdk\n"})})}),(0,a.jsx)(o.A,{value:"yarn",label:"yarn",children:(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:" yarn add @aptos-labs/ts-sdk\n"})})}),(0,a.jsx)(o.A,{value:"bun",label:"bun",children:(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:" bun i @aptos-labs/ts-sdk\n"})})})]}),"\n",(0,a.jsx)(e.h2,{id:"sdk-usage-and-query-the-aptos-chain",children:"SDK usage and query the Aptos chain"}),"\n",(0,a.jsxs)(e.p,{children:["Remove all ",(0,a.jsx)(e.code,{children:"<*>Client"})," modules (i.e ",(0,a.jsx)(e.code,{children:"AptosClient"}),", ",(0,a.jsx)(e.code,{children:"FaucetClient"}),", ",(0,a.jsx)(e.code,{children:"CoinClient"}),", etc.) and replace with an ",(0,a.jsx)(e.code,{children:"Aptos"})," entry point class"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"V1"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-ts",children:"const faucetClient = new FaucetClient(NODE_URL, FAUCET_URL);\nconst aptosClient = new AptosClient(NODE_URL);\nconst indexerClient = new IndexerClient(INDEXER_URL);\nconst tokenClient = new TokenClient(aptosClient);\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"V2"})}),"\n",(0,a.jsx)(e.admonition,{type:"tip",children:(0,a.jsxs)(e.p,{children:["Read more about it ",(0,a.jsx)(e.a,{href:"/sdks/ts-sdk/sdk-configuration",children:"here"})]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-ts",children:'const aptos = new Aptos();\n\n// make queries\nconst fund = await aptos.fundAccount({ accountAddress: "0x123", amount: 100 });\nconst modules = await aptos.getAccountModules({ accountAddress: "0x123" });\nconst tokens = await aptos.getAccountOwnedTokens({ accountAddress: "0x123" });\n'})}),"\n",(0,a.jsx)(e.h2,{id:"configuration-class",children:"Configuration class"}),"\n",(0,a.jsxs)(e.p,{children:["Introduce ",(0,a.jsx)(e.code,{children:"AptosConfig"})," class that holds the config information for the SDK. Once define it we can pass and use it with the ",(0,a.jsx)(e.code,{children:"Aptos"})," class"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-ts",children:"const aptosConfig = new AptosConfig({ network: Network.TESTNET }); // default to devnet\nconst aptos = new Aptos(config);\n"})}),"\n",(0,a.jsx)(e.h2,{id:"transaction-builder-flow",children:"Transaction Builder Flow"}),"\n",(0,a.jsx)(e.p,{children:"Removed all separate transaction functions in favor of a more simplified and friendlier transaction builder flow"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"V1"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-ts",children:'const aptosClient = new AptosClient(NODE_URL);\n\n// bcs serialized arguments payload\nconst entryFunctionPayload =\n  new TxnBuilderTypes.TransactionPayloadEntryFunction(\n    TxnBuilderTypes.EntryFunction.natural(\n      "0x1::aptos_account",\n      "transfer",\n      [],\n      [bcsToBytes(TxnBuilderTypes.AccountAddress.fromHex(receiver.address()))],\n    ),\n  );\n// generate a raw transaction\nconst transaction = await client.generateRawTransaction(\n  sender.address(),\n  entryFunctionPayload,\n);\n\n// non-serialized arguments payload\nconst payload: Gen.TransactionPayload = {\n  type: "entry_function_payload",\n  function: "0x1::aptos_account::transfer",\n  type_arguments: [],\n  arguments: [account2.address().hex(), 100000],\n};\n// generate a raw transaction\nconst transaction = await client.generateTransaction(\n  account1.address(),\n  payload,\n);\n\n// sign transaction\nconst signedTransaction = AptosClient.generateBCSTransaction(\n  sender,\n  transaction,\n);\n// submit transaction\nconst txn = await client.submitSignedBCSTransaction(signedTransaction);\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"V2"})}),"\n",(0,a.jsx)(e.admonition,{type:"tip",children:(0,a.jsxs)(e.p,{children:["Read more about it ",(0,a.jsx)(e.a,{href:"/sdks/ts-sdk/transaction-builder",children:"here"})]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-ts",children:'const aptos = new Aptos();\n\n// non-serialized arguments transaction\nconst transaction = await aptos.build.transaction({\n  sender: alice.accountAddress,\n  data: {\n    function: "0x1::coin::transfer",\n    typeArguments: ["0x1::aptos_coin::AptosCoin"],\n    functionArguments: [bobAddress, 100],\n  },\n});\n\n// bcs serialized arguments transaction\nconst transaction = await aptos.build.transaction({\n  sender: alice.accountAddress,\n  data: {\n    function: "0x1::coin::transfer",\n    typeArguments: [parseTypeTag("0x1::aptos_coin::AptosCoin")],\n    functionArguments: [bobAddress, new U64(100)],\n  },\n});\n// sign transaction\nconst senderAuthenticator = aptos.sign.transaction({\n  signer: alice,\n  transaction,\n});\n// submit transaction\nconst committedTransaction = await aptos.submit.transaction({\n  transaction,\n  senderAuthenticator,\n});\n'})}),"\n",(0,a.jsx)(e.h2,{id:"account",children:"Account"}),"\n",(0,a.jsxs)(e.p,{children:["Rename ",(0,a.jsx)(e.code,{children:"AptosAccount"})," to ",(0,a.jsx)(e.code,{children:"Account"})," and use static methods to generate / derive an account"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"V1"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-ts",children:"// generate a new account (or key pair) OR derive from private key OR derive from private key and address\nconst account = new AptosAccount(); // supports only Legacy Ed25519\n\n// derive account from derivation path\nconst account = AptosAccount.fromDerivePath(..)\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"V2"})}),"\n",(0,a.jsx)(e.admonition,{type:"tip",children:(0,a.jsxs)(e.p,{children:["Read more about it ",(0,a.jsx)(e.a,{href:"/sdks/ts-sdk/account",children:"here"})]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-ts",children:"// generate a new account (or key pair)\nconst account = Account.generate(); // defaults to Legacy Ed25519\nconst account = Account.generate({ scheme: SigningSchemeInput.Secp256k1 }); // Single Sender Secp256k1\nconst account = Account.generate({\n  scheme: SigningSchemeInput.Ed25519,\n  legacy: false,\n}); // Single Sender Ed25519\n\n// derive account from private key\nconst account = Account.fromPrivateKey({ privateKey });\n\n// derive account from private key and address\nconst account = Account.fromPrivateKeyAndAddress({\n  privateKey,\n  address: accountAddress,\n});\n\n// derive account from derivation path\nconst account = Account.fromDerivationPath({\n  path,\n  mnemonic,\n  scheme: SigningSchemeInput.Ed25519,\n});\n"})})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(p,{...n})}):p(n)}},32830:(n,e,t)=>{t.d(e,{A:()=>o});t(11855);var a=t(51038);const s={tabItem:"tabItem_fjQ6"};var r=t(63159);function o(n){let{children:e,hidden:t,className:o}=n;return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.A)(s.tabItem,o),hidden:t,children:e})}},44517:(n,e,t)=>{t.d(e,{A:()=>A});var a=t(11855),s=t(51038),r=t(94663),o=t(53178),i=t(42394),c=t(31560),l=t(54169),d=t(76315);function u(n){return a.Children.toArray(n).filter((n=>"\n"!==n)).map((n=>{if(!n||(0,a.isValidElement)(n)&&function(n){const{props:e}=n;return!!e&&"object"==typeof e&&"value"in e}(n))return n;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof n.type?n.type:n.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(n){const{values:e,children:t}=n;return(0,a.useMemo)((()=>{const n=e??function(n){return u(n).map((n=>{let{props:{value:e,label:t,attributes:a,default:s}}=n;return{value:e,label:t,attributes:a,default:s}}))}(t);return function(n){const e=(0,l.X)(n,((n,e)=>n.value===e.value));if(e.length>0)throw new Error(`Docusaurus error: Duplicate values "${e.map((n=>n.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(n),n}),[e,t])}function h(n){let{value:e,tabValues:t}=n;return t.some((n=>n.value===e))}function m(n){let{queryString:e=!1,groupId:t}=n;const s=(0,o.W6)(),r=function(n){let{queryString:e=!1,groupId:t}=n;if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(r),(0,a.useCallback)((n=>{if(!r)return;const e=new URLSearchParams(s.location.search);e.set(r,n),s.replace({...s.location,search:e.toString()})}),[r,s])]}function g(n){const{defaultValue:e,queryString:t=!1,groupId:s}=n,r=p(n),[o,c]=(0,a.useState)((()=>function(n){let{defaultValue:e,tabValues:t}=n;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((n=>n.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const a=t.find((n=>n.default))??t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:e,tabValues:r}))),[l,u]=m({queryString:t,groupId:s}),[g,f]=function(n){let{groupId:e}=n;const t=function(n){return n?`docusaurus.tab.${n}`:null}(e),[s,r]=(0,d.Dv)(t);return[s,(0,a.useCallback)((n=>{t&&r.set(n)}),[t,r])]}({groupId:s}),x=(()=>{const n=l??g;return h({value:n,tabValues:r})?n:null})();(0,i.A)((()=>{x&&c(x)}),[x]);return{selectedValue:o,selectValue:(0,a.useCallback)((n=>{if(!h({value:n,tabValues:r}))throw new Error(`Can't select invalid tab value=${n}`);c(n),u(n),f(n)}),[u,f,r]),tabValues:r}}var f=t(39634);const x={tabList:"tabList__eIX",tabItem:"tabItem_SzJH"};var b=t(63159);function j(n){let{className:e,block:t,selectedValue:a,selectValue:o,tabValues:i}=n;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,r.a_)(),d=n=>{const e=n.currentTarget,t=c.indexOf(e),s=i[t].value;s!==a&&(l(e),o(s))},u=n=>{let e=null;switch(n.key){case"Enter":d(n);break;case"ArrowRight":{const t=c.indexOf(n.currentTarget)+1;e=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(n.currentTarget)-1;e=c[t]??c[c.length-1];break}}e?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},e),children:i.map((n=>{let{value:e,label:t,attributes:r}=n;return(0,b.jsx)("li",{role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:n=>c.push(n),onKeyDown:u,onClick:d,...r,className:(0,s.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":a===e}),children:t??e},e)}))})}function v(n){let{lazy:e,children:t,selectedValue:s}=n;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const n=r.find((n=>n.props.value===s));return n?(0,a.cloneElement)(n,{className:"margin-top--md"}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:r.map(((n,e)=>(0,a.cloneElement)(n,{key:e,hidden:n.props.value!==s})))})}function y(n){const e=g(n);return(0,b.jsxs)("div",{className:(0,s.A)("tabs-container",x.tabList),children:[(0,b.jsx)(j,{...n,...e}),(0,b.jsx)(v,{...n,...e})]})}function A(n){const e=(0,f.A)();return(0,b.jsx)(y,{...n,children:u(n.children)},String(e))}},83581:(n,e,t)=>{t.d(e,{R:()=>o,x:()=>i});var a=t(11855);const s={},r=a.createContext(s);function o(n){const e=a.useContext(r);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),a.createElement(r.Provider,{value:e},n.children)}}}]);