"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[4546],{83071:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>a});var i=o(63159),s=o(83581);const r={title:"Using Docker",slug:"run-validator-node-using-docker"},t="Using Docker",d={id:"nodes/validator-node/operator/running-validator-node/using-docker",title:"Using Docker",description:"Docker deployment has only been tested on Linux, Windows, and Intel macOS. If you are on M1+ macOS, you will",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/nodes/validator-node/operator/running-validator-node/using-docker.md",sourceDirName:"nodes/validator-node/operator/running-validator-node",slug:"/nodes/validator-node/operator/running-validator-node/run-validator-node-using-docker",permalink:"/nodes/validator-node/operator/running-validator-node/run-validator-node-using-docker",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/nodes/validator-node/operator/running-validator-node/using-docker.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Using Docker",slug:"run-validator-node-using-docker"},sidebar:"nodeSidebar",previous:{title:"Using Source Code",permalink:"/nodes/validator-node/operator/running-validator-node/run-validator-node-using-source"},next:{title:"Using AWS",permalink:"/nodes/validator-node/operator/running-validator-node/run-validator-node-using-aws"}},l={},a=[{value:"Deployment steps",id:"deployment-steps",level:2},{value:"Connecting to the Aptos Network",id:"connecting-to-the-aptos-network",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"using-docker",children:"Using Docker"}),"\n",(0,i.jsx)(n.admonition,{title:"Apple M1+ Users",type:"danger",children:(0,i.jsxs)(n.p,{children:["Docker deployment has only been tested on Linux, Windows, and Intel macOS. If you are on M1+ macOS, you will\nneed to deploy using ",(0,i.jsx)(n.a,{href:"/nodes/validator-node/operator/running-validator-node/run-validator-node-using-source",children:"source code"}),"."]})}),"\n",(0,i.jsx)(n.p,{children:"This is a step-by-step guide to deploy an Aptos validator and validator fullnode (VFN) using Docker. Using this guide, the validator\nand VFN will be deployed on separate machines."}),"\n",(0,i.jsx)(n.admonition,{title:"Prerequisites",type:"caution",children:(0,i.jsxs)(n.p,{children:["Before you begin, make sure to read and understand the ",(0,i.jsx)(n.a,{href:"/nodes/validator-node/operator/node-requirements",children:"Node Requirements"}),". Similarly, make sure you have\ninstalled the ",(0,i.jsx)(n.a,{href:"https://aptos.dev/tools/aptos-cli/install-cli/index",children:"Aptos CLI"}),", and ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/install/",children:"Docker with Docker Compose"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"deployment-steps",children:"Deployment steps"}),"\n",(0,i.jsx)(n.admonition,{title:"Default connection to mainnet",type:"tip",children:(0,i.jsx)(n.p,{children:"If you follow the default setup in this document, then your validator and VFN will be connected to the Aptos mainnet.\nTo connect to a different Aptos network, such as testnet, make sure you download the correct genesis and waypoint\nfiles for the network you want to connect to. Similarly, you will need to modify the docker compose files to use the\ncorrect docker images by network name."})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create a working directory for your Aptos nodes, and pick a username for your nodes, e.g.,"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export WORKSPACE=mainnet\nexport USERNAME=alice\nmkdir ~/$WORKSPACE\ncd ~/$WORKSPACE\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Generate the key pairs for your nodes in your working directory. You can do this by running\nthe following command with the Aptos CLI:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aptos genesis generate-keys --output-dir ~/$WORKSPACE/keys\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will create 4 key files under ",(0,i.jsx)(n.code,{children:"~/$WORKSPACE/keys"})," directory:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"public-keys.yaml"}),": This file contains all public keys for your validator and VFN, as well as your account address."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"private-keys.yaml"}),": This file contains all private keys for your validator and VFN."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"validator-identity.yaml"}),": This file contains the public and private keys for your validator, as well as your account address."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"validator-full-node-identity.yaml"}),": This file contains the public and private keys for your VFN, as well as your account address."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Backup your private keys",type:"danger",children:(0,i.jsxs)(n.p,{children:["Your private keys are important for you to establish ownership of your nodes. Never share your ",(0,i.jsx)(n.strong,{children:"private"})," keys with anyone,\nand make sure to ",(0,i.jsx)(n.strong,{children:"backup"})," ",(0,i.jsx)(n.code,{children:"private-keys.yaml"})," somewhere safe."]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Next, you will need to set your validator configuration. This includes setting the validator and VFN host names,\nwhich may be IP addresses or DNS addresses."}),"\n",(0,i.jsx)(n.admonition,{title:"DNS addresses",type:"tip",children:(0,i.jsx)(n.p,{children:"Using DNS is recommended over IP addresses, as it enables more efficient node migrations and is more resilient\nto host changes."})}),"\n",(0,i.jsx)(n.p,{children:"You can set your validator configuration by running the following command with the Aptos CLI:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"\n# Replace <validator node IP / DNS address> and <Full Node IP / DNS address> below,\n# with the appropriate IP or DNS address for your nodes.\n\ncd ~/$WORKSPACE\naptos genesis set-validator-configuration \\\n    --local-repository-dir ~/$WORKSPACE \\\n    --username $USERNAME \\\n    --owner-public-identity-file ~/$WORKSPACE/keys/public-keys.yaml \\\n    --validator-host <validator node IP / DNS address>:<Port> \\\n    --full-node-host <Full Node IP / DNS address>:<Port> \\\n    --stake-amount 100000000000000\n\n# For example, if you are using IP addresses:\n\naptos genesis set-validator-configuration \\\n    --local-repository-dir ~/$WORKSPACE \\\n    --username $USERNAME \\\n    --owner-public-identity-file ~/$WORKSPACE/keys/public-keys.yaml \\\n    --validator-host 35.232.235.205:6180 \\\n    --full-node-host 34.135.169.144:6182 \\\n    --stake-amount 100000000000000\n\n# Otherwise, if you are using DNS addresses:\n\naptos genesis set-validator-configuration \\\n    --local-repository-dir ~/$WORKSPACE \\\n    --username $USERNAME \\\n    --owner-public-identity-file ~/$WORKSPACE/keys/public-keys.yaml \\\n    --validator-host bot.aptosdev.com:6180 \\\n    --full-node-host fn.bot.aptosdev.com:6182 \\\n    --stake-amount 100000000000000\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Configuring the validator will create two YAML files in the ",(0,i.jsx)(n.code,{children:"~/$WORKSPACE/$USERNAME"})," directory: ",(0,i.jsx)(n.code,{children:"owner.yaml"})," and\n",(0,i.jsx)(n.code,{children:"operator.yaml"}),". These will be useful for connecting your nodes to the Aptos network (later)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Download the following files by following the instructions on the ",(0,i.jsx)(n.a,{href:"/nodes/node-files-all-networks/node-files-index",children:"Node Files"})," pages.\nYou will need to select the appropriate network (e.g., ",(0,i.jsx)(n.code,{children:"mainnet"}),", ",(0,i.jsx)(n.code,{children:"testnet"}),", ",(0,i.jsx)(n.code,{children:"devnet"}),") and download the following files:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"validator.yaml"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"fullnode.yaml"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"docker-compose.yaml"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"docker-compose-fullnode.yaml"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"haproxy.cfg"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"haproxy-fullnode.cfg"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"blocked.ips"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"genesis.blob"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"waypoint.txt"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["To recap, in your working directory (",(0,i.jsx)(n.code,{children:"~/$WORKSPACE"}),"), you should have a list of files:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"docker-compose.yaml"}),": The docker compose file to run the validator."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"docker-compose-fullnode.yaml"}),": The docker compose file to run the VFN."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"keys"})," folder containing:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"public-keys.yaml"}),": Public keys for both nodes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"private-keys.yaml"}),": Private keys for both nodes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"validator-identity.yaml"}),": Key and account information for the validator."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"validator-full-node-identity.yaml"}),": Key and account information for the VFN."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$username"})," folder containing:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"owner.yaml"}),": The owner, operator and voter mappings."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"operator.yaml"}),": Validator and VFN operator information."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"waypoint.txt"}),": The waypoint for the genesis transaction on the network you are connecting to."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"genesis.blob"})," The genesis blob for the network you are connecting to."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"To start the validator node, run the following command in your working directory:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker-compose up (or `docker compose up` depends on your version)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will start the validator node using the docker compose file and the images specified in the\n",(0,i.jsx)(n.code,{children:"docker-compose.yaml"})," file. If you wish to change the network you are connecting to, you will need to modify\nthe file to use the correct docker images by network name."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Before you can start the VFN, you will need to modify the ",(0,i.jsx)(n.code,{children:"fullnode.yaml"})," file to update the host address for the\nvalidator node. For example, if you are using IP addresses, you will need to update the ",(0,i.jsx)(n.code,{children:"full_node_networks"}),"\n",(0,i.jsx)(n.code,{children:"addresses"})," for the ",(0,i.jsx)(n.code,{children:"vfn"})," network as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'---\naddresses:\n  - "/ip4/100.100.100.100/tcp/6181/noise-ik/..." # Set the IP Address of the validator\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Otherwise, if you are using DNS addresses, you will need to update the ",(0,i.jsx)(n.code,{children:"addresses"})," field as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'---\naddresses:\n  - "/dns/example.com/tcp/6181/noise-ik/..." # Set the DNS Address of the validator\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"To start your VFN, run the following commands on a separate, dedicated VFN machine. You will need to copy across\nthe keys, configuration and docker compose files from the validator machine."}),"\n",(0,i.jsx)(n.admonition,{title:"VFN identity",type:"danger",children:(0,i.jsx)(n.p,{children:"You should copy the keys and configuration\nfiles across to the VFN machine from the working location where they were generated. Do not attempt to generate\nanother set of keys or files for the VFN, as these will not be recognized by the network."})}),"\n",(0,i.jsx)(n.p,{children:"To start the VFN, run the following command in your working directory:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-compose-fullnode.yaml up\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will start the VFN using the docker compose file and the images specified in the\n",(0,i.jsx)(n.code,{children:"docker-compose-fullnode.yaml"})," file. If you wish to change the network you are connecting to, you will need to modify\nthe file to use the correct docker images by network name."]}),"\n",(0,i.jsx)(n.admonition,{title:"Next steps",type:"caution",children:(0,i.jsx)(n.p,{children:"You have now completed setting up your validator and VFN using Docker. However, your nodes will not be able to connect\nto the Aptos network just yet."})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"connecting-to-the-aptos-network",children:"Connecting to the Aptos Network"}),"\n",(0,i.jsxs)(n.p,{children:["You have now completed setting up your validator and VFN using Docker. Proceed to ",(0,i.jsx)(n.a,{href:"/nodes/validator-node/operator/connect-nodes/connect-validator-node",children:"Connect Nodes"})," for the next steps."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},83581:(e,n,o)=>{o.d(n,{R:()=>t,x:()=>d});var i=o(11855);const s={},r=i.createContext(s);function t(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);