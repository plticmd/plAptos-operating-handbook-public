"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[9036],{12261:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>d,toc:()=>c});var t=o(63159),s=o(83581);const r={title:"Customize PFN Networks",slug:"fullnode-network-connections"},i="Customize PFN Networks",d={id:"nodes/full-node/fullnode-network-connections",title:"Customize PFN Networks",description:"Most PFN operators will not need to customize their PFN's network connections. This is only required",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/nodes/full-node/fullnode-network-connections.md",sourceDirName:"nodes/full-node",slug:"/nodes/full-node/fullnode-network-connections",permalink:"/nodes/full-node/fullnode-network-connections",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/nodes/full-node/fullnode-network-connections.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Customize PFN Networks",slug:"fullnode-network-connections"},sidebar:"nodeSidebar",previous:{title:"Generate a PFN Identity",permalink:"/nodes/full-node/network-identity-fullnode"},next:{title:"Bootstrap a Node",permalink:"/nodes/operations/operations-index"}},a={},c=[{value:"Allowing PFN connections",id:"allowing-pfn-connections",level:2},{value:"Connecting to seed peers",id:"connecting-to-seed-peers",level:2},{value:"Configuring priority access",id:"configuring-priority-access",level:2},{value:"Configuring private PFNs",id:"configuring-private-pfns",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"customize-pfn-networks",children:"Customize PFN Networks"}),"\n",(0,t.jsx)(n.admonition,{title:"Advanced customization",type:"danger",children:(0,t.jsx)(n.p,{children:"Most PFN operators will not need to customize their PFN's network connections. This is only required\nfor advanced use cases, such as connecting to specific peers, or configuring a private PFN. If you do\nnot have a relevant use case, you should avoid making changes to your PFN's network connections."})}),"\n",(0,t.jsxs)(n.p,{children:["When running a PFN, you can configure your node's network connections for a few different purposes.\nFor example, you can add a seed peer to your node's configuration to connect your node to a specific\npeer of your choosing. Or you can leverage a static network identity for your PFN to allow other nodes\nto connect to you, as described in ",(0,t.jsx)(n.a,{href:"/nodes/full-node/network-identity-fullnode",children:"Generate a PFN Identity"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"This document outlines how to configure the network of your PFN for different use cases, including:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Allowing nodes to connect to your PFN."}),"\n",(0,t.jsx)(n.li,{children:"Connecting your PFN to seed peers."}),"\n",(0,t.jsx)(n.li,{children:"Configuring priority access for other PFNs."}),"\n",(0,t.jsx)(n.li,{children:"Configuring your PFN as a private PFN."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"allowing-pfn-connections",children:"Allowing PFN connections"}),"\n",(0,t.jsx)(n.admonition,{title:"Generate a static identity",type:"tip",children:(0,t.jsxs)(n.p,{children:["Before allowing other nodes to connect to your PFN, you will need to create a static identity. See ",(0,t.jsx)(n.a,{href:"/nodes/full-node/network-identity-fullnode",children:"Generate a PFN Identity"}),"."]})}),"\n",(0,t.jsx)(n.p,{children:"Once you start your PFN with a static identity you can allow others to connect to your PFN:"}),"\n",(0,t.jsx)(n.admonition,{title:"Default port settings",type:"caution",children:(0,t.jsxs)(n.p,{children:["In the steps below, the port numbers used are for illustration only. You can use your choice of port numbers.\nSee ",(0,t.jsx)(n.a,{href:"/nodes/full-node/pfn-requirements",children:"PFN Requirements"})," for more information on port settings."]})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Make sure you open the TCP port of the network you wish to allow external connections on (e.g., ",(0,t.jsx)(n.code,{children:"6180"})," or ",(0,t.jsx)(n.code,{children:"6182"}),").\nThis is required to allow other nodes to connect to your PFN."]}),"\n",(0,t.jsxs)(n.li,{children:["If you are using Docker, simply add ",(0,t.jsx)(n.code,{children:'- "6180:6180"'})," or ",(0,t.jsx)(n.code,{children:'- "6182:6182"'})," under ports in your ",(0,t.jsx)(n.code,{children:"docker-compose.yaml"})," file."]}),"\n",(0,t.jsxs)(n.li,{children:["Share your PFN static network identity with others. They can then use it in the ",(0,t.jsx)(n.code,{children:"seeds"})," key of their node's\nconfiguration file to connect to your PFN. See the section below."]}),"\n",(0,t.jsxs)(n.li,{children:["Make sure the port number you put in the ",(0,t.jsx)(n.code,{children:"addresses"})," matches the one you have in the PFN configuration file\n(for example, ",(0,t.jsx)(n.code,{children:"6180"})," or ",(0,t.jsx)(n.code,{children:"6182"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"You can share your PFN's network identity in our Discord to advertise your node for others to connect to. Note:\nthis is optional (and not required!)."})}),"\n",(0,t.jsxs)(n.p,{children:["The snippets below show the configuration file entries and format for allowing other nodes to connect to your PFN.\nThe format of each seed peer entry should have a unique ",(0,t.jsx)(n.code,{children:"peer_id"}),", list of ",(0,t.jsx)(n.code,{children:"addresses"}),", and a ",(0,t.jsx)(n.code,{children:"role"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'<Peer_ID>:\n  addresses:\n  # with DNS\n  - "/dns4/<DNS_Name>/tcp/<Port_Number>/noise-ik/<Public_Key>/handshake/0"\n  role: Upstream\n<Peer_ID>:\n  addresses:\n  # with IP\n  - "/ip4/<IP_Address>/tcp/<Port_Number>/noise-ik/<Public_Key>/handshake/0"\n  role: Upstream\n'})}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'B881EA2C174D8211C123E5A91D86227DB116A44BB345A6E66874F83D8993F813:\n  addresses:\n  - "/dns4/pfn0.node.devnet.aptoslabs.com/tcp/6182/noise-ik/B881EA2C174D8211C123E5A91D86227DB116A44BB345A6E66874F83D8993F813/handshake/0"\n  role: "Upstream"\nB881EA2C174D8211C123E5A91D86227DB116A44BB345A6E66874F83D8993F813:\n  addresses:\n  - "/ip4/100.20.221.187/tcp/6182/noise-ik/B881EA2C174D8211C123E5A91D86227DB116A44BB345A6E66874F83D8993F813/handshake/0"\n  role: "Upstream"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"connecting-to-seed-peers",children:"Connecting to seed peers"}),"\n",(0,t.jsx)(n.admonition,{title:"Seeds are not required",type:"danger",children:(0,t.jsx)(n.p,{children:"Seed peers are not required for your PFN to connect to any Aptos network. All networks (e.g., devnet, testnet\nand mainnet) are automatically discoverable. Adding seed peers should only be done if you wish to\nconnect to a specific peer (or set of peers), and are confident that the peers are high quality."})}),"\n",(0,t.jsxs)(n.p,{children:["To add seed peers to your PFN, the seed peers' addresses should be added to your PFN configuration file, under\nthe ",(0,t.jsx)(n.code,{children:"seeds"})," key in the public network configuration. Each seed peer entry should have a unique ",(0,t.jsx)(n.code,{children:"peer_id"}),", list of\n",(0,t.jsx)(n.code,{children:"addresses"}),", and a ",(0,t.jsx)(n.code,{children:"role"})," (e.g., ",(0,t.jsx)(n.code,{children:"Upstream"}),"). The snippet below shows an example\nof a configuration file with seed peers manually added:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'---\nfull_node_networks:\n  - discovery_method: "onchain"\n    listen_address: ...\n    seeds: # All seeds are declared below\n      bb14af025d226288a3488b4433cf5cb54d6a710365a2d95ac6ffbd9b9198a86a:\n        addresses:\n          - "/dns4/pfn0.node.devnet.aptoslabs.com/tcp/6182/noise-ik/bb14af025d226288a3488b4433cf5cb54d6a710365a2d95ac6ffbd9b9198a86a/handshake/0"\n        role: "Upstream"\n      7fe8523388084607cdf78ff40e3e717652173b436ae1809df4a5fcfc67f8fc61:\n        addresses:\n          - "/dns4/pfn1.node.devnet.aptoslabs.com/tcp/6182/noise-ik/7fe8523388084607cdf78ff40e3e717652173b436ae1809df4a5fcfc67f8fc61/handshake/0"\n        role: "Upstream"\n      f6b135a59591677afc98168791551a0a476222516fdc55869d2b649c614d965b:\n        addresses:\n          - "/dns4/pfn2.node.devnet.aptoslabs.com/tcp/6182/noise-ik/f6b135a59591677afc98168791551a0a476222516fdc55869d2b649c614d965b/handshake/0"\n        role: "Upstream"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"configuring-priority-access",children:"Configuring priority access"}),"\n",(0,t.jsx)(n.p,{children:"To configure your PFN to allow other nodes to connect to it even when your PFN has hit the maximum number\nof available network connections, follow this method:"}),"\n",(0,t.jsxs)(n.p,{children:["In the configuration file for your PFN add the other node as a seed peer with the ",(0,t.jsx)(n.code,{children:"Downstream"})," role.\nThis will allow the other node to connect directly to you with priority access. For example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"seeds:\n  <other node's peer id>\n    addresses:\n    - <address of the other node>\n    role: Downstream # Allows the node to connect to us\n"})}),"\n",(0,t.jsx)(n.p,{children:"Similarly, to make the other node dial out to your PFN, add the following to the other node's configuration file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"seeds:\n  <your node's peer id>\n    addresses:\n    - <address of your npde>\n    role: PreferredUpstream # Allows the node to connect to the seed peer\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuring-private-pfns",children:"Configuring private PFNs"}),"\n",(0,t.jsx)(n.p,{children:"You can also configure your PFN as a private PFN should you wish. What this means is that your PFN will\nnot allow unauthenticated connections, specifically, any node that is not a validator, VFN or seed peer\nwill be unable to connect to your PFN."}),"\n",(0,t.jsxs)(n.p,{children:["To configure your PFN as a private PFN, add the following to your PFN configuration file. Note, you\nshould add this to the public network entry in the ",(0,t.jsx)(n.code,{children:"full_node_networks"})," configuration:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'...\nfull_node_networks:\n  - discovery_method: "onchain"\n    listen_address: ...\n    max_inbound_connections: 0  # Prevents any unauthenticated inbound connections\n    mutual_authentication: true  # Requires authenticated connections\n    ...\n...\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},83581:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>d});var t=o(11855);const s={},r=t.createContext(s);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);