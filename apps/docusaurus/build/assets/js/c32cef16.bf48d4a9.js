"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[8872],{37064:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var t=o(63159),s=o(83581);const i={title:"Run a PFN from Source or Docker",slug:"fullnode-source-code-or-docker",sidebar_position:10},r="Run a PFN from Source Code or Docker",a={id:"nodes/full-node/fullnode-source-code-or-docker",title:"Run a PFN from Source or Docker",description:"You can run your own public fullnode (PFN) to synchronize the state of the Aptos blockchain and stay",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/nodes/full-node/fullnode-source-code-or-docker.md",sourceDirName:"nodes/full-node",slug:"/nodes/full-node/fullnode-source-code-or-docker",permalink:"/nodes/full-node/fullnode-source-code-or-docker",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/nodes/full-node/fullnode-source-code-or-docker.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",sidebarPosition:10,frontMatter:{title:"Run a PFN from Source or Docker",slug:"fullnode-source-code-or-docker",sidebar_position:10}},d={},c=[{value:"Hardware requirements",id:"hardware-requirements",level:2},{value:"Network requirements and ports",id:"network-requirements-and-ports",level:2},{value:"Port settings",id:"port-settings",level:3},{value:"Running a PFN:",id:"running-a-pfn",level:4},{value:"Storage requirements",id:"storage-requirements",level:3},{value:"Deploying a PFN",id:"deploying-a-pfn",level:2},{value:"Method 1: Building and running from source",id:"method-1-building-and-running-from-source",level:3},{value:"Method 2: Using Docker",id:"method-2-using-docker",level:3},{value:"Verify the correctness of your PFN",id:"verify-the-correctness-of-your-pfn",level:2},{value:"Verify initial synchronization",id:"verify-initial-synchronization",level:3},{value:"(Optional) Verify outbound network connections",id:"optional-verify-outbound-network-connections",level:3},{value:"(Optional) Examine Docker ledger size",id:"optional-examine-docker-ledger-size",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"run-a-pfn-from-source-code-or-docker",children:"Run a PFN from Source Code or Docker"}),"\n",(0,t.jsx)(n.p,{children:"You can run your own public fullnode (PFN) to synchronize the state of the Aptos blockchain and stay\nup-to-date. PFNs replicate the entire state of the blockchain by syncing from other Aptos VFNs and PFNs. PFNs\ncan be run by anyone. This tutorial explains how to deploy a PFN and connect to an Aptos network."}),"\n",(0,t.jsx)(n.admonition,{title:"Do I have to run a PFN?",type:"tip",children:(0,t.jsxs)(n.p,{children:["If you do not wish to run a PFN, but still want to interact with the Aptos blockchain, you can use the REST API\nprovided by the Aptos Labs' PFNs (see ",(0,t.jsx)(n.a,{href:"../../apis",children:"Aptos APIs"}),"). Note, however, that Aptos Labs-provided PFNs have rate\nlimits, which can impede your development. If you want to avoid such rate limits, you can deploy your own PFN\nand synchronize with the Aptos blockchain directly."]})}),"\n",(0,t.jsx)(n.admonition,{title:"Choose a network",type:"caution",children:(0,t.jsxs)(n.p,{children:["This document describes how to start a public fullnode in the Aptos mainnet network, but it can easily be used to do\nthe same in the devnet or testnet networks. To do so, check out the desired network branch and use\nthe ",(0,t.jsx)(n.code,{children:"genesis.blob"})," and ",(0,t.jsx)(n.code,{children:"waypoint.txt"})," node files for the respective branches:\n",(0,t.jsx)(n.a,{href:"/nodes/node-files-all-networks/node-files",children:"mainnet"}),",\n",(0,t.jsx)(n.a,{href:"/nodes/node-files-all-networks/node-files-devnet",children:"devnet"}),", and\n",(0,t.jsx)(n.a,{href:"/nodes/node-files-all-networks/node-files-testnet",children:"testnet"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"hardware-requirements",children:"Hardware requirements"}),"\n",(0,t.jsxs)(n.p,{children:["For running a production-grade PFN, we recommend that your hardware meet the same requirements as a\nvalidator or VFN. You can see the hardware requirements for these nodes, here: ",(0,t.jsx)(n.a,{href:"/nodes/validator-node/operator/node-requirements#hardware-requirements",children:"validator and VFN hardware requirements"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"If you wish to run a PFN for development or testing only, lower hardware specs can be used. But, it should not be\nused in production. For example:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CPU"}),": 8 cores, 16 threads (Intel Xeon Skylake or newer)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Memory"}),": 32GB RAM."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{title:"Minimum hardware requirements",type:"danger",children:(0,t.jsx)(n.p,{children:"Failing to meet the minimum hardware requirements for a production-grade PFN mean that your\nPFN will likely experience degradation under load and general instability in production environments."})}),"\n",(0,t.jsx)(n.h2,{id:"network-requirements-and-ports",children:"Network requirements and ports"}),"\n",(0,t.jsx)(n.p,{children:"When you are running a PFN, you are required to open network ports on your nodes to allow other nodes (i.e., peers)\nto connect to you. There are different Aptos network types, and each network type uses a different port. However,\nthe only network type that a PFN uses is the public network, where PFNs to connect to other PFNs and VFNs."}),"\n",(0,t.jsxs)(n.p,{children:["Your PFN can be configured so that the public network operates using a specific port on your node. You can configure\nthe port settings using the node configuration YAML file. Here is an ",(0,t.jsx)(n.a,{href:"https://github.com/aptos-labs/aptos-core/blob/main/config/src/config/test_data/public_full_node.yaml#L16",children:"example\nconfiguration file"})," for a PFN\nthat configures the public network to use port ",(0,t.jsx)(n.code,{children:"6180"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"port-settings",children:"Port settings"}),"\n",(0,t.jsx)(n.p,{children:"The recommendations described below assume the default port settings used by PFNs. If you have\nchanged the default port settings in your configuration file, then you should adjust the recommendations accordingly."}),"\n",(0,t.jsx)(n.admonition,{title:"Exposing ports",type:"caution",children:(0,t.jsx)(n.p,{children:"Unless explicitly required, we recommend that you do not expose any other ports while operating a PFN. This is because\nexposing additional ports can increase the attack surface of your node and make it more vulnerable to adversaries."})}),"\n",(0,t.jsx)(n.h4,{id:"running-a-pfn",children:"Running a PFN:"}),"\n",(0,t.jsx)(n.p,{children:"Assuming default ports are used, the following should be configured for PFNs:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Open the following TCP ports:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"6182"})," \u2013 ",(0,t.jsx)(n.strong,{children:"Public network"}),": Open this port publicly to enable PFNs to connect to your VFN."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Close the following TCP ports:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"9101"})," \u2013 ",(0,t.jsx)(n.strong,{children:"Inspection service"}),": Close this port to prevent unauthorized metric inspection."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"9102"})," \u2013 ",(0,t.jsx)(n.strong,{children:"Admin service"}),": Close this port to prevent unauthorized admin service interaction."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"80/8080"})," ",(0,t.jsx)(n.strong,{children:"REST API"}),": Close this port to prevent unauthorized REST API access."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{title:"Exposing services",type:"danger",children:(0,t.jsxs)(n.p,{children:["We note that the inspection service port (",(0,t.jsx)(n.code,{children:"9101"}),"), admin service port (",(0,t.jsx)(n.code,{children:"9102"}),") and the REST API port (",(0,t.jsx)(n.code,{children:"80"})," or ",(0,t.jsx)(n.code,{children:"8080"}),")\nare likely useful for your internal network, e.g., application development and debugging. However, the inspection service\nport and the admin service port should never be exposed publicly as they can be easily abused. Similarly, if you choose\nto expose the REST API endpoint publicly, you should deploy an additional authentication or rate-limiting mechanism to\nprevent abuse."]})}),"\n",(0,t.jsx)(n.admonition,{title:"Default network settings",type:"info",children:(0,t.jsxs)(n.p,{children:["You may also need to update the 127.0.0.1 with 0.0.0.0 in the ",(0,t.jsx)(n.code,{children:"fullnode.yaml"})," for the fields ",(0,t.jsx)(n.code,{children:"listen_address"})," and ",(0,t.jsx)(n.code,{children:"address"})," field in the ",(0,t.jsx)(n.code,{children:"api"})," list."]})}),"\n",(0,t.jsx)(n.h3,{id:"storage-requirements",children:"Storage requirements"}),"\n",(0,t.jsx)(n.p,{children:"The amount of data stored by Aptos depends on the ledger history (length) of the blockchain and the number of\non-chain states (e.g., accounts and resources). Both the ledger history and the number of\non-chain states depend on several additional factors, including the age of the blockchain, the average transaction\nrate over time, and the configuration of the ledger database pruner."}),"\n",(0,t.jsx)(n.p,{children:"Note that because archival nodes store the entire history of the blockchain, the database size on archival nodes\nwill continue to grow unbounded. As a result, we cannot provide a recommendation for archival node storage sizes."}),"\n",(0,t.jsx)(n.admonition,{title:"Devnet blockchain storage",type:"tip",children:(0,t.jsxs)(n.p,{children:["The Aptos devnet is currently reset on a weekly basis. If you are deploying a devnet PFN, this means that the storage\nwill be reset (i.e., wiped) every week. See the ",(0,t.jsx)(n.code,{children:"#devnet-release"})," channel on the Aptos Discord."]})}),"\n",(0,t.jsx)(n.h2,{id:"deploying-a-pfn",children:"Deploying a PFN"}),"\n",(0,t.jsxs)(n.p,{children:["You can deploy a PFN in one of two ways: (i) building and running\n",(0,t.jsx)(n.a,{href:"https://github.com/aptos-labs/aptos-core",children:"aptos-core"})," from source code; or (ii) using Docker. This document describes\nhow to deploy your PFN using both methods."]}),"\n",(0,t.jsx)(n.h3,{id:"method-1-building-and-running-from-source",children:"Method 1: Building and running from source"}),"\n",(0,t.jsxs)(n.p,{children:["First, see ",(0,t.jsx)(n.a,{href:"/guides/building-from-source",children:"Building Aptos From Source"})," for instructions on how to download the ",(0,t.jsx)(n.code,{children:"aptos-core"})," repository and build the binary.\nThen, follow the steps below:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Make sure your current working directory is ",(0,t.jsx)(n.code,{children:"aptos-core"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Check out the ",(0,t.jsx)(n.code,{children:"mainnet"})," branch using ",(0,t.jsx)(n.code,{children:"git checkout --track origin/mainnet"}),"; remember, you may instead use ",(0,t.jsx)(n.code,{children:"devnet"})," or ",(0,t.jsx)(n.code,{children:"testnet"}),"\nif you wish to run your PFN in a different network."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Next, download the ",(0,t.jsx)(n.code,{children:"genesis.blob"})," and ",(0,t.jsx)(n.code,{children:"waypoint.txt"})," files for the network your PFN will connect to:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Run this command to download the genesis blob (for mainnet):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -O https://raw.githubusercontent.com/aptos-labs/aptos-networks/main/mainnet/genesis.blob\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Run this command to download the waypoint file (for mainnet):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -O https://raw.githubusercontent.com/aptos-labs/aptos-networks/main/mainnet/waypoint.txt\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{title:"Don't want to connect to mainnet?",type:"caution",children:(0,t.jsxs)(n.p,{children:["To connect to other networks (e.g., ",(0,t.jsx)(n.code,{children:"devnet"})," and ",(0,t.jsx)(n.code,{children:"testnet"}),"), you can find the genesis and waypoint here \u279c ",(0,t.jsx)(n.a,{href:"https://github.com/aptos-labs/aptos-networks",children:"https://github.com/aptos-labs/aptos-networks"}),".\nBe sure to download the ",(0,t.jsx)(n.code,{children:"genesis.blob"})," and ",(0,t.jsx)(n.code,{children:"waypoint.txt"})," for those networks, instead of using the genesis\nand waypoint pointed to by the ",(0,t.jsx)(n.code,{children:"curl"})," commands above."]})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Next, run the command below to create a copy of the PFN configuration YAML template:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cp config/src/config/test_data/public_full_node.yaml fullnode.yaml\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Finally, edit the ",(0,t.jsx)(n.code,{children:"fullnode.yaml"})," configuration file to ensure that your PFN: (i) contains the genesis blob\nand waypoint file you just downloaded; and (ii) saves the synchronized blockchain data to the location of your\nchoice (on your local machine). To do this:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Specify the correct path to the ",(0,t.jsx)(n.code,{children:"genesis.blob"})," file you just downloaded by editing ",(0,t.jsx)(n.code,{children:"execution.genesis_file_location"})," in the ",(0,t.jsx)(n.code,{children:"fullnode.yaml"})," configuration. By default, it points to ",(0,t.jsx)(n.code,{children:"genesis.blob"})," in the current working directory.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'execution:\n  genesis_file_location: "./genesis.blob"\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Specify the correct path to the ",(0,t.jsx)(n.code,{children:"waypoint.txt"})," file you just downloaded by editing ",(0,t.jsx)(n.code,{children:"base.waypoint.from_file"})," in the ",(0,t.jsx)(n.code,{children:"fullnode.yaml"})," configuration. By default, it points to ",(0,t.jsx)(n.code,{children:"waypoint.txt"})," in the current working directory. For example:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'base:\n  waypoint:\n    from_file: "./waypoint.txt"\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Specify the directory on your local machine that you want to store the blockchain database by editing the ",(0,t.jsx)(n.code,{children:"base.data_dir"})," in the ",(0,t.jsx)(n.code,{children:"fullnode.yaml"})," configuration. For example, you can create a directory ",(0,t.jsx)(n.code,{children:"my-full-node/data"})," in your home directory and specify it as:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'base:\n  data_dir: "</path/to/my/homedir/my-full-node/data>"\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Start your local public fullnode by running the below command:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cargo run -p aptos-node --release -- -f ./fullnode.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"You have now successfully configured and started running a PFN in the Aptos mainnet."}),"\n",(0,t.jsx)(n.admonition,{title:"Debugging?",type:"tip",children:(0,t.jsxs)(n.p,{children:["The command above will build a release binary for ",(0,t.jsx)(n.code,{children:"aptos-node"})," at: ",(0,t.jsx)(n.code,{children:"aptos-core/target/release/aptos-node"}),". The release\nbinaries tend to be substantially faster than debug binaries but lack debugging information useful for development.\nTo build a debug binary, omit the ",(0,t.jsx)(n.code,{children:"--release"})," flag from the command above."]})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"method-2-using-docker",children:"Method 2: Using Docker"}),"\n",(0,t.jsx)(n.p,{children:"This section describes how to configure and run your PFN using Docker."}),"\n",(0,t.jsx)(n.admonition,{title:"Supported only on x86-64 CPUs",type:"danger",children:(0,t.jsxs)(n.p,{children:["Running aptos-core via Docker is currently only supported on x86-64 CPUs. If you have an Apple M1/M2 (ARM64) Mac, use\nthe aptos-core source code approach (above). If M1/M2 support is important to you, comment on this\nissue: ",(0,t.jsx)(n.a,{href:"https://github.com/aptos-labs/aptos-core/issues/1412",children:"https://github.com/aptos-labs/aptos-core/issues/1412"})]})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["First, install ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/get-docker/",children:"Docker"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Next, run the following script to prepare your local configuration and data directory for mainnet. This will\ndownload the ",(0,t.jsx)(n.code,{children:"fullnode.yaml"})," configuration file, the ",(0,t.jsx)(n.code,{children:"genesis.blob"})," and ",(0,t.jsx)(n.code,{children:"waypoint.txt"})," files for your PFN, and\ncreate a ",(0,t.jsx)(n.code,{children:"data"})," directory to store the blockchain database:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mkdir mainnet && cd mainnet\nmkdir data && \\\ncurl -O https://raw.githubusercontent.com/aptos-labs/aptos-core/mainnet/docker/compose/aptos-node/fullnode.yaml && \\\ncurl -O https://raw.githubusercontent.com/aptos-labs/aptos-networks/main/mainnet/waypoint.txt && \\\ncurl -O https://raw.githubusercontent.com/aptos-labs/aptos-networks/main/mainnet/genesis.blob\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"Don't want to connect to mainnet?",type:"caution",children:(0,t.jsxs)(n.p,{children:["To connect to other networks (e.g., ",(0,t.jsx)(n.code,{children:"devnet"})," and ",(0,t.jsx)(n.code,{children:"testnet"}),"), you can find the genesis and waypoint here \u279c ",(0,t.jsx)(n.a,{href:"https://github.com/aptos-labs/aptos-networks",children:"https://github.com/aptos-labs/aptos-networks"}),".\nBe sure to download the ",(0,t.jsx)(n.code,{children:"genesis.blob"})," and ",(0,t.jsx)(n.code,{children:"waypoint.txt"})," for those networks, instead of using the genesis\nand waypoint pointed to by the ",(0,t.jsx)(n.code,{children:"curl"})," commands above."]})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["Next, make sure that the ",(0,t.jsx)(n.code,{children:"fullnode.yaml"})," configuration file that you downloaded above contains only the following content.\nThis will ensure that this configuration is for a PFN and not for another node type (e.g., validator or VFN):"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'base:\n  role: "full_node"\n  data_dir: "/opt/aptos/data"\n  waypoint:\n    from_file: "/opt/aptos/etc/waypoint.txt"\n\nexecution:\n  genesis_file_location: "/opt/aptos/etc/genesis.blob"\n\nfull_node_networks:\n  - network_id: "public"\n    discovery_method: "onchain"\n    listen_address: "/ip4/0.0.0.0/tcp/6182"\n\napi:\n  enabled: true\n  address: "0.0.0.0:8080"\n'})}),"\n",(0,t.jsx)(n.admonition,{title:"Don't want to allow inbound connections?",type:"caution",children:(0,t.jsxs)(n.p,{children:["Override the following if you do not want other PFNs connecting to yours: ",(0,t.jsx)(n.code,{children:'listen_address: "/ip4/127.0.0.1/tcp/6182"'}),". Also see the note, below."]})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:["Next, run the following ",(0,t.jsx)(n.code,{children:"docker"})," command:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run --pull=always \\\n    --rm -p 8080:8080 \\\n    -p 9101:9101 -p 6180:6180 \\\n    -v $(pwd):/opt/aptos/etc -v $(pwd)/data:/opt/aptos/data \\\n    --workdir /opt/aptos/etc \\\n    --name=aptos-fullnode aptoslabs/validator:mainnet aptos-node \\\n    -f /opt/aptos/etc/fullnode.yaml\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"Sudo access",type:"caution",children:(0,t.jsxs)(n.p,{children:["Note: you may need to prefix the docker command with ",(0,t.jsx)(n.code,{children:"sudo"})," depending on your configuration."]})}),"\n",(0,t.jsx)(n.admonition,{title:"Docker tags",type:"info",children:(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"mainnet"})," tag always refers to the latest official Docker image tag. You can find the latest hash for comparison at:\n",(0,t.jsx)(n.a,{href:"https://github.com/aptos-labs/aptos-networks/tree/main/mainnet",children:"https://github.com/aptos-labs/aptos-networks/tree/main/mainnet"})]})}),"\n",(0,t.jsx)(n.h2,{id:"verify-the-correctness-of-your-pfn",children:"Verify the correctness of your PFN"}),"\n",(0,t.jsx)(n.h3,{id:"verify-initial-synchronization",children:"Verify initial synchronization"}),"\n",(0,t.jsxs)(n.p,{children:["During the initial synchronization of your PFN, there may be a lot of data to transfer (read more about how state\nsync works in the ",(0,t.jsx)(n.a,{href:"/guides/state-sync",children:"state sync"})," guide). You can monitor state sync progress\nby querying the metrics port to see what version your node is currently synced to. Run the following example\ncommand to see the currently synced version of your node:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl 127.0.0.1:9101/metrics 2> /dev/null | grep "aptos_state_sync_version{.*\\"synced\\"}" | awk \'{print $2}\'\n'})}),"\n",(0,t.jsx)(n.p,{children:"The command will output the current synced version of your node. For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"71000\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Compare the synced version returned by this command (e.g., ",(0,t.jsx)(n.code,{children:"71000"}),") with the highest version shown on the\n",(0,t.jsx)(n.a,{href:"https://explorer.aptoslabs.com/?network=mainnet",children:"Aptos explorer page"}),". If your node is catching up to the highest\nversion, it is synchronizing correctly. It is fine if the explorer page differs by a few versions, as the explorer\nnodes may sync with some variance."]}),"\n",(0,t.jsxs)(n.admonition,{title:"Using fast sync?",type:"caution",children:[(0,t.jsxs)(n.p,{children:["If your node is fast syncing, the command may show ",(0,t.jsx)(n.code,{children:"0"})," until it has finally caught up. To verify that the node is\nfast syncing, run the following command:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl 127.0.0.1:9101/metrics 2> /dev/null | grep "aptos_state_sync_version{.*\\"synced_states\\"}" | awk \'{print $2}\'\n'})}),(0,t.jsxs)(n.p,{children:["This should show an increasing number of synced states. It may take several hours for your node to fast sync to the\nlatest version. Eventually, once fast syncing is complete, the ",(0,t.jsx)(n.code,{children:'aptos_state_sync_version{.*"synced"}'})," command will\nreturn the current synced version of your node."]}),(0,t.jsxs)(n.p,{children:["You can read more about fast syncing here: ",(0,t.jsx)(n.a,{href:"/guides/state-sync#bootstrapping-phase",children:"State sync bootstrapping"}),"."]})]}),"\n",(0,t.jsx)(n.h3,{id:"optional-verify-outbound-network-connections",children:"(Optional) Verify outbound network connections"}),"\n",(0,t.jsxs)(n.p,{children:["If you wish, you can also check the outbound network connections for your PFN. The number of outbound network\nconnections should be more than ",(0,t.jsx)(n.code,{children:"0"})," for healthy PFNs. Run the following command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl 127.0.0.1:9101/metrics 2> /dev/null | grep "aptos_connections{direction=\\"outbound\\""\n'})}),"\n",(0,t.jsx)(n.p,{children:"The above command will output the number of outbound network connections for your node. For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl 127.0.0.1:9101/metrics 2> /dev/null | grep "aptos_connections{direction=\\"outbound\\""\naptos_connections{direction="outbound",network_id="Public",peer_id="aabd651f",role_type="full_node"} 3\n'})}),"\n",(0,t.jsxs)(n.p,{children:["If the number of outbound connections returned is ",(0,t.jsx)(n.code,{children:"0"}),", then it means your node cannot connect to the Aptos blockchain. If this happens to you, follow these steps to resolve the issue:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Update your node to the latest release by following the ",(0,t.jsx)(n.a,{href:"/nodes/full-node/update-fullnode-with-new-devnet-releases",children:"Update Fullnode With New Releases"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Remove any ",(0,t.jsx)(n.code,{children:"seed"})," peers you may have added to your configuration file. The seeds may be preventing you from\nconnecting to the network. Seed peers are discussed in the ",(0,t.jsx)(n.a,{href:"/nodes/full-node/fullnode-network-connections#connecting-your-fullnode-to-seed-peers",children:"Connecting your fullnode to seed peers"})," section."]}),"\n",(0,t.jsxs)(n.li,{children:["Ensure that you have used the correct ",(0,t.jsx)(n.code,{children:"genesis.blob"})," and ",(0,t.jsx)(n.code,{children:"waypoint.txt"})," files for your network. This is a common error."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"optional-examine-docker-ledger-size",children:"(Optional) Examine Docker ledger size"}),"\n",(0,t.jsx)(n.p,{children:"If you are running your PFN using Docker, you can monitor the size of the blockchain ledger by entering the Docker\ncontainer and checking the size. This will allow you to see how much storage the blockchain ledger is currently consuming."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["First, run ",(0,t.jsx)(n.code,{children:"docker container ls"})," on your terminal and copy the NAME field output. This will be a string similar to ",(0,t.jsx)(n.code,{children:"public_full_node_fullnode_1"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Next, run these commands to check the storage size consumed by the ledger, using the NAME field you copied over in place of ",(0,t.jsx)(n.code,{children:"public_full_node_fullnode_1"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Obtain the container ID:\nid=$(docker container ls | grep public_full_node_fullnode_1 | grep -oE "^[0-9a-zA-Z]+")\n\n# Enter the container:\ndocker exec -it $id /bin/bash\n\n# Observe the volume (ledger) size:\ndu -cs -BM /opt/aptos/data\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},83581:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>a});var t=o(11855);const s={},i=t.createContext(s);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);