"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[6776],{71089:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>t,contentTitle:()=>r,default:()=>u,frontMatter:()=>d,metadata:()=>a,toc:()=>i});var c=o(63159),s=o(83581);const d={title:"Programmatic Upgradeable Module"},r="Programmatic Upgradeable Module",a={id:"tutorials/programmatic-upgradeable-module",title:"Programmatic Upgradeable Module",description:"This tutorial will go over two sections:",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/tutorials/programmatic-upgradeable-module.md",sourceDirName:"tutorials",slug:"/tutorials/programmatic-upgradeable-module",permalink:"/tutorials/programmatic-upgradeable-module",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/tutorials/programmatic-upgradeable-module.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Programmatic Upgradeable Module"}},t={},i=[{value:"How to publish modules to a resource account",id:"how-to-publish-modules-to-a-resource-account",level:2},{value:"Example resource account address creation:",id:"example-resource-account-address-creation",level:4},{value:"How to upgrade modules in a resource account",id:"how-to-upgrade-modules-in-a-resource-account",level:2},{value:"Note that we need to redeploy the module to make it upgradeable, we\u2019ll go over the steps again below.",id:"note-that-we-need-to-redeploy-the-module-to-make-it-upgradeable-well-go-over-the-steps-again-below",level:3},{value:"Publish the upgradeable module",id:"publish-the-upgradeable-module",level:4},{value:"2.1. Code Changes",id:"21-code-changes",level:3},{value:"2.1.1. Code Changes - <code>upgrade</code>",id:"211-code-changes---upgrade",level:4},{value:"2.2. Upgrade the module",id:"22-upgrade-the-module",level:3},{value:"Appendix",id:"appendix",level:2},{value:"Addresses with Empty Placeholders",id:"addresses-with-empty-placeholders",level:3},{value:"Generate <code>upgrade</code> function payload with new function added in upgraded module",id:"generate-upgrade-function-payload-with-new-function-added-in-upgraded-module",level:3},{value:"Environment variables",id:"environment-variables",level:4}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h1,{id:"programmatic-upgradeable-module",children:"Programmatic Upgradeable Module"}),"\n",(0,c.jsx)(n.p,{children:"This tutorial will go over two sections:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"How to publish modules to a resource account."}),"\n",(0,c.jsx)(n.li,{children:"How to upgrade modules in a resource account."}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["A ",(0,c.jsx)(n.a,{href:"https://aptos.dev/move/move-on-aptos/resource-accounts/",children:"resource account"})," is a developer feature used to manage resources independent of an account managed by a user,\nspecifically publishing modules and providing on-chain-only access control, e.g. signers."]}),"\n",(0,c.jsx)(n.p,{children:"Typically, a resource account is used for two main purposes:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Store and isolate resources; a module creates a resource account just to host specific resources."}),"\n",(0,c.jsx)(n.li,{children:"Publish module as a standalone (resource) account, a building block in a decentralized design where no private keys can control the resource account. The ownership (SignerCap) can be kept in another module, such as governance."}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["The first step will go over section 1: ",(0,c.jsx)(n.strong,{children:"How to publish modules to a resource account."})]}),"\n",(0,c.jsx)(n.h2,{id:"how-to-publish-modules-to-a-resource-account",children:"How to publish modules to a resource account"}),"\n",(0,c.jsx)(n.p,{children:"Before publishing the module, we want to create a resource account prior, so that the module then gets uploaded to the resource account.\nBut first, we must calculate the resource account address. This will be needed in the next steps later."}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Calculate resource account address."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"aptos account derive-resource-account-address --address <your_address> --seed <seed>"})}),"\n",(0,c.jsx)(n.h4,{id:"example-resource-account-address-creation",children:"Example resource account address creation:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"aptos account derive-resource-account-address --address 0x1c3e5555728c3d0d544f5679229fac153c5f7d78b323751b41860c5ffcc21cfd --seed random3\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Running the above will result in the newly created resource account address:\n",(0,c.jsx)(n.code,{children:"f48832b9e57bccc6943ec567f95b1cddab880d2e979706bc988d3e8f440ff2dd"})]}),"\n",(0,c.jsxs)(n.p,{children:["Prepend ",(0,c.jsx)(n.code,{children:"0x"})," at the beginning, resulting in ",(0,c.jsx)(n.code,{children:"0xf48832b9e57bccc6943ec567f95b1cddab880d2e979706bc988d3e8f440ff2dd"})]}),"\n",(0,c.jsxs)(n.ol,{start:"2",children:["\n",(0,c.jsxs)(n.li,{children:["You will now need to change all the module contracts addresses with the ",(0,c.jsx)(n.code,{children:"resource_account"}),". For example in your module, you may have ",(0,c.jsx)(n.code,{children:"your_module"})," as your account address."]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-move",children:"module your_module::user_info {\n\t// Your code...\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Simply replace this with"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-move",children:"module resource_account::user_info {\n\t// Your code...\n}\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"0xf48832b9e57bccc6943ec567f95b1cddab880d2e979706bc988d3e8f440ff2dd"})," is the resource account address calculated, note this down in your ",(0,c.jsx)(n.code,{children:"Move.toml"})," file, under the ",(0,c.jsx)(n.code,{children:"[addresses]"})," section."]}),"\n",(0,c.jsxs)(n.li,{children:["Add a new entry ",(0,c.jsx)(n.code,{children:"resource_account"})," and add the address generated as the value. in ",(0,c.jsx)(n.code,{children:"Move.toml"})]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'[addresses]\nyour_module = "0x1c3e5555728c3d0d544f5679229fac153c5f7d78b323751b41860c5ffcc21cfd"\nresource_account = "0xf48832b9e57bccc6943ec567f95b1cddab880d2e979706bc988d3e8f440ff2dd"\n'})}),"\n",(0,c.jsxs)(n.ol,{start:"3",children:["\n",(0,c.jsxs)(n.li,{children:["Now run the command: ",(0,c.jsx)(n.code,{children:"aptos move create-resource-account-and-publish-package --address-name <your-address> --seed <seed>"}),".\nIt will ask for permission to spend gas (octas) for the transaction to go through. Once confirmed, you should see a result of ",(0,c.jsx)(n.strong,{children:"success"}),".\nTo do this, we run the command:"]}),"\n"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"aptos move create-resource-account-and-publish-package --address-name <your-address> --seed <seed>"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Replace ",(0,c.jsx)(n.code,{children:"<your-address>"})," with your account address."]}),"\n",(0,c.jsxs)(n.li,{children:["Replace ",(0,c.jsx)(n.code,{children:"<seed>"})," with a seed that only you know. This is used as a custom input to generate the resource account address."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["When running this command, this will ",(0,c.jsx)(n.strong,{children:"FIRST calculate"})," your resource account address.\nA prompt below will show:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"Do you want to publish this package under the resource account's address\n0xf48832b9e57bccc6943ec567f95b1cddab880d2e979706bc988d3e8f440ff2dd? [yes/no]\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Make sure this is the address we calculated above. If you have placeholder addresses, .e.g: ",(0,c.jsx)(n.code,{children:"_"})," as addresses, refer to: ",(0,c.jsx)(n.a,{href:"#addresses-with-empty-placeholders",children:"Placeholder addresses"})]}),"\n",(0,c.jsxs)(n.p,{children:["Congratulations, you have deployed your module onto a resource account. To verify,\ncheck the ",(0,c.jsx)(n.a,{href:"https://explorer.aptoslabs.com/",children:(0,c.jsx)(n.strong,{children:"Aptos explorer"})})," and search for your resource account address.\nClick on ",(0,c.jsx)(n.code,{children:"Modules"})," tab and you should see the code/module published onto the account.\n",(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.a,{href:"https://explorer.aptoslabs.com/account/0x090ad1536fe5cfcb5632b3026f99f8415c55b69ce54b6f17ed8cd7edbcb5edfa/modules/code/user_info?network=devnet",children:"Example"})})]}),"\n",(0,c.jsx)(n.h2,{id:"how-to-upgrade-modules-in-a-resource-account",children:"How to upgrade modules in a resource account"}),"\n",(0,c.jsx)(n.p,{children:"Now that we have published a module onto a resource account, the next step would be attempting to upgrade the module."}),"\n",(0,c.jsxs)(n.p,{children:["The Aptos blockchain natively supports different ",(0,c.jsx)(n.em,{children:"upgrade policies"}),", which allow move developers to explicitly define the constraints around how their move code can be upgraded. The default policy is ",(0,c.jsx)(n.em,{children:"backwards compatible"}),". This means that code upgrades are accepted only if they guarantee that no existing resource storage or public APIs are broken by the upgrade (including public functions). This compatibility checking is possible because of Move's strongly typed bytecode semantics."]}),"\n",(0,c.jsxs)(n.p,{children:["More information: ",(0,c.jsx)(n.a,{href:"https://aptos.dev/move/book/package-upgrades/",children:"https://aptos.dev/move/book/package-upgrades/"})]}),"\n",(0,c.jsx)(n.h3,{id:"note-that-we-need-to-redeploy-the-module-to-make-it-upgradeable-well-go-over-the-steps-again-below",children:"Note that we need to redeploy the module to make it upgradeable, we\u2019ll go over the steps again below."}),"\n",(0,c.jsx)(n.h4,{id:"publish-the-upgradeable-module",children:"Publish the upgradeable module"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Change ",(0,c.jsx)(n.code,{children:"Move.toml"})," to include the ",(0,c.jsx)(n.code,{children:"upgrade_policy"}),", we\u2019ll set this to ",(0,c.jsx)(n.code,{children:"compatible"}),"."]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-toml",children:'[package]\nname = "MyApp"\nversion = "0.0.1"\nupgrade_policy = "compatible"\n...\n'})}),"\n",(0,c.jsx)(n.h3,{id:"21-code-changes",children:"2.1. Code Changes"}),"\n",(0,c.jsx)(n.p,{children:"To make a module upgradeable, there are two functions which need to be implemented."}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"init_module"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"upgrade"})}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"init_module"})," is the constructor of the module, it is called by the Move VM when deploying a module. It\u2019s important to note that the ",(0,c.jsx)(n.code,{children:"signer"})," generated from the VM is only generated once.\nWe need to generate a ",(0,c.jsx)(n.code,{children:"SignerCapability"})," from this, and store it. Here is an example of how to store this safely:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-move",children:"module resource_account::user_info {\n\n\tstruct Config has key {\n\t    owner: address,\n\t    signer_cap: SignerCapability,\n\t}\n\n\tconst OWNER: address = @your_module;\n\tconst RESOURCE_ACCOUNT: address = @resource_account;\n\n\t/// `resource_account` injected from Move VM\n\tfun init_module(resource_account: &signer) {\n\t    // Must create this struct on constructor level, as we don't get the signer back when we create a resource account.\n\t    // The signer_cap was created from creating the resource account prior to creating this contract.\n\t    let signer_cap = resource_account::retrieve_resource_account_cap(resource_account, OWNER);\n\t    move_to(resource_account, Config {\n\t        owner: OWNER,\n\t        signer_cap,\n\t    });\n\t}\n}\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Here we retrieve the ",(0,c.jsx)(n.code,{children:"signer_cap"})," which was generated when creating the resource account."]}),"\n",(0,c.jsxs)(n.li,{children:["We then create a ",(0,c.jsx)(n.code,{children:"Config"})," resource, store the ",(0,c.jsx)(n.code,{children:"signer_cap"})," and the original owner of the module. In this case, it is original address. We\u2019ll use this information to configure access permissions when upgrading the module."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"Config"})," is then moved to the ",(0,c.jsx)(n.code,{children:"resource_account"})," signer in global storage."]}),"\n"]}),"\n",(0,c.jsxs)(n.h4,{id:"211-code-changes---upgrade",children:["2.1.1. Code Changes - ",(0,c.jsx)(n.code,{children:"upgrade"})]}),"\n",(0,c.jsxs)(n.p,{children:["The second function is to define the ",(0,c.jsx)(n.code,{children:"upgrade"})," function. This must be a ",(0,c.jsx)(n.code,{children:"entry"})," function as it\u2019s being called from a transaction. Here\u2019s an example of the function with access control configured."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-move",children:"module resource_account::user_info {\n\n\tconst RESOURCE_ACCOUNT: address = @resource_account;\n\n\tpublic entry fun upgrade(\n\t        owner: &signer,\n\t        metadata_serialized: vector<u8>,\n\t        code: vector<vector<u8>>,\n\t    ) acquires Config {\n\t        // Get the config we sent in the `init_module` to the resource_account.\n\t        let config = borrow_global<Config>(RESOURCE_ACCOUNT);\n\t        assert!(config.owner == signer::address_of(owner), 1);\n\n\t        // The resource account `signer` is needed to publish/upgrade the contract\n\t        let signer = account::create_signer_with_capability(&config.signer_cap);\n\t        code::publish_package_txn(&signer, metadata_serialized, code);\n\t    }\n}\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["In the ",(0,c.jsx)(n.code,{children:"init_module"}),", we moved the ",(0,c.jsx)(n.code,{children:"Config"})," to the resource account signer. In this function, we retrieve it, and validate that the calling user is the ",(0,c.jsx)(n.code,{children:"owner"})," from the ",(0,c.jsx)(n.code,{children:"Config"})," resource."]}),"\n",(0,c.jsxs)(n.li,{children:["We then generate a ",(0,c.jsx)(n.code,{children:"signer"})," from the ",(0,c.jsx)(n.code,{children:"signer_cap"})," from the ",(0,c.jsx)(n.code,{children:"Config"}),", and pass this to ",(0,c.jsx)(n.code,{children:"publish_package_txn"}),", which expects the resource account signer. This is the address that the code will upgrade the packages."]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsxs)(n.strong,{children:["Now that the two functions have been implemented, deploy the module to the resource account,\nfollowing the same steps in section: ",(0,c.jsx)(n.a,{href:"#how-to-publish-modules-to-a-resource-account",children:"How to publish modules to a resource account"})]})}),"\n",(0,c.jsx)(n.h3,{id:"22-upgrade-the-module",children:"2.2. Upgrade the module"}),"\n",(0,c.jsxs)(n.p,{children:["Now that the upgradeable package has been deployed ",(0,c.jsx)(n.em,{children:"(make sure this has been done above)"}),", we can make upgrades to the module. Let\u2019s add a function to the module."]}),"\n",(0,c.jsxs)(n.p,{children:["Make sure the rest of the functions, data structures are kept the same. Remember we made the upgrade_policy as ",(0,c.jsx)(n.code,{children:"compatible"}),". Add a new function below the upgrade function:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-move",children:'public fun new_function_added(): String {\n    string::utf8(b"new_function_added")\n}\n'})}),"\n",(0,c.jsxs)(n.p,{children:["Once the code changes have been made, we need to generate the inputs for ",(0,c.jsx)(n.code,{children:"metadata_serialized"})," and ",(0,c.jsx)(n.code,{children:"code"})," for this ",(0,c.jsx)(n.code,{children:"upgrade"})," entry function. To do this, run:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"aptos move build-publish-payload --json-output-file upgrade.json\n"})}),"\n",(0,c.jsxs)(n.p,{children:["If you have placeholder addresses ",(0,c.jsx)(n.code,{children:"_"})," in your ",(0,c.jsx)(n.code,{children:"Move.toml"})," file, run the command here: ",(0,c.jsx)(n.a,{href:"#generate-upgrade-function-payload-with-new-function-added-in-upgraded-module",children:"Upgrade function payload section"})]}),"\n",(0,c.jsxs)(n.p,{children:["This will create a JSON file ",(0,c.jsx)(n.code,{children:"upgrade.json"}),", with the args of the ",(0,c.jsx)(n.code,{children:"metadata_serialied"})," and ",(0,c.jsx)(n.code,{children:"code"}),". Just need to adjust the ",(0,c.jsx)(n.code,{children:"function_id"})," in the json file, change this to:"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"<resource_account>::user_info::upgrade"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Replace ",(0,c.jsx)(n.code,{children:"<resource_account>"})," with your resource account address."]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["Your ",(0,c.jsx)(n.code,{children:"upgrade.json"})," file should look like:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "function_id": "0xf48832b9e57bccc6943ec567f95b1cddab880d2e979706bc988d3e8f440ff2dd::user_info::upgrade",\n  "type_args": [],\n  "args": [\n    {\n      "type": "hex",\n      "value": "0x0e436f646544657..."\n    },\n    {\n      "type": "hex",\n      "value": ["0xa11ceb0b060000000a01000c020c1..."]\n    }\n  ]\n}\n'})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Now deploy the modified contract:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"aptos move run --json-file upgrade.json\n"})}),"\n",(0,c.jsx)(n.p,{children:"Now check the explorer,"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Search for your resource account address."}),"\n",(0,c.jsxs)(n.li,{children:["Click ",(0,c.jsx)(n.code,{children:"Modules"})]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["You should see the source code with the new function ",(0,c.jsx)(n.code,{children:"new_function_added"})," added. It should look like"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-move",children:'    public entry fun upgrade(\n        owner: &signer,\n        metadata_serialized: vector<u8>,\n        code: vector<vector<u8>>,\n    ) acquires Config {\n        // Get the config we sent in the `init_module` to resource_account\n        let config = borrow_global<Config>(RESOURCE_ACCOUNT);\n        assert!(config.owner == signer::address_of(owner), 1);\n\n        // This is needed to publish/upgrade the contract\n        let signer = account::create_signer_with_capability(&config.signer_cap);\n        code::publish_package_txn(&signer, metadata_serialized, code);\n    }\n\n    public fun new_function_added(): String {\n        string::utf8(b"new_function_added")\n    }\n'})}),"\n",(0,c.jsx)(n.p,{children:"This concludes the tutorial."}),"\n",(0,c.jsx)(n.h2,{id:"appendix",children:"Appendix"}),"\n",(0,c.jsx)(n.h3,{id:"addresses-with-empty-placeholders",children:"Addresses with Empty Placeholders"}),"\n",(0,c.jsxs)(n.p,{children:["If your ",(0,c.jsx)(n.code,{children:"[addresses]"})," have empty placeholders, e.g:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-toml",children:'[addresses]\nyour_module = "_"\nresource_account = "_"\n'})}),"\n",(0,c.jsx)(n.p,{children:"Run:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"aptos move create-resource-account-and-publish-package --address-name \\\nyour_module=0x1c3e5555728c3d0d544f5679229fac153c5f7d78b323751b41860c5ffcc21cfd --seed random3 --named-addresses \\\nyour_module=0x1c3e5555728c3d0d544f5679229fac153c5f7d78b323751b41860c5ffcc21cfd,resource_account=0xf48832b9e57bccc6943ec567f95b1cddab880d2e979706bc988d3e8f440ff2dd\n"})}),"\n",(0,c.jsxs)(n.h3,{id:"generate-upgrade-function-payload-with-new-function-added-in-upgraded-module",children:["Generate ",(0,c.jsx)(n.code,{children:"upgrade"})," function payload with new function added in upgraded module"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"aptos move build-publish-payload --json-output-file upgrade.json --named-addresses \\\nyour_module=0x1c3e5555728c3d0d544f5679229fac153c5f7d78b323751b41860c5ffcc21cfd,resource_account=0xf48832b9e57bccc6943ec567f95b1cddab880d2e979706bc988d3e8f440ff2dd\n"})}),"\n",(0,c.jsx)(n.p,{children:"To mitigate mistakes and improve user experience, you should use environment variables,\nbelow is an example of how to use them accordingly. (Note this is for Unix)"}),"\n",(0,c.jsx)(n.h4,{id:"environment-variables",children:"Environment variables"}),"\n",(0,c.jsxs)(n.p,{children:["To replace the hard-coded addresses in the ",(0,c.jsx)(n.code,{children:"aptos move build-publish-payload"})," command\nwith environment variables for easier use, follow the steps below."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:'export YOUR_MODULE_ADDRESS="0x1c3e5555728c3d0d544f5679229fac153c5f7d78b323751b41860c5ffcc21cfd"\nexport RESOURCE_ACCOUNT_ADDRESS="0xf48832b9e57bccc6943ec567f95b1cddab880d2e979706bc988d3e8f440ff2dd"\n'})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"aptos move build-publish-payload \\\n--json-output-file upgrade.json \\\n--named-addresses your_module=$YOUR_MODULE_ADDRESS,resource_account=$RESOURCE_ACCOUNT_ADDRESS\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},83581:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>a});var c=o(11855);const s={},d=c.createContext(s);function r(e){const n=c.useContext(d);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),c.createElement(d.Provider,{value:n},e.children)}}}]);