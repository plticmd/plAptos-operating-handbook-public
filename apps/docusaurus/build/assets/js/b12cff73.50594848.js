"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[1095],{2093:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>d,metadata:()=>r,toc:()=>a});var t=n(63159),i=n(83581);const d={title:"Shutdown Nodes",slug:"shutting-down-nodes"},s="Shutdown Nodes",r={id:"nodes/validator-node/operator/shutting-down-nodes",title:"Shutdown Nodes",description:"If you want to shut down your validator and validator fullnode (VFN), follow the instructions below to leave the",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/nodes/validator-node/operator/shutting-down-nodes.md",sourceDirName:"nodes/validator-node/operator",slug:"/nodes/validator-node/operator/shutting-down-nodes",permalink:"/nodes/validator-node/operator/shutting-down-nodes",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/nodes/validator-node/operator/shutting-down-nodes.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Shutdown Nodes",slug:"shutting-down-nodes"},sidebar:"nodeSidebar",previous:{title:"Upgrade Nodes",permalink:"/nodes/validator-node/operator/update-validator-node"},next:{title:"Run a Public Fullnode",permalink:"/nodes/full-node/public-fullnode"}},l={},a=[{value:"Leave the validator set",id:"leave-the-validator-set",level:2},{value:"Shutdown methods",id:"shutdown-methods",level:2},{value:"Using Source Code",id:"using-source-code",level:2},{value:"Using Docker",id:"using-docker",level:2},{value:"Using Terraform",id:"using-terraform",level:2}];function h(e){const o={admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h1,{id:"shutdown-nodes",children:"Shutdown Nodes"}),"\n",(0,t.jsx)(o.p,{children:"If you want to shut down your validator and validator fullnode (VFN), follow the instructions below to leave the\nvalidator set and clean up the resources used by the nodes."}),"\n",(0,t.jsx)(o.admonition,{title:"Leave the validator set first",type:"danger",children:(0,t.jsx)(o.p,{children:"It is important to leave the validator set before shutting down your nodes. Otherwise, you will reduce stake\nparticipation in the network and risk degrading network health."})}),"\n",(0,t.jsx)(o.h2,{id:"leave-the-validator-set",children:"Leave the validator set"}),"\n",(0,t.jsx)(o.p,{children:"Before shutting down your nodes, you must leave the validator set. This will ensure that your node is no longer\nresponsible for participating in consensus. Validator nodes can leave the validator set at any time. This also\nhappens automatically when there is insufficient stake in the validator account."}),"\n",(0,t.jsxs)(o.p,{children:['When you leave the validator set, your node will be marked as "inactive" in the next epoch. To leave the validator set,\nrun the following command using the Aptos CLI. You will need to set the ',(0,t.jsx)(o.code,{children:"profile"})," and ",(0,t.jsx)(o.code,{children:"owner-address"})," flags."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"aptos node leave-validator-set --profile <operator-profile> --pool-address <owner-address>\n"})}),"\n",(0,t.jsx)(o.admonition,{title:"Waiting for epoch changes",type:"caution",children:(0,t.jsx)(o.p,{children:"If you leave the validator set, it will only take effect at the beginning of the next epoch. You will\nneed to wait for the next epoch to start before shutting down your nodes. Similarly, if you leave\nthe validator set and then rejoin in the same epoch, the rejoin will fail. You should wait for the\nnext epoch to start before rejoining the validator set."})}),"\n",(0,t.jsx)(o.h2,{id:"shutdown-methods",children:"Shutdown methods"}),"\n",(0,t.jsx)(o.p,{children:"Once you have successfully left the validator set, you can shut down your nodes. The method for shutting down your\nnodes depends on how you deployed them. Choose the appropriate section below to shut down your nodes."}),"\n",(0,t.jsx)(o.h2,{id:"using-source-code",children:"Using Source Code"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:["Stop your node by killing the ",(0,t.jsx)(o.code,{children:"aptos-node"})," process. This is sufficient to shut down your node."]}),"\n",(0,t.jsxs)(o.li,{children:["(Optional) If you wish to free up space, remove the data directory, e.g., ",(0,t.jsx)(o.code,{children:"rm -r <your-data-directory>"}),"."]}),"\n",(0,t.jsxs)(o.li,{children:["(Optional) If you wish to reuse your node identity, you should keep the configuration files:","\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"public-keys.yaml"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"private-keys.yaml"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"validator-identity.yaml"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"validator-full-node-identity.yaml"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"using-docker",children:"Using Docker"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:["Stop your node and remove the data volumes by running the command: ",(0,t.jsx)(o.code,{children:"docker compose down --volumes"}),".\nThis is sufficient to shut down your node."]}),"\n",(0,t.jsxs)(o.li,{children:["(Optional) If you wish to reuse your node identity, you should keep the configuration files:","\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"public-keys.yaml"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"private-keys.yaml"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"validator-identity.yaml"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"validator-full-node-identity.yaml"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"using-terraform",children:"Using Terraform"}),"\n",(0,t.jsx)(o.admonition,{type:"tip",children:(0,t.jsx)(o.p,{children:"Terraform is commonly used to setup nodes on cloud providers like AWS, Azure, and GCP."})}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:["Stop your node and delete all the resources by running the command: ",(0,t.jsx)(o.code,{children:"terraform destroy"}),". This\nis sufficient to shut down your node."]}),"\n",(0,t.jsxs)(o.li,{children:["(Optional) If you wish to reuse your node identity, you should keep the configuration files:","\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"public-keys.yaml"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"private-keys.yaml"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"validator-identity.yaml"})}),"\n",(0,t.jsx)(o.li,{children:(0,t.jsx)(o.code,{children:"validator-full-node-identity.yaml"})}),"\n"]}),"\n"]}),"\n"]})]})}function c(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},83581:(e,o,n)=>{n.d(o,{R:()=>s,x:()=>r});var t=n(11855);const i={},d=t.createContext(i);function s(e){const o=t.useContext(d);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(d.Provider,{value:o},e.children)}}}]);