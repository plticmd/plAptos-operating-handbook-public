"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[8365],{58497:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>a,metadata:()=>d,toc:()=>l});var t=o(63159),i=o(83581);const a={title:"Upgrade Nodes",slug:"update-validator-node"},r="Upgrade Nodes",d={id:"nodes/validator-node/operator/update-validator-node",title:"Upgrade Nodes",description:"This section contains tutorials for upgrading your validator and validator fullnode (VFN). Upgrades are a",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/nodes/validator-node/operator/update-validator-node.md",sourceDirName:"nodes/validator-node/operator",slug:"/nodes/validator-node/operator/update-validator-node",permalink:"/nodes/validator-node/operator/update-validator-node",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/nodes/validator-node/operator/update-validator-node.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Upgrade Nodes",slug:"update-validator-node"},sidebar:"nodeSidebar",previous:{title:"Modify Nodes",permalink:"/nodes/validator-node/operator/modify-nodes/modify-validator-node"},next:{title:"Shutdown Nodes",permalink:"/nodes/validator-node/operator/shutting-down-nodes"}},s={},l=[{value:"Simple Upgrade",id:"simple-upgrade",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"upgrade-nodes",children:"Upgrade Nodes"}),"\n",(0,t.jsx)(n.p,{children:"This section contains tutorials for upgrading your validator and validator fullnode (VFN). Upgrades are a\ncommon operation for maintaining your nodes. Aptos Labs frequently releases new versions of the\nAptos node software, and you should keep your nodes up to date to ensure they are secure and reliable."}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsx)(n.p,{children:"Running old node versions and failing to update your nodes can lead to security vulnerabilities, performance\ndegradation, and network instability. It is important to keep your nodes up to date."})}),"\n",(0,t.jsxs)(n.p,{children:["There are two primary ways to upgrade your nodes. The first is a ",(0,t.jsx)(n.strong,{children:"simple"})," ",(0,t.jsx)(n.strong,{children:"upgrade"})," of the node software, and the\nsecond is a more ",(0,t.jsx)(n.strong,{children:"complex"})," ",(0,t.jsx)(n.strong,{children:"failover"})," process between your validator and VFN. The failover process is useful for\nminimizing validator downtime when you need to upgrade."]}),"\n",(0,t.jsx)(n.h2,{id:"simple-upgrade",children:"Simple Upgrade"}),"\n",(0,t.jsx)(n.p,{children:"To perform a simple node upgrade, you can upgrade the validator and VFN individually, one at a time.\nThis process is straightforward and can be repeated for each node. The steps are as follows:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"First, stop the node manually (e.g., the validator or VFN). To stop the node, it will depend on your deployment method."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Next, update the node software to the latest version. This may require downloading the latest binary or Docker image,\nor recompiling the source code. Depending on your deployment method, you can perform this step in the background while the node is still running.\nThis should help minimize downtime."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Finally, once you have updated the node software, restart the node using the latest software version and the original\ncommands you used to start the node."}),"\n",(0,t.jsx)(n.admonition,{title:"Repeat for each node",type:"tip",children:(0,t.jsx)(n.p,{children:"You will need to perform the simple upgrade process for each node individually. This means you will need to upgrade\nthe validator and VFN separately."})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"upgrade-via-vfn-failover",children:"Upgrade via VFN Failover"}),"\n",(0,t.jsx)(n.p,{children:"To minimize validator downtime, you can perform a failover process between your validator and VFN. This process involves\nupgrading the VFN to the latest version and converting it to the validator. Once the VFN has been converted to the new\nvalidator, you can then upgrade the original validator and convert it into the new VFN."}),"\n",(0,t.jsxs)(n.p,{children:["The benefit of this approach is that it minimizes validator downtime by allowing you to prepare the new\nvalidator while the original validator is still running. For a community-provided guide using Docker, see this\n",(0,t.jsx)(n.a,{href:"https://forum.aptoslabs.com/t/failover-and-migrate-validator-nodes-for-less-downtime/144846",children:"Aptos Community Forum Post"}),"."]}),"\n",(0,t.jsxs)(n.admonition,{title:"Node differences",type:"danger",children:[(0,t.jsxs)(n.p,{children:["Before you begin the failover process, it is important to understand that the data maintained by the two nodes\n(i.e., validator and VFN) is not identical. The VFN is missing the ",(0,t.jsx)(n.code,{children:"consensus_db"})," and the ",(0,t.jsx)(n.code,{children:"secure-data.json"}),"\nfile, and both nodes use different configuration files (including identities)."]}),(0,t.jsx)(n.p,{children:"If you are not comfortable with the failover process, you should consider performing a simple upgrade instead."})]}),"\n",(0,t.jsx)(n.p,{children:"To perform a VFN failover upgrade, you should follow these steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Update your DNS to swap the ",(0,t.jsx)(n.a,{href:"/nodes/validator-node/operator/connect-to-aptos-network#3-update-on-chain-network-addresses",children:"network addresses"})," between the validator and VFN."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Stop the VFN and update the node software to the latest version. This may require downloading the latest binary or Docker image,\nor recompiling the source code. In addition, you will need to copy the ",(0,t.jsx)(n.code,{children:"consensus_db"})," and ",(0,t.jsx)(n.code,{children:"secure-data.json"})," file from the validator to the VFN,\nas well as the validator configuration file (including validator identities)."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Once the VFN is primed to become the new validator, you can stop the old validator, and start the new validator\nimmediately. This will minimize validator downtime."}),"\n",(0,t.jsx)(n.admonition,{title:"Only one validator at a time",type:"danger",children:(0,t.jsx)(n.p,{children:"It is important to ensure that only a single validator is running at any given time. If you fail to stop\nthe original validator before starting the new validator, you will have two validators running at the same time,\nand this will lead to consensus failures and performance issues on your nodes."})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Now, you will have a validator running the new code version. Observe that before DNS changes take effect your new\nvalidator will only have outbound connections."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Next, prepare the original validator to become the new VFN. This will involve updating the node software to the latest\nversion, and copying the VFN configuration file (including VFN identities) across."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Once the original validator is ready to become the new VFN, you can start the new VFN."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"Once you have completed the failover process, you should monitor the new validator and VFN to ensure they are running\ncorrectly, and that your validator is still participating in consensus."})})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},83581:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>d});var t=o(11855);const i={},a=t.createContext(i);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);