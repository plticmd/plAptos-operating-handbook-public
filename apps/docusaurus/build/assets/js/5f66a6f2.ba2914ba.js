"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[687],{12221:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var t=o(63159),i=o(83581);const s={title:"Connect to a Network",slug:"connect-to-aptos-network"},r="Connect to a Network",a={id:"nodes/validator-node/operator/connect-to-aptos-network",title:"Connect to a Network",description:"This document describes how to connect your validator and validator fullnode (VFN) to an Aptos network.",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/nodes/validator-node/operator/connect-to-aptos-network.md",sourceDirName:"nodes/validator-node/operator",slug:"/nodes/validator-node/operator/connect-to-aptos-network",permalink:"/nodes/validator-node/operator/connect-to-aptos-network",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/nodes/validator-node/operator/connect-to-aptos-network.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Connect to a Network",slug:"connect-to-aptos-network"},sidebar:"nodeSidebar",previous:{title:"Connect Nodes",permalink:"/nodes/validator-node/operator/connect-nodes/connect-validator-node"},next:{title:"Staking Pool Operations",permalink:"/nodes/validator-node/operator/staking-pool-operations"}},d={},l=[{value:"Initialize the stake pool",id:"initialize-the-stake-pool",level:2},{value:"Join the validator set",id:"join-the-validator-set",level:2},{value:"1. Initialize the Aptos CLI",id:"1-initialize-the-aptos-cli",level:3},{value:"2. Check your account balance",id:"2-check-your-account-balance",level:3},{value:"3. Update on-chain network addresses",id:"3-update-on-chain-network-addresses",level:3},{value:"4. Update on-chain consensus key",id:"4-update-on-chain-consensus-key",level:3},{value:"5. Join the validator set",id:"5-join-the-validator-set",level:3},{value:"6. Check the validator set",id:"6-check-the-validator-set",level:3},{value:"Update identities",id:"update-identities",level:2},{value:"Using Source Code",id:"using-source-code",level:3},{value:"Using Docker",id:"using-docker",level:3},{value:"Using Terraform",id:"using-terraform",level:3},{value:"Bootstrap your nodes",id:"bootstrap-your-nodes",level:2},{value:"Next steps",id:"next-steps",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"connect-to-a-network",children:"Connect to a Network"}),"\n",(0,t.jsx)(n.p,{children:"This document describes how to connect your validator and validator fullnode (VFN) to an Aptos network."}),"\n",(0,t.jsx)(n.admonition,{title:"Minimum staking requirements",type:"caution",children:(0,t.jsxs)(n.p,{children:["You should only follow these instructions if your validator is able to meet the minimum\n",(0,t.jsx)(n.a,{href:"/concepts/staking",children:"staking requirements"})," for the network. The current required minimum staking\nrequirement is 1 Million APT tokens."]})}),"\n",(0,t.jsx)(n.p,{children:"At a high-level, there are four steps required to connect your nodes to an Aptos network:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Initialize stake pool:"})," First, you will need to initialize the stake pool."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Join validator set:"})," Second, you will need to join the validator set."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Update identities:"})," Third, you will need to update your node identity configurations to match the pool address."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bootstrap your nodes:"})," Finally, you will need to bootstrap your nodes, so they can connect to the network and start syncing."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"We will go through each of these steps in detail below."}),"\n",(0,t.jsx)(n.h2,{id:"initialize-the-stake-pool",children:"Initialize the stake pool"}),"\n",(0,t.jsxs)(n.p,{children:["To begin, you will need to initialize the staking pool for your nodes. There are two types of pools you\ncan initialize, a staking pool or a delegation pool. You can read more about the differences between these\npools in the ",(0,t.jsx)(n.a,{href:"/concepts/staking",children:"Staking"})," and ",(0,t.jsx)(n.a,{href:"/concepts/delegated-staking",children:"Delegated Staking"})," sections."]}),"\n",(0,t.jsxs)(n.p,{children:["To initialize a staking pool, follow the instructions in\n",(0,t.jsx)(n.a,{href:"/nodes/validator-node/operator/staking-pool-operations#initialize-a-staking-pool",children:"staking pool operations"}),". Otherwise,\nto initialize a delegation pool, follow the instructions in\n",(0,t.jsx)(n.a,{href:"/nodes/validator-node/operator/delegation-pool-operations#initialize-a-delegation-pool",children:"delegation pool operations"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"join-the-validator-set",children:"Join the validator set"}),"\n",(0,t.jsx)(n.p,{children:"Next, you will need to join the validator set. Follow the steps below:"}),"\n",(0,t.jsx)(n.admonition,{title:"Mainnet vs Testnet",type:"danger",children:(0,t.jsxs)(n.p,{children:["The commands shown below are for the Aptos mainnet. If you are connecting to a different\nnetwork, you will need to change the ",(0,t.jsx)(n.code,{children:"--network"})," value in the commands accordingly. You can view the\nvalues in ",(0,t.jsx)(n.a,{href:"/nodes/networks",children:"Aptos Blockchain Networks"})," to see how profiles can be configured based on the network."]})}),"\n",(0,t.jsx)(n.h3,{id:"1-initialize-the-aptos-cli",children:"1. Initialize the Aptos CLI"}),"\n",(0,t.jsxs)(n.p,{children:["First, initialize the Aptos CLI with your operator account private key. This can be found in your ",(0,t.jsx)(n.code,{children:"private-keys.yaml"})," file\nunder the entry ",(0,t.jsx)(n.code,{children:"account_private_key"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Replace ",(0,t.jsx)(n.code,{children:"<operator_account_private_key>"})," with the value from the file in the command below:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aptos init --profile mainnet-operator \\\n--network mainnet \\\n--private-key <operator_account_private_key> \\\n--skip-faucet\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-check-your-account-balance",children:"2. Check your account balance"}),"\n",(0,t.jsx)(n.p,{children:"Next, make sure you have enough funds to pay for transaction gas on the network. You can check this using the CLI, by\nrunning the command below:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aptos account list --profile mainnet-operator\n"})}),"\n",(0,t.jsx)(n.p,{children:"This will show you the coin balance you have in the validator account. You will see an output like below:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"coin": {\n    "value": "5000"\n  }\n'})}),"\n",(0,t.jsx)(n.h3,{id:"3-update-on-chain-network-addresses",children:"3. Update on-chain network addresses"}),"\n",(0,t.jsx)(n.p,{children:"Next, you will need to update the network addresses for your validator and VFN. This is required to ensure that your nodes\nare able to connect to other peers in the network. First, fetch the pool address for your nodes, by running the command below.\nNote: the owner address is the address of the account that owns the stake pool, and was used to initialize the stake pool."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aptos node get-stake-pool --owner-address <owner_address>\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Using the pool address from the command above, you will need to update the network addresses for your nodes. You can\ndo this by running the command below. Note that it requires the ",(0,t.jsx)(n.code,{children:"operator.yaml"})," file, which was created when you first\ndeployed your nodes."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aptos node update-validator-network-addresses  \\\n  --pool-address <pool-address> \\\n  --operator-config-file ~/$WORKSPACE/$USERNAME/operator.yaml \\\n  --profile mainnet-operator\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"Updating the network addresses",type:"tip",children:(0,t.jsx)(n.p,{children:"Updating your network addresses on-chain requires waiting for the next epoch to begin. This is because the network\naddresses are updated at the end of the current epoch. Before the next epoch, your nodes will not be able to connect\nto other peers in the network."})}),"\n",(0,t.jsx)(n.h3,{id:"4-update-on-chain-consensus-key",children:"4. Update on-chain consensus key"}),"\n",(0,t.jsxs)(n.p,{children:["Next, you will need to update the consensus key for your nodes. This is required to ensure that your nodes are able to\nparticipate in consensus. You can do this by running the command below. Note that it requires the pool address and\nthe ",(0,t.jsx)(n.code,{children:"operator.yaml"})," file (similar to above)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aptos node update-consensus-key  \\\n  --pool-address <pool-address> \\\n  --operator-config-file ~/$WORKSPACE/$USERNAME/operator.yaml \\\n  --profile mainnet-operator\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"Updating the consensus key",type:"tip",children:(0,t.jsx)(n.p,{children:"Updating your consensus key on-chain requires waiting for the next epoch to begin. This is because the consensus key\nis updated at the end of the current epoch. Before the next epoch, your nodes will not be able to participate in consensus."})}),"\n",(0,t.jsx)(n.h3,{id:"5-join-the-validator-set",children:"5. Join the validator set"}),"\n",(0,t.jsx)(n.p,{children:"Finally, you will need to join the validator set. You can do this by running the command below:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aptos node join-validator-set \\\n  --pool-address <pool-address> \\\n  --profile mainnet-operator\n"})}),"\n",(0,t.jsx)(n.p,{children:"The validator set is updated at the end of every epoch. You will need to wait for the next epoch to begin before your\nvalidator node is able to join the validator set."}),"\n",(0,t.jsx)(n.admonition,{title:"Identifying the next epoch",type:"tip",children:(0,t.jsxs)(n.p,{children:["You can identify the next epoch by checking the ",(0,t.jsx)(n.a,{href:"https://explorer.aptoslabs.com/validators/all?network=mainnet",children:"Aptos Explorer"})," or by running the command ",(0,t.jsx)(n.code,{children:"aptos node get-stake-pool"}),"."]})}),"\n",(0,t.jsx)(n.h3,{id:"6-check-the-validator-set",children:"6. Check the validator set"}),"\n",(0,t.jsxs)(n.p,{children:['When you execute the command to join the validator set, your validator will be in a "Pending Active" state until the\nnext epoch occurs. You can run the command below to look for your validator in the ',(0,t.jsx)(n.code,{children:"pending_active"})," list."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aptos node show-validator-set --profile mainnet-operator | jq -r '.Result.pending_active' | grep <pool_address>\n"})}),"\n",(0,t.jsxs)(n.p,{children:["When the next epoch occurs, the node will be moved into ",(0,t.jsx)(n.code,{children:"active_validators"}),' list. Run the command\nbelow to see your validator in the "active_validators" list:']}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aptos node show-validator-set --profile mainnet-operator | jq -r '.Result.active_validators' | grep <pool_address>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"update-identities",children:"Update identities"}),"\n",(0,t.jsx)(n.p,{children:"After joining the validator set, you will need to update your node identity configuration files to match the pool address.\nThis is required to ensure that your nodes are able to connect to other peers in the network."}),"\n",(0,t.jsx)(n.admonition,{title:"Updating the pool address",type:"danger",children:(0,t.jsxs)(n.p,{children:["It is a common error to forget to update the pool address in the node identity configurations. If you do not\nupdate the pool address for ",(0,t.jsx)(n.strong,{children:"both your validator and VFN identity files"}),", your nodes will not be able to connect to\nother peers in the network."]})}),"\n",(0,t.jsx)(n.p,{children:"Follow the steps below to update your node identity configurations, depending on the deployment method you used."}),"\n",(0,t.jsx)(n.h3,{id:"using-source-code",children:"Using Source Code"}),"\n",(0,t.jsx)(n.p,{children:"If you used the source code to deploy your nodes, follow these steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Stop your validator and VFN and remove the data directory from both nodes. Make sure to remove the\n",(0,t.jsx)(n.code,{children:"secure-data.json"})," file on the validator, too. You can see the location of the ",(0,t.jsx)(n.code,{children:"secure-data.json"})," file in your\nvalidator's configuration file."]}),"\n",(0,t.jsxs)(n.li,{children:["Update your ",(0,t.jsx)(n.code,{children:"account_address"})," in the ",(0,t.jsx)(n.code,{children:"validator-identity.yaml"})," and ",(0,t.jsx)(n.code,{children:"validator-fullnode-identity.yaml"})," files to your ",(0,t.jsx)(n.strong,{children:"pool address"}),". Do not change anything else."]}),"\n",(0,t.jsx)(n.li,{children:"Restart the validator and VFN."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"using-docker",children:"Using Docker"}),"\n",(0,t.jsx)(n.p,{children:"If you used Docker to deploy your nodes, follow these steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Stop your node and remove the data volumes: ",(0,t.jsx)(n.code,{children:"docker compose down --volumes"}),". Make sure to remove the\n",(0,t.jsx)(n.code,{children:"secure-data.json"})," file on the validator, too. You can see the location of the ",(0,t.jsx)(n.code,{children:"secure-data.json"})," file in your\nvalidator's configuration file."]}),"\n",(0,t.jsxs)(n.li,{children:["Update your ",(0,t.jsx)(n.code,{children:"account_address"})," in the ",(0,t.jsx)(n.code,{children:"validator-identity.yaml"})," and ",(0,t.jsx)(n.code,{children:"validator-fullnode-identity.yaml"})," files to your ",(0,t.jsx)(n.strong,{children:"pool address"}),".\nDo not change anything else."]}),"\n",(0,t.jsxs)(n.li,{children:["Restart the nodes with: ",(0,t.jsx)(n.code,{children:"docker compose up"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"using-terraform",children:"Using Terraform"}),"\n",(0,t.jsx)(n.p,{children:"If you used Terraform to deploy your nodes (e.g., for AWS, Azure or GCP), follow these steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Increase the ",(0,t.jsx)(n.code,{children:"era"})," number in your Terraform configuration. When this configuration is applied, it will wipe the data."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Set the ",(0,t.jsx)(n.code,{children:"enable_monitoring"})," variable in your terraform module. For example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'module "aptos-node" {\n  ...\n  enable_monitoring           = true\n  utility_instance_num        = 3  # this will add one more utility instance to run monitoring component\n}\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Apply the changes with: ",(0,t.jsx)(n.code,{children:"terraform apply"})," You will see a new pod getting created. Run ",(0,t.jsx)(n.code,{children:"kubectl get pods"})," to check."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Find the IP/DNS for the monitoring load balancer, using:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get svc ${WORKSPACE}-mon-aptos-monitoring --output jsonpath='{.status.loadBalancer.ingress[0]}'\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You will be able to access the Terraform dashboard on ",(0,t.jsx)(n.code,{children:"http://<ip/DNS>"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Pull the latest of the terraform module ",(0,t.jsx)(n.code,{children:"terraform get -update"}),", and then apply the Terraform: ",(0,t.jsx)(n.code,{children:"terraform apply"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Download the ",(0,t.jsx)(n.code,{children:"genesis.blob"})," and ",(0,t.jsx)(n.code,{children:"waypoint.txt"})," files for your network. See ",(0,t.jsx)(n.a,{href:"/nodes/node-files-all-networks/node-files",children:"Node Files"})," for locations and commands to download these files."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Update your ",(0,t.jsx)(n.code,{children:"account_address"})," in the ",(0,t.jsx)(n.code,{children:"validator-identity.yaml"})," and ",(0,t.jsx)(n.code,{children:"validator-fullnode-identity.yaml"})," files to your ",(0,t.jsx)(n.strong,{children:"pool address"}),". Do not change anything else."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Recreate the secrets. Make sure the secret name matches your ",(0,t.jsx)(n.code,{children:"era"})," number, e.g. if you have ",(0,t.jsx)(n.code,{children:"era = 3"}),", then you should replace the secret name to be:"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"${WORKSPACE}-aptos-node-0-genesis-e3\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"export WORKSPACE=<your workspace name>\n\nkubectl create secret generic ${WORKSPACE}-aptos-node-0-genesis-e2 \\\n    --from-file=genesis.blob=genesis.blob \\\n    --from-file=waypoint.txt=waypoint.txt \\\n    --from-file=validator-identity.yaml=keys/validator-identity.yaml \\\n    --from-file=validator-full-node-identity.yaml=keys/validator-full-node-identity.yaml\n"})}),"\n",(0,t.jsx)(n.h2,{id:"bootstrap-your-nodes",children:"Bootstrap your nodes"}),"\n",(0,t.jsx)(n.p,{children:"After joining the validator set and updating your node identity configurations to match the pool address,\nyou will need to bootstrap your nodes to connect to the network. To do this, follow the steps below:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Start the VFN. The VFN will connect to the network and start syncing. See ",(0,t.jsx)(n.a,{href:"/guides/state-sync",children:"State Synchronization"})," for more information."]}),"\n",(0,t.jsx)(n.li,{children:"Once the VFN is synced, restart the validator. It will sync from the VFN and then connect to other validators\nin the network and start participating in consensus."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Once both of these steps are complete, your nodes will be connected to the network and participating in consensus."}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,t.jsxs)(n.p,{children:["Congratulations! You have successfully connected your nodes to the Aptos network. To verify that your nodes are running\ncorrectly, visit the ",(0,t.jsx)(n.a,{href:"/nodes/validator-node/operator/node-liveness-criteria",children:"Node Health"})," document. This document describes how you can verify and\nmonitor the health of your validator and VFN, including an initial node verification section."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},83581:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>a});var t=o(11855);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);