"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[4796],{74176:(e,o,c)=>{c.r(o),c.d(o,{assets:()=>i,contentTitle:()=>r,default:()=>l,frontMatter:()=>n,metadata:()=>a,toc:()=>u});var s=c(63159),t=c(83581);const n={title:"Resource Accounts"},r="Resource Accounts",a={id:"move/move-on-aptos/resource-accounts",title:"Resource Accounts",description:"A resource account is a developer feature used to manage resources independent of an account managed by a user, specifically publishing modules and providing on-chain-only access control, e.g., signers.",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/move/move-on-aptos/resource-accounts.md",sourceDirName:"move/move-on-aptos",slug:"/move/move-on-aptos/resource-accounts",permalink:"/move/move-on-aptos/resource-accounts",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/move/move-on-aptos/resource-accounts.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Resource Accounts"},sidebar:"appSidebar",previous:{title:"Move Scripts Tutorial",permalink:"/move/move-on-aptos/scripts/script-tutorial"},next:{title:"Modules on Aptos",permalink:"/move/move-on-aptos/modules-on-aptos"}},i={},u=[{value:"Restrictions",id:"restrictions",level:2},{value:"Setup",id:"setup",level:2}];function d(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.h1,{id:"resource-accounts",children:"Resource Accounts"}),"\n",(0,s.jsxs)(o.p,{children:["A ",(0,s.jsx)(o.a,{href:"https://github.com/aptos-labs/aptos-core/blob/main/aptos-move/framework/aptos-framework/sources/resource_account.move",children:"resource account"})," is a developer feature used to manage resources independent of an account managed by a user, specifically publishing modules and providing on-chain-only access control, e.g., signers."]}),"\n",(0,s.jsx)(o.p,{children:"Typically, a resource account is used for two main purposes:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"Store and isolate resources; a module creates a resource account just to host specific resources."}),"\n",(0,s.jsx)(o.li,{children:"Publish module as a standalone (resource) account, a building block in a decentralized design where no private keys can control the resource account. The ownership (SignerCap) can be kept in another module, such as governance."}),"\n"]}),"\n",(0,s.jsx)(o.h2,{id:"restrictions",children:"Restrictions"}),"\n",(0,s.jsx)(o.p,{children:"In Aptos, a resource account is created based upon the SHA3-256 hash of the source's address and additional seed data. A resource account can be created only once; for a given source address and seed, there can be only one resource account. That is because the calculation of the resource account address is fully determined by the former."}),"\n",(0,s.jsxs)(o.p,{children:["An entity may call ",(0,s.jsx)(o.code,{children:"create_account"})," in an attempt to claim an account ahead of the creation of a resource account. But if a resource account is found, Aptos will transition ownership of the account over to the resource account. This is done by validating that the account has yet to execute any transactions and that the ",(0,s.jsx)(o.code,{children:"Account::signer_capbility_offer::for"})," is none. The probability of a collision where someone has legitimately produced a private key that maps to a resource account address is improbably low."]}),"\n",(0,s.jsx)(o.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(o.p,{children:"The easiest way to set up a resource account is by:"}),"\n",(0,s.jsxs)(o.ol,{children:["\n",(0,s.jsxs)(o.li,{children:["Using Aptos CLI: ",(0,s.jsx)(o.code,{children:"aptos account create-resource-account"})," creates a resource account, and ",(0,s.jsx)(o.code,{children:"aptos move create-resource-account-and-publish-package"})," creates a resource account and publishes the specified package under the resource account's address."]}),"\n",(0,s.jsxs)(o.li,{children:["Writing custom smart contracts code: in the ",(0,s.jsx)(o.code,{children:"resource_account.move"})," module, developers can find the resource account creation functions ",(0,s.jsx)(o.code,{children:"create_resource_account"}),", ",(0,s.jsx)(o.code,{children:"create_resource_account_and_fund"}),", and ",(0,s.jsx)(o.code,{children:"create_resource_account_and_publish_package"}),". Developers can then call those functions to create resource accounts in their smart contracts."]}),"\n"]}),"\n",(0,s.jsx)(o.p,{children:"Each of those options offers slightly different functionality:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.code,{children:"create_resource_account"})," - merely creates the resource account but doesn't fund it, retaining access to the resource account's signer until explicitly calling ",(0,s.jsx)(o.code,{children:"retrieve_resource_account_cap"}),"."]}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.code,{children:"create_resource_account_and_fund"})," - creates the resource account and funds it, retaining access to the resource account's signer until explicitly calling ",(0,s.jsx)(o.code,{children:"retrieve_resource_account_cap"}),"."]}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.code,{children:"create_resource_account_and_publish_package"})," - creates the resource account and results in loss of access to the resource account by design, because resource accounts are used to make contracts autonomous and immutable."]}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["In this example, you will ",(0,s.jsx)(o.a,{href:"https://github.com/aptos-labs/aptos-core/blob/2e9d8ee759fcd3f6e831034f05c1656b1c48efc4/aptos-move/move-examples/mint_nft/sources/minting.move#L73",children:"initialize"})," the ",(0,s.jsx)(o.code,{children:"mint_nft"})," module and retrieve the signer capability from both the resource account and module account. To do so, call ",(0,s.jsx)(o.code,{children:"create_resource_account_and_publish_package"})," to publish the module under the resource account's address."]}),"\n",(0,s.jsxs)(o.ol,{children:["\n",(0,s.jsxs)(o.li,{children:["Initialize the module as shown in the ",(0,s.jsx)(o.a,{href:"https://github.com/aptos-labs/aptos-core/blob/2e9d8ee759fcd3f6e831034f05c1656b1c48efc4/aptos-move/move-examples/mint_nft/sources/minting.move#L73",children:(0,s.jsx)(o.code,{children:"minting.move"})})," example."]}),"\n",(0,s.jsxs)(o.li,{children:["Call ",(0,s.jsx)(o.code,{children:"create_resource_account_and_publish_package"})," to publish the module under the resource account's address, such as in the ",(0,s.jsx)(o.a,{href:"https://github.com/aptos-labs/aptos-core/blob/main/aptos-move/e2e-move-tests/src/tests/mint_nft.rs#L62",children:(0,s.jsx)(o.code,{children:"mint_nft.rs"})})," end-to-end example."]}),"\n",(0,s.jsxs)(o.li,{children:["Retrieve the signer cap from the resource account + module account as shown in the ",(0,s.jsx)(o.a,{href:"https://github.com/aptos-labs/aptos-core/blob/2e9d8ee759fcd3f6e831034f05c1656b1c48efc4/aptos-move/move-examples/mint_nft/sources/minting.move#L83",children:(0,s.jsx)(o.code,{children:"minting.move"})})," example."]}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["Note, if the above ",(0,s.jsx)(o.code,{children:"resource_account"})," signer is ",(0,s.jsx)(o.strong,{children:"not"})," already set up as a resource account, retrieving the signer cap will fail. The ",(0,s.jsx)(o.code,{children:"source_addr"})," field in the ",(0,s.jsx)(o.code,{children:"retrieve_resource_account_cap"})," function refers to the address of the source account, or the account that creates the resource account."]}),"\n",(0,s.jsxs)(o.p,{children:["For an example, see the ",(0,s.jsx)(o.code,{children:"SignerCapability"})," employed by the ",(0,s.jsx)(o.code,{children:"mint_nft"})," function in ",(0,s.jsx)(o.a,{href:"https://github.com/aptos-labs/aptos-core/blob/2e9d8ee759fcd3f6e831034f05c1656b1c48efc4/aptos-move/move-examples/mint_nft/sources/minting.move#L143-L181",children:(0,s.jsx)(o.code,{children:"minting.move"})}),"."]}),"\n",(0,s.jsxs)(o.p,{children:['For more details, see the "resource account" references in ',(0,s.jsx)(o.a,{href:"https://github.com/aptos-labs/aptos-core/blob/main/aptos-move/framework/aptos-framework/sources/resource_account.move",children:(0,s.jsx)(o.code,{children:"resource_account.move"})})," and ",(0,s.jsx)(o.a,{href:"https://github.com/aptos-labs/aptos-core/blob/main/aptos-move/framework/aptos-framework/sources/account.move",children:(0,s.jsx)(o.code,{children:"account.move"})}),"."]})]})}function l(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},83581:(e,o,c)=>{c.d(o,{R:()=>r,x:()=>a});var s=c(11855);const t={},n=s.createContext(t);function r(e){const o=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(n.Provider,{value:o},e.children)}}}]);