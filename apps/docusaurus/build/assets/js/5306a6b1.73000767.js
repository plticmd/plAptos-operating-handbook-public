"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[8019],{76:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>c});var s=i(63159),o=i(83581);const t={title:"Genesis",id:"cli-genesis"},r=void 0,a={id:"tools/aptos-cli/use-cli/cli-genesis",title:"Genesis",description:"Genesis ceremonies",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/tools/aptos-cli/use-cli/cli-genesis.md",sourceDirName:"tools/aptos-cli/use-cli",slug:"/tools/aptos-cli/use-cli/cli-genesis",permalink:"/tools/aptos-cli/use-cli/cli-genesis",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/tools/aptos-cli/use-cli/cli-genesis.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Genesis",id:"cli-genesis"},sidebar:"appSidebar",previous:{title:"Node",permalink:"/tools/aptos-cli/use-cli/cli-node"},next:{title:"Use Aptos CLI with Ledger",permalink:"/tools/aptos-cli/use-cli/use-aptos-ledger"}},d={},c=[{value:"Genesis ceremonies",id:"genesis-ceremonies",level:2},{value:"Generating genesis",id:"generating-genesis",level:2},{value:"Prepare aptos-core",id:"prepare-aptos-core",level:3},{value:"The <code>layout</code> file",id:"the-layout-file",level:3},{value:"Building the Aptos Framework",id:"building-the-aptos-framework",level:3},{value:"The <code>ValidatorConfiguration</code> file",id:"the-validatorconfiguration-file",level:3},{value:"Generating a genesis and waypoint",id:"generating-a-genesis-and-waypoint",level:3},{value:"Starting an <code>aptos-node</code>",id:"starting-an-aptos-node",level:3}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"genesis-ceremonies",children:"Genesis ceremonies"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"aptos"})," tool supports bootstrapping new blockchains through what is known as a genesis ceremony. The output of the genesis ceremony is the output of move instructions that prepares a blockchain for online operation. The input consists of:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"A set of validators and their configuration"}),"\n",(0,s.jsx)(n.li,{children:"The initial set of Move modules, known as a framework"}),"\n",(0,s.jsxs)(n.li,{children:["A unique ",(0,s.jsx)(n.code,{children:"ChainId"})," (u8) that distinguishes this from other networks"]}),"\n",(0,s.jsx)(n.li,{children:"For test chains, there also exists an account that manages the minting of AptosCoin"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"generating-genesis",children:"Generating genesis"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The genesis organizer constructs a ",(0,s.jsx)(n.code,{children:"Layout"})," and distributes it."]}),"\n",(0,s.jsx)(n.li,{children:"The genesis organizer prepares the Aptos framework's bytecode and distributes it."}),"\n",(0,s.jsxs)(n.li,{children:["Each participant generates their ",(0,s.jsx)(n.code,{children:"ValidatorConfiguration"})," and distributes it."]}),"\n",(0,s.jsxs)(n.li,{children:["Each participant generates a ",(0,s.jsx)(n.code,{children:"genesis.blob"})," from the resulting contributions."]}),"\n",(0,s.jsxs)(n.li,{children:["The genesis organizer executes the ",(0,s.jsx)(n.code,{children:"genesis.blob"})," to derive the initial waypoint and distributes it."]}),"\n",(0,s.jsxs)(n.li,{children:["Each participant begins their ",(0,s.jsx)(n.code,{children:"aptos-node"}),". The ",(0,s.jsx)(n.code,{children:"aptos-node"})," verifies upon startup that the ",(0,s.jsx)(n.code,{children:"genesis.blob"})," with the waypoint provided by the genesis organizer."]}),"\n",(0,s.jsx)(n.li,{children:"The blockchain will begin consensus after a quorum of stake is available."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"prepare-aptos-core",children:"Prepare aptos-core"}),"\n",(0,s.jsxs)(n.p,{children:["The following sections rely on tools from the Aptos source. See ",(0,s.jsx)(n.a,{href:"/guides/building-from-source",children:"Building Aptos From Source"})," for setup."]}),"\n",(0,s.jsxs)(n.h3,{id:"the-layout-file",children:["The ",(0,s.jsx)(n.code,{children:"layout"})," file"]}),"\n",(0,s.jsx)(n.p,{children:"The layout file contains:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"root_key"}),": an Ed25519 public key for AptosCoin management."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"users"}),": the set of participants"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"chain_id"}),": the ",(0,s.jsx)(n.code,{children:"ChainId"})," or a unique integer that distinguishes this deployment from other Aptos networks"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"An example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'root_key: "0xca3579457555c80fc7bb39964eb298c414fd60f81a2f8eedb0244ec07a26e575"\nusers:\n  - alice\n  - bob\nchain_id: 8\n'})}),"\n",(0,s.jsx)(n.h3,{id:"building-the-aptos-framework",children:"Building the Aptos Framework"}),"\n",(0,s.jsx)(n.p,{children:"From your Aptos-core repository, build the framework and package it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cargo run --package framework\nmkdir aptos-framework-release\ncp aptos-framework/releases/artifacts/current/build/**/bytecode_modules/* aptos-framework-release\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The framework will be stored within the ",(0,s.jsx)(n.code,{children:"aptos-framework-release"})," directory."]}),"\n",(0,s.jsxs)(n.h3,{id:"the-validatorconfiguration-file",children:["The ",(0,s.jsx)(n.code,{children:"ValidatorConfiguration"})," file"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"ValidatorConfiguration"})," file contains:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"account_address"}),": The account that manages this validator. This must be derived from the ",(0,s.jsx)(n.code,{children:"account_key"})," provided within the ",(0,s.jsx)(n.code,{children:"ValidatorConfiguration"})," file."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"consensus_key"}),": The public key for authenticating consensus messages from the validator"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"account_key"}),": The public key for the account that manages this validator. This is used to derive the ",(0,s.jsx)(n.code,{children:"account_address"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"network_key"}),": The public key for both validator and fullnode network authentication and encryption."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"validator_host"}),": The network address where the validator resides. This contains a ",(0,s.jsx)(n.code,{children:"host"})," and ",(0,s.jsx)(n.code,{children:"port"})," field. The ",(0,s.jsx)(n.code,{children:"host"})," should either be a DNS name or an IP address. Currently only IPv4 is supported."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"full_node_host"}),": An optional network address where the fullnode resides. This contains a ",(0,s.jsx)(n.code,{children:"host"})," and ",(0,s.jsx)(n.code,{children:"port"})," field. The ",(0,s.jsx)(n.code,{children:"host"})," should either be a DNS name or an IP address. Currently only IPv4 is supported."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"stake_amount"}),": The number of coins being staked by this node. This is expected to be ",(0,s.jsx)(n.code,{children:"1"}),", if it is different the configuration will be considered invalid."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"An example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'account_address: ccd49f3ea764365ac21e99f029ca63a9b0fbfab1c8d8d5482900e4fa32c5448a\nconsensus_key: "0xa05b8f41057ac72f9ca99f5e3b1b787930f03ba5e448661f2a1fac98371775ee"\naccount_key: "0x3d15ab64c8b14c9aab95287fd0eb894aad0b4bd929a5581bcc8225b5688f053b"\nnetwork_key: "0x43ce1a4ac031b98bb1ee4a5cd72a4cca0fd72933d64b22cef4f1a61895c2e544"\nvalidator_host:\n  host: bobs_host\n  port: 6180\nfull_node_host:\n  host: bobs_host\n  port: 6182\nstake_amount: 1\n'})}),"\n",(0,s.jsxs)(n.p,{children:["To generate this using the ",(0,s.jsx)(n.code,{children:"aptos"})," CLI:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Generate your validator's keys:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cargo run --package aptos -- genesis generate-keys --output-dir bobs\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Generate your ",(0,s.jsx)(n.code,{children:"ValidatorConfiguration"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cargo run --package aptos -- \\\\\n    genesis set-validator-configuration \\\\\n    --keys-dir bobs \\\\\n    --username bob \\\\\n    --validator-host bobs_host:6180 \\\\\n    --full-node-host bobs_host:6180 \\\\\n    --local-repository-dir .\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["The last command will produce a ",(0,s.jsx)(n.code,{children:"bob.yaml"})," file that should be distributed to other participants for ",(0,s.jsx)(n.code,{children:"genesis.blob"})," generation."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"generating-a-genesis-and-waypoint",children:"Generating a genesis and waypoint"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"genesis.blob"})," and the waypoint can be generated after obtaining the ",(0,s.jsx)(n.code,{children:"layout"})," file, each of the individual ",(0,s.jsx)(n.code,{children:"ValidatorConfiguration"})," files, and the framework release. It is important to validate that the ",(0,s.jsx)(n.code,{children:"ValidatorConfiguration"})," provided in the earlier stage is the same as in the distribution for generating the ",(0,s.jsx)(n.code,{children:"genesis.blob"}),". If there is a mismatch, inform all participants."]}),"\n",(0,s.jsxs)(n.p,{children:["To generate the ",(0,s.jsx)(n.code,{children:"genesis.blob"})," and waypoint:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Place the ",(0,s.jsx)(n.code,{children:"layout"})," file in a directory, e.g., ",(0,s.jsx)(n.code,{children:"genesis"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Place all the ",(0,s.jsx)(n.code,{children:"ValidatorConfiguration"})," files into the ",(0,s.jsx)(n.code,{children:"genesis"})," directory."]}),"\n",(0,s.jsxs)(n.li,{children:["Ensure that the ",(0,s.jsx)(n.code,{children:"ValidatorConfiguration"})," files are listed under the set of ",(0,s.jsx)(n.code,{children:"users"})," within the ",(0,s.jsx)(n.code,{children:"layout"})," file."]}),"\n",(0,s.jsxs)(n.li,{children:["Make a ",(0,s.jsx)(n.code,{children:"framework"})," directory within the ",(0,s.jsx)(n.code,{children:"genesiss"})," directory and place the framework release ",(0,s.jsx)(n.code,{children:".mv"})," files into the ",(0,s.jsx)(n.code,{children:"framework"})," directory."]}),"\n",(0,s.jsxs)(n.li,{children:["Use the ",(0,s.jsx)(n.code,{children:"aptos"})," CLI to generate genesis and waypoint:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cargo run --package aptos -- genesis generate-genesis --local-repository-dir genesis\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"starting-an-aptos-node",children:["Starting an ",(0,s.jsx)(n.code,{children:"aptos-node"})]}),"\n",(0,s.jsxs)(n.p,{children:["Upon generating the ",(0,s.jsx)(n.code,{children:"genesis.blob"})," and waypoint, place them into your validator and fullnode's configuration directory and begin your validator and fullnode."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},83581:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var s=i(11855);const o={},t=s.createContext(o);function r(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);