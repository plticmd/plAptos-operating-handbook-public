"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[8695],{59736:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var s=t(63159),o=t(83581);const a={title:"Fetch data from chain"},r="TS SDK Fetch data from chain",c={id:"sdks/ts-sdk/fetch-data-from-chain",title:"Fetch data from chain",description:"Once we created a new Aptos instance, we get access to all the sdk functionality. We now can query the chain for data.",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/sdks/ts-sdk/fetch-data-from-chain.md",sourceDirName:"sdks/ts-sdk",slug:"/sdks/ts-sdk/fetch-data-from-chain",permalink:"/sdks/ts-sdk/fetch-data-from-chain",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/sdks/ts-sdk/fetch-data-from-chain.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Fetch data from chain"},sidebar:"appSidebar",previous:{title:"SDK Configuration",permalink:"/sdks/ts-sdk/sdk-configuration"},next:{title:"Transaction Builder",permalink:"/sdks/ts-sdk/transaction-builder"}},i={},d=[{value:"Queries with generics",id:"queries-with-generics",level:2},{value:"<code>options</code> input argument",id:"options-input-argument",level:2},{value:"Wait for Indexer to sync up",id:"wait-for-indexer-to-sync-up",level:2},{value:"Use namespace",id:"use-namespace",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"ts-sdk-fetch-data-from-chain",children:"TS SDK Fetch data from chain"}),"\n",(0,s.jsxs)(n.p,{children:["Once we created a new ",(0,s.jsx)(n.a,{href:"/sdks/ts-sdk/sdk-configuration",children:"Aptos instance"}),", we get access to all the sdk functionality. We now can query the chain for data."]}),"\n",(0,s.jsxs)(n.p,{children:["The SDK provides built in queries to easily query the chain with most used or popular queries. The SDK resolves those queries to Aptos ",(0,s.jsx)(n.a,{href:"https://api.mainnet.aptoslabs.com/v1/spec#/",children:"fullnode"})," or ",(0,s.jsx)(n.a,{href:"https://cloud.hasura.io/public/graphiql?endpoint=https://api.mainnet.aptoslabs.com/v1/graphql",children:"Indexer"})," as needed and ease the burden on the developer to know and understand what service they need to query."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'const aptos = new Aptos();\n\nconst fund = await aptos.getAccountInfo({ accountAddress: "0x123" });\nconst modules = await aptos.getAccountTransactions({ accountAddress: "0x123" });\nconst tokens = await aptos.getAccountOwnedTokens({ accountAddress: "0x123" });\n'})}),"\n",(0,s.jsx)(n.h2,{id:"queries-with-generics",children:"Queries with generics"}),"\n",(0,s.jsx)(n.p,{children:"Some query responses do not provide the full response type as the SDK can't infer the actual type. For that we might want to provide a generic type for the response type, so we can access the response properties that are not included in the API type."}),"\n",(0,s.jsxs)(n.p,{children:["For example, for the ",(0,s.jsx)(n.code,{children:"getAccountResource"})," query we can define the ",(0,s.jsx)(n.code,{children:"resource"})," to query but the SDK can't infer the response type, and we can't have access to the response properties."]}),"\n",(0,s.jsx)(n.p,{children:"For that we support generic response types for different queries."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'type Coin = { coin: { value: string } };\n\nconst resource = await aptos.getAccountResource<Coin>({\n  accountAddress: testAccount.accountAddress,\n  resourceType: "0x1::coin::CoinStore<0x1::aptos_coin::AptosCoin>",\n});\n\n// Now we have access to the response type property\nconst value = resource.coin.value;\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"options-input-argument",children:[(0,s.jsx)(n.code,{children:"options"})," input argument"]}),"\n",(0,s.jsxs)(n.p,{children:["We can provide queries with an ",(0,s.jsx)(n.code,{children:"options"})," input as query parameters. For those queries that support this option, an ",(0,s.jsx)(n.code,{children:"option"})," input param is available"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'const resource = await aptos.getAccountResource({\n  accountAddress: alice.accountAddress,\n  resourceType: "0x1::coin::CoinStore<0x1::aptos_coin::AptosCoin>",\n  options: { ledgerVersion: 12 },\n});\n\nconst tokens = await aptos.getAccountOwnedTokens({\n  accountAddress: alice.accountAddress,\n  options: {\n    tokenStandard: "v2",\n    pagination: { offset: 0, limit: 10 },\n    orderBy: [{ last_transaction_version: "desc" }],\n  },\n});\n'})}),"\n",(0,s.jsx)(n.h2,{id:"wait-for-indexer-to-sync-up",children:"Wait for Indexer to sync up"}),"\n",(0,s.jsx)(n.p,{children:"Sometimes we use Indexer service to fetch data, this is because we can not get complex data direct from fullnode or some queries are not supported with the fullnode API.\nSince Indexer indexes the chain, it might take it some time to catch up with the latest ledger version, and we can end up not getting the real time data."}),"\n",(0,s.jsxs)(n.p,{children:["For that, the SDK supports an optional input argument ",(0,s.jsx)(n.code,{children:"minimumLedgerVersion"}),". We can pass a ledger version to sync up to, before querying.\nIf no version provided, the SDK will not wait for Indexer to sync up."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const tokens = await aptos.getAccountOwnedTokens({\n  accountAddress: alice.accountAddress,\n  minimumLedgerVersion: 1234,\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"To get the latest ledger version we can"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Query for the ledger info"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const ledgerInfo = await aptos.getLedgerInfo();\n\nconst ledgerVersion = ledgerInfo.ledger_version;\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["If we just committed a transaction with the SDK, we can use ",(0,s.jsx)(n.code,{children:"waitForTransaction"})," method, that would return us a ",(0,s.jsx)(n.code,{children:"CommittedTransactionResponse"})," that holds the latest ledger version"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const response = await aptos.waitForTransaction({\n  transactionHash: pendingTransaction.hash,\n});\n\nconst tokens = await aptos.getAccountOwnedTokens({\n  accountAddress: alice.accountAddress,\n  minimumLedgerVersion: BigInt(response.version),\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"use-namespace",children:"Use namespace"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"Aptos"})," class holds different namespaces related to the query operation we seek to do. For example, all ",(0,s.jsx)(n.code,{children:"account"})," related queries are under the ",(0,s.jsx)(n.code,{children:"aptos.account"})," namespace.\nOnce we initiate the ",(0,s.jsx)(n.code,{children:"Aptos"})," class, all namespaces will be available for as with autocomplete along with all the possible API functions."]}),"\n",(0,s.jsx)(n.p,{children:"Thought we don't need to specify the namespace when making a query, it can be beneficial while developing."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const aptos = new Aptos()\naptos.< list of available API functions and namespaces >\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},83581:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var s=t(11855);const o={},a=s.createContext(o);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);